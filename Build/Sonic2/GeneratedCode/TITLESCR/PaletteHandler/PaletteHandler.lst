/*--------------------------------------------------------------*
 * Compilé avec C6809 v0.83                                     *
 *--------------------------------------------------------------*
 * Fichier source      : .\Sonic2\GeneratedCode\TITLESCR\PaletteHandler\PaletteHandler.asm
 * Fichier destination : .\Sonic2\GeneratedCode\TMP.BIN
 * Contenu :
 *     Main     0:MAIN.ASM     2119
 *     Include  0:GLOBALS.ASM  6596
 *     Include  0:CONSTANT.ASM 5768
 *--------------------------------------------------------------*/

Macro Pass
Pass1
Pass2
    176                                   INCLUD GLOBALS
    177                           * Generated Code
    178
    179                  414F     GameModeLoader equ $414F
    180                  41C7     current_game_mode_data equ $41C7
    181                  0001     ObjID_SonicAndTailsIn equ 1
    182                  0002     ObjID_SEGA equ 2
    183                  0003     ObjID_PaletteHandler equ 3
    184                  0004     ObjID_TitleScreen equ 4
    185                  613F     Glb_Sprite_Screen_Pos_Part1 equ $613F
    186                  6141     Glb_Sprite_Screen_Pos_Part2 equ $6141
    187                  662D     Object_RAM equ $662D
    188                  7188     screen_border_color equ $7188
    189                  71A5     Vint_runcount equ $71A5
    190                  0001     c1_button_up_mask equ $0001
    191                  0002     c1_button_down_mask equ $0002
    192                  0004     c1_button_left_mask equ $0004
    193                  0008     c1_button_right_mask equ $0008
    194                  0010     c2_button_up_mask equ $0010
    195                  0020     c2_button_down_mask equ $0020
    196                  0040     c2_button_left_mask equ $0040
    197                  0080     c2_button_right_mask equ $0080
    198                  0040     c1_button_A_mask equ $0040
    199                  0080     c2_button_A_mask equ $0080
    200                  71A9     Joypads_Held equ $71A9
    201                  71A9     Dpad_Held equ $71A9
    202                  71AA     Fire_Held equ $71AA
    203                  71AB     Joypads_Press equ $71AB
    204                  71AB     Dpad_Press equ $71AB
    205                  71AC     Fire_Press equ $71AC
    206                  7216     MarkObjGone equ $7216
    207                  7218     DisplaySprite_x equ $7218
    208                  721E     DisplaySprite equ $721E
    209                  7297     AnimateSprite equ $7297
    210                  735C     DeleteObject_x equ $735C
    211                  7362     DeleteObject equ $7362
    212                  7424     ClearObj equ $7424
    213                  7CD4     ClearCartMem equ $7CD4
    214                  7D0F     Refresh_palette equ $7D0F
    215                  7D10     Cur_palette equ $7D10
    216                  7D12     Dyn_palette equ $7D12
    217                  7D32     Black_palette equ $7D32
    218                  7D52     White_palette equ $7D52
    219                  7D72     UpdatePalette equ $7D72
    220                  7D9A     PlayPCM equ $7D9A
    221                  7DF1     PSGInit equ $7DF1
    222                  7E03     PSGPlayNoRepeat equ $7E03
    223                  7E31     PSGStop equ $7E31
    224                  7E5A     PSGResume equ $7E5A
    225                  7EA5     PSGCancelLoop equ $7EA5
    226                  7EA9     PSGGetStatus equ $7EA9
    227                  7EAD     PSGSetMusicVolumeAttenuation equ $7EAD
    228                  7F0C     PSGSilenceChannels equ $7F0C
    229                  7F21     PSGRestoreVolumes equ $7F21
    230                  7F95     PSGSFXPlayLoop equ $7F95
    231                  7FE1     PSGSFXStop equ $7FE1
    232                  8057     PSGSFXCancelLoop equ $8057
    233                  805B     PSGSFXGetStatus equ $805B
    234                  805F     PSGFrame equ $805F
    235                  8119     _sendVolume2PSG equ $8119
    236                  816C     PSGSFXFrame equ $816C
    237                  81C9     _SFXsetLoopPoint equ $81C9
    238                  8215     Img_SonicAndTailsIn equ $8215
    239                  8225     Img_SegaLogo_2 equ $8225
    240                  8235     Img_SegaLogo_1 equ $8235
    241                  8245     Img_SegaTrails_1 equ $8245
    242                  825E     Img_SegaSonic_12 equ $825E
    243                  827F     Img_SegaSonic_23 equ $827F
    244                  82A0     Img_SegaSonic_13 equ $82A0
    245                  82C1     Img_SegaSonic_32 equ $82C1
    246                  82E2     Img_SegaSonic_21 equ $82E2
    247                  8303     Img_SegaSonic_43 equ $8303
    248                  8324     Img_SegaSonic_11 equ $8324
    249                  8345     Img_SegaSonic_33 equ $8345
    250                  8366     Img_SegaSonic_22 equ $8366
    251                  8387     Img_SegaSonic_41 equ $8387
    252                  83A8     Img_SegaSonic_31 equ $83A8
    253                  83C9     Img_SegaSonic_42 equ $83C9
    254                  83EA     Img_SegaTrails_6 equ $83EA
    255                  83FA     Img_SegaTrails_5 equ $83FA
    256                  840A     Img_SegaTrails_4 equ $840A
    257                  841A     Img_SegaTrails_3 equ $841A
    258                  842A     Img_SegaTrails_2 equ $842A
    259                  8443     Img_star_4 equ $8443
    260                  8457     Img_star_3 equ $8457
    261                  846B     Img_sonicHand equ $846B
    262                  8482     Img_star_2 equ $8482
    263                  849D     Img_star_1 equ $849D
    264                  84B8     Img_emblemBack08 equ $84B8
    265                  84C8     Img_emblemBack07 equ $84C8
    266                  84D8     Img_emblemBack09 equ $84D8
    267                  84E8     Img_emblemBack04 equ $84E8
    268                  84F8     Img_emblemBack03 equ $84F8
    269                  8508     Img_emblemBack06 equ $8508
    270                  8518     Img_emblemBack05 equ $8518
    271                  8528     Img_tails_5 equ $8528
    272                  853F     Img_tails_4 equ $853F
    273                  8553     Img_tails_3 equ $8553
    274                  8567     Img_tails_2 equ $8567
    275                  857B     Img_tails_1 equ $857B
    276                  858F     Img_tailsHand equ $858F
    277                  85A6     Img_sonic_1 equ $85A6
    278                  85BA     Img_sonic_2 equ $85BA
    279                  85CE     Img_emblemBack02 equ $85CE
    280                  85DE     Img_emblemBack01 equ $85DE
    281                  85EE     Img_sonic_5 equ $85EE
    282                  8605     Img_sonic_3 equ $8605
    283                  8619     Img_sonic_4 equ $8619
    284                  862D     Img_emblemFront07 equ $862D
    285                  863D     Img_emblemFront08 equ $863D
    286                  864D     Img_emblemFront05 equ $864D
    287                  865D     Img_emblemFront06 equ $865D
    288                  866D     Img_emblemFront03 equ $866D
    289                  867D     Img_emblemFront04 equ $867D
    290                  868D     Img_emblemFront01 equ $868D
    291                  869D     Img_emblemFront02 equ $869D
    292                  86AE     Ani_SegaSonic_3 equ $86AE
    293                  86B8     Ani_SegaSonic_2 equ $86B8
    294                  86C2     Ani_SegaSonic_1 equ $86C2
    295                  86CC     Ani_smallStar equ $86CC
    296                  86D2     Ani_largeStar equ $86D2
    297                  86DE     Ani_tails equ $86DE
    298                  86EA     Ani_sonic equ $86EA
    299                  613F     Glb_Sprite_Screen_Pos_Part1 equ $613F
    300                  6141     Glb_Sprite_Screen_Pos_Part2 equ $6141
    301                  662D     Object_RAM equ $662D
    302                  7188     screen_border_color equ $7188
    303                  71A5     Vint_runcount equ $71A5
    304                  0001     c1_button_up_mask equ $0001
    305                  0002     c1_button_down_mask equ $0002
    306                  0004     c1_button_left_mask equ $0004
    307                  0008     c1_button_right_mask equ $0008
    308                  0010     c2_button_up_mask equ $0010
    309                  0020     c2_button_down_mask equ $0020
    310                  0040     c2_button_left_mask equ $0040
    311                  0080     c2_button_right_mask equ $0080
    312                  0040     c1_button_A_mask equ $0040
    313                  0080     c2_button_A_mask equ $0080
    314                  71A9     Joypads_Held equ $71A9
    315                  71A9     Dpad_Held equ $71A9
    316                  71AA     Fire_Held equ $71AA
    317                  71AB     Joypads_Press equ $71AB
    318                  71AB     Dpad_Press equ $71AB
    319                  71AC     Fire_Press equ $71AC
    320                  7216     MarkObjGone equ $7216
    321                  7218     DisplaySprite_x equ $7218
    322                  721E     DisplaySprite equ $721E
    323                  7297     AnimateSprite equ $7297
    324                  735C     DeleteObject_x equ $735C
    325                  7362     DeleteObject equ $7362
    326                  7424     ClearObj equ $7424
    327                  7CD4     ClearCartMem equ $7CD4
    328                  7D0F     Refresh_palette equ $7D0F
    329                  7D10     Cur_palette equ $7D10
    330                  7D12     Dyn_palette equ $7D12
    331                  7D32     Black_palette equ $7D32
    332                  7D52     White_palette equ $7D52
    333                  7D72     UpdatePalette equ $7D72
    334                  7D9A     PlayPCM equ $7D9A
    335                  7DF1     PSGInit equ $7DF1
    336                  7E03     PSGPlayNoRepeat equ $7E03
    337                  7E31     PSGStop equ $7E31
    338                  7E5A     PSGResume equ $7E5A
    339                  7EA5     PSGCancelLoop equ $7EA5
    340                  7EA9     PSGGetStatus equ $7EA9
    341                  7EAD     PSGSetMusicVolumeAttenuation equ $7EAD
    342                  7F0C     PSGSilenceChannels equ $7F0C
    343                  7F21     PSGRestoreVolumes equ $7F21
    344                  7F95     PSGSFXPlayLoop equ $7F95
    345                  7FE1     PSGSFXStop equ $7FE1
    346                  8057     PSGSFXCancelLoop equ $8057
    347                  805B     PSGSFXGetStatus equ $805B
    348                  805F     PSGFrame equ $805F
    349                  8119     _sendVolume2PSG equ $8119
    350                  816C     PSGSFXFrame equ $816C
    351                  81C9     _SFXsetLoopPoint equ $81C9
    352                  8215     Img_SonicAndTailsIn equ $8215
    353                  8225     Img_SegaLogo_2 equ $8225
    354                  8235     Img_SegaLogo_1 equ $8235
    355                  8245     Img_SegaTrails_1 equ $8245
    356                  825E     Img_SegaSonic_12 equ $825E
    357                  827F     Img_SegaSonic_23 equ $827F
    358                  82A0     Img_SegaSonic_13 equ $82A0
    359                  82C1     Img_SegaSonic_32 equ $82C1
    360                  82E2     Img_SegaSonic_21 equ $82E2
    361                  8303     Img_SegaSonic_43 equ $8303
    362                  8324     Img_SegaSonic_11 equ $8324
    363                  8345     Img_SegaSonic_33 equ $8345
    364                  8366     Img_SegaSonic_22 equ $8366
    365                  8387     Img_SegaSonic_41 equ $8387
    366                  83A8     Img_SegaSonic_31 equ $83A8
    367                  83C9     Img_SegaSonic_42 equ $83C9
    368                  83EA     Img_SegaTrails_6 equ $83EA
    369                  83FA     Img_SegaTrails_5 equ $83FA
    370                  840A     Img_SegaTrails_4 equ $840A
    371                  841A     Img_SegaTrails_3 equ $841A
    372                  842A     Img_SegaTrails_2 equ $842A
    373                  8443     Img_star_4 equ $8443
    374                  8457     Img_star_3 equ $8457
    375                  846B     Img_sonicHand equ $846B
    376                  8482     Img_star_2 equ $8482
    377                  849D     Img_star_1 equ $849D
    378                  84B8     Img_emblemBack08 equ $84B8
    379                  84C8     Img_emblemBack07 equ $84C8
    380                  84D8     Img_emblemBack09 equ $84D8
    381                  84E8     Img_emblemBack04 equ $84E8
    382                  84F8     Img_emblemBack03 equ $84F8
    383                  8508     Img_emblemBack06 equ $8508
    384                  8518     Img_emblemBack05 equ $8518
    385                  8528     Img_tails_5 equ $8528
    386                  853F     Img_tails_4 equ $853F
    387                  8553     Img_tails_3 equ $8553
    388                  8567     Img_tails_2 equ $8567
    389                  857B     Img_tails_1 equ $857B
    390                  858F     Img_tailsHand equ $858F
    391                  85A6     Img_sonic_1 equ $85A6
    392                  85BA     Img_sonic_2 equ $85BA
    393                  85CE     Img_emblemBack02 equ $85CE
    394                  85DE     Img_emblemBack01 equ $85DE
    395                  85EE     Img_sonic_5 equ $85EE
    396                  8605     Img_sonic_3 equ $8605
    397                  8619     Img_sonic_4 equ $8619
    398                  862D     Img_emblemFront07 equ $862D
    399                  863D     Img_emblemFront08 equ $863D
    400                  864D     Img_emblemFront05 equ $864D
    401                  865D     Img_emblemFront06 equ $865D
    402                  866D     Img_emblemFront03 equ $866D
    403                  867D     Img_emblemFront04 equ $867D
    404                  868D     Img_emblemFront01 equ $868D
    405                  869D     Img_emblemFront02 equ $869D
    406                  86AE     Ani_SegaSonic_3 equ $86AE
    407                  86B8     Ani_SegaSonic_2 equ $86B8
    408                  86C2     Ani_SegaSonic_1 equ $86C2
    409                  86CC     Ani_smallStar equ $86CC
    410                  86D2     Ani_largeStar equ $86D2
    411                  86DE     Ani_tails equ $86DE
    412                  86EA     Ani_sonic equ $86EA
    413                  89F3     Pcm_SEGA equ $89F3
    414                  89FE     Psg_TitleScreen equ $89FE
    415                  8A38     Pal_SEGA equ $8A38
    416                  8A58     Pal_TitleScreen equ $8A58
    417                  8A78     Pal_SEGAMid equ $8A78
    418                  8A98     Pal_SonicAndTailsIn equ $8A98
    419                  8AB8     Pal_SEGAEnd equ $8AB8
    420
    421                                   INCLUD CONSTANT
    422                           * --------------------------------------->>
    423                           * Constants
    424                           *
    425                           * Naming convention
    426                           * -----------------
    427                           * - lower case
    428                           * - underscore-separated names
    429                           *
    430                           * --------------------------------------->>
    431
    432                           * =======================================>>
    433                           * TO8 Registers
    434                           * =======================================>>
    435
    436                  6049     dk_lecteur                    equ $6049
    437                  604A     dk_piste                      equ $604A
    438                  604B     dk_pisteL                     equ $604B
    439                  604C     dk_secteur                    equ $604C
    440                  604F     dk_destination                equ $604F
    441
    442                           * =======================================>>
    443                           * Display Constants
    444                           * =======================================>>
    445
    446                  00A0     screen_width                  equ 160 ; s>>
    447                  001C     screen_top                    equ 28 ; in>>
    448                  00E3     screen_bottom                 equ 28+199 >>
    449                  0030     screen_left                   equ 48 ; in>>
    450                  00CF     screen_right                  equ 48+159 >>
    451                  0008     nb_priority_levels            equ 8   ; n>>
    452
    453                           * =======================================>>
    454                           * Physics Constants
    455                           * =======================================>>
    456
    457                  0038     gravity                       equ $38 ; G>>
    458
    459                           * =======================================>>
    460                           * Animation Constants
    461                           * =======================================>>
    462
    463                  00FF     _resetAnim                    equ $FF
    464                  00FE     _goBackNFrames                equ $FE
    465                  00FD     _goToAnimation                equ $FD
    466                  00FC     _nextRoutine                  equ $FC
    467                  00FB     _resetAnimAndSubRoutine       equ $FB
    468                  00FA     _nextSubRoutine               equ $FA
    469
    470                           * =======================================>>
    471                           * Images Constants
    472                           * =======================================>>
    473
    474                  0004     image_x_size                  equ 4
    475                  0005     image_y_size                  equ 5
    476                  0006     image_center_offset           equ 6
    477
    478                  0004     image_subset_x1_offset        equ 4
    479                  0005     image_subset_y1_offset        equ 5
    480
    481                  0000     page_draw_routine             equ 0
    482                  0001     draw_routine                  equ 1
    483                  0003     page_erase_routine            equ 3
    484                  0004     erase_routine                 equ 4
    485                  0006     erase_nb_cell                 equ 6
    486
    487                           * =======================================>>
    488                           * Sound Constants
    489                           * =======================================>>
    490
    491                  0000     pcm_page        equ 0
    492                  0001     pcm_start_addr  equ 1
    493                  0003     pcm_end_addr    equ 3
    494                  0005     pcm_meta_size   equ 5
    495
    496                           * =======================================>>
    497                           * Object Constants
    498                           * =======================================>>
    499
    500                  0002     nb_reserved_objects           equ 2
    501                  001B     nb_dynamic_objects            equ 27
    502                  0003     nb_level_objects              equ 3
    503                  0020     nb_objects                    equ 32 * ma>>
    504
    505                           * --------------------------------------->>
    506                           * Object Status Table offsets
    507                           * --------------------------------------->>
    508
    509                  005A     object_size                   equ 90 ; th>>
    510                  005A     next_object                   equ object_>>
    511
    512                  0000     id                            equ 0      >>
    513                  0001     subtype                       equ 1      >>
    514                  0002     render_flags                  equ 2
    515
    516                           * --- render_flags bitfield variables --->>
    517                  0001     render_xmirror_mask           equ $01 ; (>>
    518                  0002     render_ymirror_mask           equ $02 ; (>>
    519                  0004     render_overlay_mask           equ $04 ; (>>
    520                  0008     render_motionless_mask        equ $08 ; (>>
    521                  0010     render_playfieldcoord_mask    equ $10 ; (>>
    522                  0020     render_hide_mask              equ $20 ; (>>
    523                  0040     render_todelete_mask          equ $40 ; (>>
    524                  0080     render_xloop_mask             equ $80 ; (>>
    525                            
    526                  0003     priority                      equ 3      >>
    527                  0004     anim                          equ 4  ; an>>
    528                  0006     prev_anim                     equ 6  ; an>>
    529                  0008     anim_frame                    equ 8      >>
    530                  0009     anim_frame_duration           equ 9      >>
    531                  000A     image_set                     equ 10 ; an>>
    532                  000C     x_pos                         equ 12 ; an>>
    533                  000E     x_sub                         equ 14     >>
    534                  000F     y_pos                         equ 15 ; an>>
    535                  0011     y_sub                         equ 17     >>
    536                  0012     xy_pixel                      equ 18     >>
    537                  0012     x_pixel                       equ 18     >>
    538                  0013     y_pixel                       equ 19     >>
    539                  0014     x_vel                         equ 20 ; an>>
    540                  0016     y_vel                         equ 22 ; an>>
    541                  0018     routine                       equ 24     >>
    542                  0019     routine_secondary             equ 25     >>
    543                  001A     status                        equ 26
    544
    545                           * --- status bitfield variables for objec>>
    546                  0001     status_x_orientation          equ   $01 ;>>
    547                  0002     status_y_orientation          equ   $02 ;>>
    548                  0004     status_bit2                   equ   $04 ;>>
    549                  0008     status_mainchar_standing      equ   $08 ;>>
    550                  0010     status_sidekick_standing      equ   $10 ;>>
    551                  0020     status_mainchar_pushing       equ   $20 ;>>
    552                  0040     status_sidekick_pushing       equ   $40 ;>>
    553                  0080     status_bit7                   equ   $80 ;>>
    554
    555                           * --- status bitfield variables for Main >>
    556                  0002     status_inair                  equ   $02 ;>>
    557                  0004     status_jumporroll             equ   $04 ;>>
    558                  0008     status_norgroundnorfall       equ   $08 ;>>
    559                  0010     status_jumpingafterrolling    equ   $10 ;>>
    560                  0020     status_pushing                equ   $20 ;>>
    561                  0040     status_underwater             equ   $40 ;>>
    562
    563                  001B     ext_variables                 equ 27 ; to>>
    564
    565                           * --------------------------------------->>
    566                           * reserved variables (engine)
    567
    568                  0029     rsv_render_flags              equ 41
    569
    570                           * --- rsv_render_flags bitfield variables>>
    571                  0001     rsv_render_checkrefresh_mask  equ $01 ; (>>
    572                  0002     rsv_render_erasesprite_mask   equ $02 ; (>>
    573                  0004     rsv_render_displaysprite_mask equ $04 ; (>>
    574                  0008     rsv_render_outofrange_mask    equ $08 ; (>>
    575
    576                  002A     rsv_prev_anim                 equ 42 ; an>>
    577                  002C     rsv_image_center_offset       equ 44 ; 0 >>
    578                           * ne sert plus                       ; an>>
    579                  002E     rsv_image_subset              equ 46 ; an>>
    580                  0030     rsv_mapping_frame             equ 48 ; an>>
    581                  0032     rsv_xy1_pixel                 equ 50     >>
    582                  0032     rsv_x1_pixel                  equ 50     >>
    583                  0033     rsv_y1_pixel                  equ 51     >>
    584                  0034     rsv_xy2_pixel                 equ 52     >>
    585                  0034     rsv_x2_pixel                  equ 52     >>
    586                  0035     rsv_y2_pixel                  equ 53     >>
    587
    588                           * --------------------------------------->>
    589                           * reserved variables (engine) - buffer sp>>
    590
    591                  0036     rsv_buffer_0                  equ 54 ; St>>
    592                  0036     rsv_priority_0                equ 54 ; in>>
    593                  0037     rsv_priority_prev_obj_0       equ 55 ; an>>
    594                  0039     rsv_priority_next_obj_0       equ 57 ; an>>
    595                           *rsv_prev_image_subset_0       equ 59 ; a>>
    596                  003D     rsv_prev_mapping_frame_0      equ 61 ; an>>
    597                  003F     rsv_bgdata_0                  equ 63 ; an>>
    598                  0041     rsv_prev_xy_pixel_0           equ 65 ;
    599                  0041     rsv_prev_x_pixel_0            equ 65 ; pr>>
    600                  0042     rsv_prev_y_pixel_0            equ 66 ; pr>>
    601                  0043     rsv_prev_xy1_pixel_0          equ 67 ;
    602                  0043     rsv_prev_x1_pixel_0           equ 67 ; pr>>
    603                  0044     rsv_prev_y1_pixel_0           equ 68 ; pr>>
    604                  0045     rsv_prev_xy2_pixel_0          equ 69 ;
    605                  0045     rsv_prev_x2_pixel_0           equ 69 ; pr>>
    606                  0046     rsv_prev_y2_pixel_0           equ 70 ; pr>>
    607                  0047     rsv_prev_render_flags_0       equ 71 ;
    608                           * --- rsv_prev_render_flags_0 bitfield va>>
    609                  0001     rsv_prev_render_overlay_mask  equ $01 ; (>>
    610                  0080     rsv_prev_render_onscreen_mask equ $80 ; (>>
    611
    612                  0048     rsv_buffer_1                  equ 72 ; St>>
    613                  0048     rsv_priority_1                equ 72 ; in>>
    614                  0049     rsv_priority_prev_obj_1       equ 73 ; an>>
    615                  004B     rsv_priority_next_obj_1       equ 75 ; an>>
    616                           *rsv_prev_image_subset_1       equ 77 ; a>>
    617                  004F     rsv_prev_mapping_frame_1      equ 79 ; an>>
    618                  0051     rsv_bgdata_1                  equ 81 ; an>>
    619                  0053     rsv_prev_xy_pixel_1           equ 83 ;
    620                  0053     rsv_prev_x_pixel_1            equ 83 ; pr>>
    621                  0054     rsv_prev_y_pixel_1            equ 84 ; pr>>
    622                  0055     rsv_prev_xy1_pixel_1          equ 85 ;
    623                  0055     rsv_prev_x1_pixel_1           equ 85 ; pr>>
    624                  0056     rsv_prev_y1_pixel_1           equ 86 ; pr>>
    625                  0057     rsv_prev_xy2_pixel_1          equ 87 ;
    626                  0057     rsv_prev_x2_pixel_1           equ 87 ; pr>>
    627                  0058     rsv_prev_y2_pixel_1           equ 88 ; pr>>
    628                  0059     rsv_prev_render_flags_1       equ 89 ;
    629
    630                  0000     buf_priority                  equ 0  ; of>>
    631                  0001     buf_priority_prev_obj         equ 1  ;
    632                  0003     buf_priority_next_obj         equ 3  ;
    633                           *buf_prev_image_subset         equ 5  ;
    634                  0007     buf_prev_mapping_frame        equ 7  ;
    635                  0009     buf_bgdata                    equ 9  ;
    636                  000B     buf_prev_xy_pixel             equ 11 ;
    637                  000B     buf_prev_x_pixel              equ 11 ;
    638                  000C     buf_prev_y_pixel              equ 12 ;
    639                  000D     buf_prev_xy1_pixel            equ 13 ;
    640                  000D     buf_prev_x1_pixel             equ 13 ;
    641                  000E     buf_prev_y1_pixel             equ 14 ;
    642                  000F     buf_prev_xy2_pixel            equ 15 ;
    643                  000F     buf_prev_x2_pixel             equ 15 ;
    644                  0010     buf_prev_y2_pixel             equ 16 ;
    645                  0011     buf_prev_render_flags         equ 17 ;
     50        A000                       org   $A000
     51
     52                           * --------------------------------------->>
     53                           * Object Status Table offsets
     54                           * --------------------------------------->>
     55                  001B     pal_src      equ ext_variables         * >>
     56                  001D     pal_dst      equ ext_variables+2       * >>
     57
     58        A000               PaletteHandler
     59  4+1   A000 A6   C8 18            lda   routine,u
     60  4+1   A003 A7   8C 01            sta   *+4,pcr
     61  3     A006 20   00               bra   PaletteHandler_Routines
     62                            
     63        A008               PaletteHandler_Routines
     64  5     A008 16   0003             lbra  PaletteHandler_Init
     65  5     A00B 16   006B             lbra  PaletteHandler_Main
     66                            
     67        A00E               PaletteHandler_Init
     68  4+1   A00E A6   C8 18            lda   routine,u
     69  2     A011 8B   03               adda  #$03
     70  4+1   A013 A7   C8 18            sta   routine,u
     71  2     A016 86   10               lda   #$10
     72  4+5   A018 A7   8D 00CE          sta   pal_cycles,pcr
     73                            
     74  6+1   A01C 10AE C8 1B            ldy   pal_src,u
     75  5     A020 108C 7D12             cmpy  #Dyn_palette             * >>
     76  3     A024 27   53               beq   PaletteHandler_Main
     77  3     A026 8E   7D12             ldx   #Dyn_palette
     78  5+0   A029 EC   A4               ldd   ,y
     79  5+0   A02B ED   84               std   ,x
     80  5+1   A02D EC   22               ldd   2,y
     81  5+1   A02F ED   02               std   2,x
     82  5+1   A031 EC   24               ldd   4,y
     83  5+1   A033 ED   04               std   4,x
     84  5+1   A035 EC   26               ldd   6,y
     85  5+1   A037 ED   06               std   6,x
     86  5+1   A039 EC   28               ldd   8,y
     87  5+1   A03B ED   08               std   8,x
     88  5+1   A03D EC   2A               ldd   10,y
     89  5+1   A03F ED   0A               std   10,x
     90  5+1   A041 EC   2C               ldd   12,y
     91  5+1   A043 ED   0C               std   12,x
     92  5+1   A045 EC   2E               ldd   14,y
     93  5+1   A047 ED   0E               std   14,x
     94  5+1   A049 EC   A8 10            ldd   16,y
     95  5+1   A04C ED   88 10            std   16,x
     96  5+1   A04F EC   A8 12            ldd   18,y
     97  5+1   A052 ED   88 12            std   18,x
     98  5+1   A055 EC   A8 14            ldd   20,y
     99  5+1   A058 ED   88 14            std   20,x
    100  5+1   A05B EC   A8 16            ldd   22,y
    101  5+1   A05E ED   88 16            std   22,x
    102  5+1   A061 EC   A8 18            ldd   24,y
    103  5+1   A064 ED   88 18            std   24,x
    104  5+1   A067 EC   A8 1A            ldd   26,y
    105  5+1   A06A ED   88 1A            std   26,x
    106  5+1   A06D EC   A8 1C            ldd   28,y
    107  5+1   A070 ED   88 1C            std   28,x
    108  5+1   A073 EC   A8 1E            ldd   30,y
    109  5+1   A076 ED   88 1E            std   30,x
    110                            
    111        A079               PaletteHandler_Main
    112  5+1   A079 AE   C8 1D            ldx   pal_dst,u
    113  4     A07C 108E 7D12             ldy   #Dyn_palette
    114  2     A080 86   10               lda   #$10
    115  4+5   A082 A7   8D 0067          sta   pal_idx,pcr
    116  6+5   A086 6A   8D 0060          dec   pal_cycles,pcr           * >>
    117  3     A08A 26   03               bne   PHI_Loop                 * >>
    118  4     A08C 7E   7424             jmp   ClearObj                 * >>
    119                            
    120        A08F               PHI_Loop
    121  4+0   A08F A6   A4               lda   ,y                        *>>
    122  4+5   A091 A4   8D 0054          anda  pal_mask,pcr             * >>
    123  4+0   A095 E6   84               ldb   ,x                       * >>
    124  4+5   A097 E4   8D 004E          andb  pal_mask,pcr             * >>
    125  4+5   A09B E7   8D 004C          stb   pal_buffer,pcr           * >>
    126  2     A09F C6   11               ldb   #$11                     * >>
    127  4+5   A0A1 E4   8D 0044          andb  pal_mask,pcr             * >>
    128  4+5   A0A5 E7   8D 0043          stb   pal_buffer+1,pcr         * >>
    129  4+5   A0A9 A1   8D 003E          cmpa  pal_buffer,pcr           * >>
    130  3     A0AD 27   12               beq   PHI_VRSuivante           * >>
    131  3     A0AF 22   08               bhi   PHI_VRDec                * >>
    132  4+0   A0B1 A6   A4               lda   ,y                       * >>
    133  4+5   A0B3 AB   8D 0035          adda  pal_buffer+1,pcr         * >>
    134  3     A0B7 20   06               bra   PHI_VRSave               * >>
    135        A0B9               PHI_VRDec
    136  4+0   A0B9 A6   A4               lda   ,y                       * >>
    137  4+5   A0BB A0   8D 002D          suba  pal_buffer+1,pcr         * >>
    138        A0BF               PHI_VRSave
    139  4+0   A0BF A7   A4               sta   ,y                       * >>
    140        A0C1               PHI_VRSuivante
    141  6+5   A0C1 63   8D 0024          com   pal_mask,pcr             * >>
    142  3     A0C5 2B   C8               bmi   PHI_Loop                 * >>
    143                            
    144        A0C7               PHI_SetPalBleu
    145  4+1   A0C7 E6   21               ldb   1,y                      * >>
    146  4+1   A0C9 E1   01               cmpb  1,x                      * >>
    147  3     A0CB 27   08               beq   PHI_SetPalNext           * >>
    148  3     A0CD 22   03               bhi   PHI_SetPalBleudec        * >>
    149  2     A0CF 5C                    incb                           * >>
    150  3     A0D0 20   01               bra   PHI_SetPalSaveBleu       * >>
    151        A0D2               PHI_SetPalBleudec
    152  2     A0D2 5A                    decb                           * >>
    153        A0D3               PHI_SetPalSaveBleu
    154  4+1   A0D3 E7   21               stb   1,y                      * >>
    155                            
    156        A0D5               PHI_SetPalNext
    157  4+1   A0D5 31   22               leay  2,y                      * >>
    158  4+1   A0D7 30   02               leax  2,x                      * >>
    159  6+5   A0D9 6A   8D 0010          dec   pal_idx,pcr
    160  3     A0DD 26   B0               bne   PHI_Loop                 * >>
    161  3     A0DF CC   7D12             ldd   #Dyn_palette
    162  6     A0E2 FD   7D10             std   Cur_palette
    163  7     A0E5 7F   7D0F             clr   Refresh_palette          * >>
    164  5     A0E8 39                    rts
    165
    166                           * --------------------------------------->>
    167                           * Local data
    168                           * --------------------------------------->>
    169                            
    170        A0E9 0F            pal_mask     fcb $0F                   * >>
    171        A0EA 00            pal_cycles   fcb $00
    172        A0EB 0000          pal_buffer   fdb $00                   * >>
    173        A0ED 00            pal_idx      fcb $00                   * >>
    174
    175

000000 Total Errors

000291 Total Symbols
     0x          Equ   0004 anim
     0x          Equ   7297 AnimateSprite
     0x          Equ   0008 anim_frame
     0x          Equ   0009 anim_frame_duration
     0x          Equ   86D2 Ani_largeStar
     0x          Equ   86C2 Ani_SegaSonic_1
     0x          Equ   86B8 Ani_SegaSonic_2
     0x          Equ   86AE Ani_SegaSonic_3
     0x          Equ   86CC Ani_smallStar
     0x          Equ   86EA Ani_sonic
     0x          Equ   86DE Ani_tails
     0x          Equ   7D32 Black_palette
     0x          Equ   0009 buf_bgdata
     0x          Equ   0007 buf_prev_mapping_frame
     0x          Equ   0011 buf_prev_render_flags
     0x          Equ   000D buf_prev_x1_pixel
     0x          Equ   000F buf_prev_x2_pixel
     0x          Equ   000D buf_prev_xy1_pixel
     0x          Equ   000F buf_prev_xy2_pixel
     0x          Equ   000B buf_prev_xy_pixel
     0x          Equ   000B buf_prev_x_pixel
     0x          Equ   000E buf_prev_y1_pixel
     0x          Equ   0010 buf_prev_y2_pixel
     0x          Equ   000C buf_prev_y_pixel
     0x          Equ   0000 buf_priority
     0x          Equ   0003 buf_priority_next_obj
     0x          Equ   0001 buf_priority_prev_obj
     0x          Equ   0040 c1_button_A_mask
     0x          Equ   0002 c1_button_down_mask
     0x          Equ   0004 c1_button_left_mask
     0x          Equ   0008 c1_button_right_mask
     0x          Equ   0001 c1_button_up_mask
     0x          Equ   0080 c2_button_A_mask
     0x          Equ   0020 c2_button_down_mask
     0x          Equ   0040 c2_button_left_mask
     0x          Equ   0080 c2_button_right_mask
     0x          Equ   0010 c2_button_up_mask
     0x          Equ   7CD4 ClearCartMem
     1x          Equ   7424 ClearObj
     0x          Equ   41C7 current_game_mode_data
     1x          Equ   7D10 Cur_palette
     0x          Equ   7362 DeleteObject
     0x          Equ   735C DeleteObject_x
     0x          Equ   721E DisplaySprite
     0x          Equ   7218 DisplaySprite_x
     0x          Equ   604F dk_destination
     0x          Equ   6049 dk_lecteur
     0x          Equ   604A dk_piste
     0x          Equ   604B dk_pisteL
     0x          Equ   604C dk_secteur
     0x          Equ   71A9 Dpad_Held
     0x          Equ   71AB Dpad_Press
     0x          Equ   0001 draw_routine
     4x          Equ   7D12 Dyn_palette
     0x          Equ   0006 erase_nb_cell
     0x          Equ   0004 erase_routine
     2x          Equ   001B ext_variables
     0x          Equ   71AA Fire_Held
     0x          Equ   71AC Fire_Press
     0x          Equ   414F GameModeLoader
     0x          Equ   613F Glb_Sprite_Screen_Pos_Part1
     0x          Equ   6141 Glb_Sprite_Screen_Pos_Part2
     0x          Equ   0038 gravity
     0x          Equ   0000 id
     0x          Equ   0006 image_center_offset
     0x          Equ   000A image_set
     0x          Equ   0004 image_subset_x1_offset
     0x          Equ   0005 image_subset_y1_offset
     0x          Equ   0004 image_x_size
     0x          Equ   0005 image_y_size
     0x          Equ   85DE Img_emblemBack01
     0x          Equ   85CE Img_emblemBack02
     0x          Equ   84F8 Img_emblemBack03
     0x          Equ   84E8 Img_emblemBack04
     0x          Equ   8518 Img_emblemBack05
     0x          Equ   8508 Img_emblemBack06
     0x          Equ   84C8 Img_emblemBack07
     0x          Equ   84B8 Img_emblemBack08
     0x          Equ   84D8 Img_emblemBack09
     0x          Equ   868D Img_emblemFront01
     0x          Equ   869D Img_emblemFront02
     0x          Equ   866D Img_emblemFront03
     0x          Equ   867D Img_emblemFront04
     0x          Equ   864D Img_emblemFront05
     0x          Equ   865D Img_emblemFront06
     0x          Equ   862D Img_emblemFront07
     0x          Equ   863D Img_emblemFront08
     0x          Equ   8235 Img_SegaLogo_1
     0x          Equ   8225 Img_SegaLogo_2
     0x          Equ   8324 Img_SegaSonic_11
     0x          Equ   825E Img_SegaSonic_12
     0x          Equ   82A0 Img_SegaSonic_13
     0x          Equ   82E2 Img_SegaSonic_21
     0x          Equ   8366 Img_SegaSonic_22
     0x          Equ   827F Img_SegaSonic_23
     0x          Equ   83A8 Img_SegaSonic_31
     0x          Equ   82C1 Img_SegaSonic_32
     0x          Equ   8345 Img_SegaSonic_33
     0x          Equ   8387 Img_SegaSonic_41
     0x          Equ   83C9 Img_SegaSonic_42
     0x          Equ   8303 Img_SegaSonic_43
     0x          Equ   8245 Img_SegaTrails_1
     0x          Equ   842A Img_SegaTrails_2
     0x          Equ   841A Img_SegaTrails_3
     0x          Equ   840A Img_SegaTrails_4
     0x          Equ   83FA Img_SegaTrails_5
     0x          Equ   83EA Img_SegaTrails_6
     0x          Equ   8215 Img_SonicAndTailsIn
     0x          Equ   846B Img_sonicHand
     0x          Equ   85A6 Img_sonic_1
     0x          Equ   85BA Img_sonic_2
     0x          Equ   8605 Img_sonic_3
     0x          Equ   8619 Img_sonic_4
     0x          Equ   85EE Img_sonic_5
     0x          Equ   849D Img_star_1
     0x          Equ   8482 Img_star_2
     0x          Equ   8457 Img_star_3
     0x          Equ   8443 Img_star_4
     0x          Equ   858F Img_tailsHand
     0x          Equ   857B Img_tails_1
     0x          Equ   8567 Img_tails_2
     0x          Equ   8553 Img_tails_3
     0x          Equ   853F Img_tails_4
     0x          Equ   8528 Img_tails_5
     0x          Equ   71A9 Joypads_Held
     0x          Equ   71AB Joypads_Press
     0x          Equ   7216 MarkObjGone
     0x          Equ   001B nb_dynamic_objects
     0x          Equ   0003 nb_level_objects
     0x          Equ   0020 nb_objects
     0x          Equ   0008 nb_priority_levels
     0x          Equ   0002 nb_reserved_objects
     0x          Equ   005A next_object
     0x          Equ   662D Object_RAM
     1x          Equ   005A object_size
     0x          Equ   0003 ObjID_PaletteHandler
     0x          Equ   0002 ObjID_SEGA
     0x          Equ   0001 ObjID_SonicAndTailsIn
     0x          Equ   0004 ObjID_TitleScreen
     0x          Equ   0000 page_draw_routine
     0x          Equ   0003 page_erase_routine
     0x          Label A000 PaletteHandler
     1x          Label A00E PaletteHandler_Init
     2x          Label A079 PaletteHandler_Main
     1x          Label A008 PaletteHandler_Routines
     5x          Label A0EB pal_buffer
     2x          Label A0EA pal_cycles
     1x          Equ   001D pal_dst
     2x          Label A0ED pal_idx
     4x          Label A0E9 pal_mask
     0x          Equ   8A38 Pal_SEGA
     0x          Equ   8AB8 Pal_SEGAEnd
     0x          Equ   8A78 Pal_SEGAMid
     0x          Equ   8A98 Pal_SonicAndTailsIn
     1x          Equ   001B pal_src
     0x          Equ   8A58 Pal_TitleScreen
     0x          Equ   0003 pcm_end_addr
     0x          Equ   0005 pcm_meta_size
     0x          Equ   0000 pcm_page
     0x          Equ   89F3 Pcm_SEGA
     0x          Equ   0001 pcm_start_addr
     3x          Label A08F PHI_Loop
     0x          Label A0C7 PHI_SetPalBleu
     1x          Label A0D2 PHI_SetPalBleudec
     1x          Label A0D5 PHI_SetPalNext
     1x          Label A0D3 PHI_SetPalSaveBleu
     1x          Label A0B9 PHI_VRDec
     1x          Label A0BF PHI_VRSave
     1x          Label A0C1 PHI_VRSuivante
     0x          Equ   7D9A PlayPCM
     0x          Equ   0006 prev_anim
     0x          Equ   0003 priority
     0x          Equ   7EA5 PSGCancelLoop
     0x          Equ   805F PSGFrame
     0x          Equ   7EA9 PSGGetStatus
     0x          Equ   7DF1 PSGInit
     0x          Equ   7E03 PSGPlayNoRepeat
     0x          Equ   7F21 PSGRestoreVolumes
     0x          Equ   7E5A PSGResume
     0x          Equ   7EAD PSGSetMusicVolumeAttenuation
     0x          Equ   8057 PSGSFXCancelLoop
     0x          Equ   816C PSGSFXFrame
     0x          Equ   805B PSGSFXGetStatus
     0x          Equ   7F95 PSGSFXPlayLoop
     0x          Equ   7FE1 PSGSFXStop
     0x          Equ   7F0C PSGSilenceChannels
     0x          Equ   7E31 PSGStop
     0x          Equ   89FE Psg_TitleScreen
     1x          Equ   7D0F Refresh_palette
     0x          Equ   0002 render_flags
     0x          Equ   0020 render_hide_mask
     0x          Equ   0008 render_motionless_mask
     0x          Equ   0004 render_overlay_mask
     0x          Equ   0010 render_playfieldcoord_mask
     0x          Equ   0040 render_todelete_mask
     0x          Equ   0080 render_xloop_mask
     0x          Equ   0001 render_xmirror_mask
     0x          Equ   0002 render_ymirror_mask
     3x          Equ   0018 routine
     0x          Equ   0019 routine_secondary
     0x          Equ   003F rsv_bgdata_0
     0x          Equ   0051 rsv_bgdata_1
     0x          Equ   0036 rsv_buffer_0
     0x          Equ   0048 rsv_buffer_1
     0x          Equ   002C rsv_image_center_offset
     0x          Equ   002E rsv_image_subset
     0x          Equ   0030 rsv_mapping_frame
     0x          Equ   002A rsv_prev_anim
     0x          Equ   003D rsv_prev_mapping_frame_0
     0x          Equ   004F rsv_prev_mapping_frame_1
     0x          Equ   0047 rsv_prev_render_flags_0
     0x          Equ   0059 rsv_prev_render_flags_1
     0x          Equ   0080 rsv_prev_render_onscreen_mask
     0x          Equ   0001 rsv_prev_render_overlay_mask
     0x          Equ   0043 rsv_prev_x1_pixel_0
     0x          Equ   0055 rsv_prev_x1_pixel_1
     0x          Equ   0045 rsv_prev_x2_pixel_0
     0x          Equ   0057 rsv_prev_x2_pixel_1
     0x          Equ   0043 rsv_prev_xy1_pixel_0
     0x          Equ   0055 rsv_prev_xy1_pixel_1
     0x          Equ   0045 rsv_prev_xy2_pixel_0
     0x          Equ   0057 rsv_prev_xy2_pixel_1
     0x          Equ   0041 rsv_prev_xy_pixel_0
     0x          Equ   0053 rsv_prev_xy_pixel_1
     0x          Equ   0041 rsv_prev_x_pixel_0
     0x          Equ   0053 rsv_prev_x_pixel_1
     0x          Equ   0044 rsv_prev_y1_pixel_0
     0x          Equ   0056 rsv_prev_y1_pixel_1
     0x          Equ   0046 rsv_prev_y2_pixel_0
     0x          Equ   0058 rsv_prev_y2_pixel_1
     0x          Equ   0042 rsv_prev_y_pixel_0
     0x          Equ   0054 rsv_prev_y_pixel_1
     0x          Equ   0036 rsv_priority_0
     0x          Equ   0048 rsv_priority_1
     0x          Equ   0039 rsv_priority_next_obj_0
     0x          Equ   004B rsv_priority_next_obj_1
     0x          Equ   0037 rsv_priority_prev_obj_0
     0x          Equ   0049 rsv_priority_prev_obj_1
     0x          Equ   0001 rsv_render_checkrefresh_mask
     0x          Equ   0004 rsv_render_displaysprite_mask
     0x          Equ   0002 rsv_render_erasesprite_mask
     0x          Equ   0029 rsv_render_flags
     0x          Equ   0008 rsv_render_outofrange_mask
     0x          Equ   0032 rsv_x1_pixel
     0x          Equ   0034 rsv_x2_pixel
     0x          Equ   0032 rsv_xy1_pixel
     0x          Equ   0034 rsv_xy2_pixel
     0x          Equ   0033 rsv_y1_pixel
     0x          Equ   0035 rsv_y2_pixel
     0x          Equ   7188 screen_border_color
     0x          Equ   00E3 screen_bottom
     0x          Equ   0030 screen_left
     0x          Equ   00CF screen_right
     0x          Equ   001C screen_top
     0x          Equ   00A0 screen_width
     0x          Equ   001A status
     0x          Equ   0004 status_bit2
     0x          Equ   0080 status_bit7
     0x          Equ   0002 status_inair
     0x          Equ   0010 status_jumpingafterrolling
     0x          Equ   0004 status_jumporroll
     0x          Equ   0020 status_mainchar_pushing
     0x          Equ   0008 status_mainchar_standing
     0x          Equ   0008 status_norgroundnorfall
     0x          Equ   0020 status_pushing
     0x          Equ   0040 status_sidekick_pushing
     0x          Equ   0010 status_sidekick_standing
     0x          Equ   0040 status_underwater
     0x          Equ   0001 status_x_orientation
     0x          Equ   0002 status_y_orientation
     0x          Equ   0001 subtype
     0x          Equ   7D72 UpdatePalette
     0x          Equ   71A5 Vint_runcount
     0x          Equ   7D52 White_palette
     0x          Equ   0012 xy_pixel
     0x          Equ   0012 x_pixel
     0x          Equ   000C x_pos
     0x          Equ   000E x_sub
     0x          Equ   0014 x_vel
     0x          Equ   0013 y_pixel
     0x          Equ   000F y_pos
     0x          Equ   0011 y_sub
     0x          Equ   0016 y_vel
     0x          Equ   00FE _goBackNFrames
     0x          Equ   00FD _goToAnimation
     0x          Equ   00FC _nextRoutine
     0x          Equ   00FA _nextSubRoutine
     0x          Equ   00FF _resetAnim
     0x          Equ   00FB _resetAnimAndSubRoutine
     0x          Equ   8119 _sendVolume2PSG
     0x          Equ   81C9 _SFXsetLoopPoint

