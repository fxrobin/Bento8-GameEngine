****************************************ñUneñaraigneeñloufoqueñd'ecranñ(ALE)*ñduñgenreñTOñ8pattes^wñbits.*ñ==>ñTO-ALEñ<==ñ(señprononceñtoile)**ñElleñseñbaladeñañl'ecranñavecñunñfil*ñañlañpatteñetñlaisseñtrainerñde*ñjoliesñtoilesñunñpeuñpartout.**ñSortieñparñctrl-c.**ñCompilationñavec:*ñ-ñc6809ñ(-cñ-amñ-oOP)*óhttp://www.pulsdemos.com/c6809.html*ñ-ñmacroñassemblerñ3.6ñ(A/IM)*óhttp://tinyurl.com/btqz57a**ñSamuelñDevulderñMarsñ2012***************************************÷orgô$6300PLOTXòequô$603DPLOTYòequô$603FSTATUSñequô$6019*ñprofondeurñmaxiñhistoriqueHISTORY÷equô20****************************************ñboucle:*÷REPEAT*÷....*÷WHILEócondition***************************************REPEATñmacroloopósetô*÷endmWHILEòmacro÷b\0ôloop÷endm****************************************ñFiltrage:*÷FILTERò<lbl>**ñDefini:*öF<lbl>ñ=ñvaleurñfiltreeñsurñ2*ÿñoctets*ñCalcule:*÷F<lbl>ñ=ñ(3*F<lbl>ñ+ñD)/4***************************************FILTRòmacro÷jsrô<filtrF\0ôfdbô0÷endm****************************************ñMouvementñphysique:*÷PHYSòsymbol,val,max**ñDefini:*öP<symbol>ñ=ñpositionñ(2ñoctet)*öV<symbol>ñ=ñvitesseñ(1ñoctet)*öA<symbol>ñ=ñaccel.ñ(1ñoctet)**ñCalcule:*ñMiseñañjourñlañpositionñenñfonction*ñdeñlañvitesseñetñdeñl'acceleration.*ñSiñlañpositionñdepasseñmax,ñalors*ñl'accelerationñestñstopeeñetñlañvit.*ñestñinverseeñ(etñdoublee).**ñLañvitesseñetñl'accelerationñsont*ñdefiniesñauñformatñsigneñ5.3ñavec*ñsaturationñpourñlañvitesse.***************************************PHYSómacro÷jsrô<physV\0ôfcbô0A\0ôfcbô0P\0ôfdbô\1,\2÷endm****************************************ñGenerateurñaleatoire:**öRNDôoffset,max**ñCalcule:*ñAñ=ñnbñaleatoireñentreñoffsetñet*õoffset+max-1.***************************************RNDômacro÷jsrô<rnd÷fcbô\0,\1÷endm****************************************ñPointñd'entree***************************************÷setdpò*<-8iniôpshsód,x,y,u,dp÷ldbô#*<-8÷tfrôb,dp****************************************ñinitialisationñduñgenerateurñrnd***************************************÷ldxô$E7C6ò!ñtimer÷REPEAT÷RNDô0,0÷leaxó-1,x÷WHILEòne****************************************ñnouveauñdessin***************************************startòclrô<PVô!ñresetñtraj÷ldxô<PXô!ñinitñFX,FY÷stxô<FX÷ldyô<PY÷styô<FY÷RNDô8,HISTORY-8÷lduô#HFINò!ñinitñhisto.÷REPEAT÷pshuóx,y÷deca÷WHILEòne÷stuô<HDEB÷stuô<HPTR****************************************ñaffichageñdessin***************************************÷RNDô50,200ñ!ñnombreñdeñpas÷jsrô<clsó!ñeff.ñecran÷REPEAT÷jsrô<draw÷deca÷WHILEòne****************************************ñfinñtraceñcombineñañl'attente***************************************÷clrbú!ñfinñtrace÷stdô<VXô!ñzeroñvitesse÷stdô<VYô!ñzeroñaccelwaitóldaô#HISTORY÷staô<PV÷REPEAT÷jsrô<draw÷deca÷WHILEòne÷decb÷bneôwait****************************************ñlectureñclavier,ñdetectionñBREAK.***************************************÷jsrô6,uô!ñGETC÷cmpbó#3õ!ñctrl-c÷bneôstart÷pulsód,x,y,u,dp****************************************ñSWIñestñtransparentñpourñleñbasic.*ñOnñpasseñdoncñsurñleñclsñsiñonñest*ñlanceñdepuisñleñbasic.ñSinonñsous*ñAssemblerñonñs'arreteñla.***************************************÷swiû!ñrts****************************************ñEffacementñecranñ+ñformeñseuleñ+*ñcurseurñeteint.**ñRetourneñU=$E800ñB=ecrase***************************************clsôlduô#$E800÷jsrô,uõ!ñreset÷ldbô#12÷jsrô3,uô!ñPUTC÷ldbô#88÷stbôSTATUSñ!ñformeñseule÷rtsû!ñcursñeteint****************************************ñAfficheñuneñligne:*ñ-ñbougeñPX,ñPYñenñfonctionñdeñla*óvitesseñetñl'acceleration.*ñ-ñeffectureñunñfiltreñpasseñbas*ó(FX,ñFY)*ñ-ñdepileñdansñ(X,Y)ñlañ1ereñcoordñde*ól'historiqueñetñempileñlañnouvelle.*ñ-ñtracageñdeñligneñ(FX,FY)-(X,Y)*ñ-ñsiñfinñdeñtrajñdetermineñune*ónouvelleñaccelerationñetñduree**ñEnñentree:ñU=$E800.*ñEnñsortie:ñXñetñYñcoordñextremite*üligneñtracee.***************************************drawópshsód,u÷ldaô#123PVõsetô*-1ô!ñfinñtrajñ?÷deca÷bgeôdraw1ò!ñnonñ=>ñphys÷RNDô-8,16ò!ñnouvelle÷staô<AXô!ñacceleration÷RNDô-8,16÷staô<AY÷RNDô10,20ò!ñnouvñdureedraw1òstaô<PV÷PHYSóX,160,319÷PHYSóY,100,199÷lddô<PXô!ñfiltreñpasse÷FILTRòXö!ñpasñpour÷stdôPLOTXò!ñlisserñla÷lddô<PYô!ñtrajectoire÷FILTRòY÷stdôPLOTY÷lduô#0õ!ñdepilageHPTRósetô*-2ô!ñoldñcoord÷puluóx,yô!ñempilage÷stdô-2,uó!ñnewñcoord÷lddô<FX÷stdô-4,u÷cmpuó#HFINò!ñbuf.ñcircul.÷bneômain1÷lduô#0HDEBósetô*-2main1òstuô<HPTR÷pulsód,u÷jmpô12,uó!ñDRAW****************************************ñfiltrage:ñFXñ=ñ(Dñ+ñ3*FX)/4*ñentree:ñDñcontientñPX,ñSñpointeñsur*ùl'adresseñdeñFX.*ñsortie:ñUñecrase***************************************filtròpulsóu÷adddó,uõ!ñD+FX÷adddó,uõ!ñD+2*FX÷adddó,uõ!ñD+3*FX÷asra÷rorb÷asra÷rorbú!ñD=(D+3*FX)/4÷stdô,uõ!ñFX=D÷jmpô2,uô!ñretour****************************************ñGenereñunñnombreñpseudoñaleatoireñsur*ñ8ñbit.ñC'estñuneñversionñmodifiee*ñduñmultiplyñwithñcarry.ñLañperiode*ñdeñlañsequenceñestñ31870.ñCompact*ñetñrapide,ñqueñdemanderñdeñplus?**ñenñentree:ñSñpointeñsurñ(offset,max)*ñenñsortie:ñA=unñnombreñrandomñentre*þoffsetñetñoffset+max-1*üB,ñUñecrase***************************************rndôpulsóu÷lddô#3*256+249÷mulrnd1óadddó#0÷staô<rnd1+2÷stbô<rnd+1+2÷ldaô1,u÷mul÷addaó,u÷jmpô2,u****************************************ñMiseñañjourñd'uneñpositionñviañla*ñloiñphysique.**ñentreeñ:ñSñpointeñsurñl'adresseñde*úfcbñVIT,ACC*úfdbñPOS,MAX*ñsortieñ:ñPOS,ñVITñmisñañjour*úU,ñX,ñDñecrase***************************************physópulsóu÷puluód,xô!ñA=vitñB=acc÷asraú!ñX=pos÷asra÷asra÷leaxóa,xô!ñX=pos+vit/8÷ldaô-4,u÷cmpxó,uõ!ñX<0ñouñX>MAX?÷blsôphys1÷ldxô-2,uó!ñoui=>rebond÷aslbú!ñaccel*=2÷bvcôphys0÷ldbô-3,uphys0ònegbú!ñaccel=-accel÷clraú!ñvit=0phys1òpshuód,x÷addbó,uõ!ñvit=vit+acc÷bvsôphys2ò!ñsatur?÷stbô,uphys2òjmpô6,uô!ñretour****************************************ñhistorique***************************************÷rmbô4*HISTORYHFINósetô*÷endôini