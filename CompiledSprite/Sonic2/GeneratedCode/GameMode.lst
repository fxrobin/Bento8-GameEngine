/*--------------------------------------------------------------*
 * Compilé avec C6809 v0.83                                     *
 *--------------------------------------------------------------*
 * Fichier source      : .\Sonic2\GeneratedCode\GameMode.ASM
 * Fichier destination : .\Sonic2\GeneratedCode\TMP.BIN
 * Contenu :
 *     Main     0:GAMEMODE.ASM 1479
 *     Include  0:CONSTANT.ASM 2224
 *     Include  0:COPY8K.ASM   652
 *--------------------------------------------------------------*/

Macro Pass
Pass1
Pass2
     33        A000                       org $A000
    113                                   INCLUD CONSTANT
    114                           * --------------------------------------->>
    115                           * Physics Constants
    116                           * --------------------------------------->>
    117
    118                  0038     gravity                       equ $38 ; G>>
    119
    120                           * =======================================>>
    121                           * Object Constants
    122                           * =======================================>>
    123
    124                  0002     number_of_reserved_objects       equ 2
    125                  002D     number_of_dynamic_objects        equ 45
    126                  0003     number_of_level_objects          equ 3
    127
    128                           * --------------------------------------->>
    129                           * Object Status Table offsets
    130                           * --------------------------------------->>
    131
    132                  001F     object_size                   equ $1F ; t>>
    133                  001F     next_object                   equ object_>>
    134                            
    135                  0000     id                            equ $00 ; a>>
    136                  0002     render_flags                  equ $02 ; b>>
    137                  0003     x_pos                         equ $03 ; a>>
    138                  0005     x_sub                         equ $05 ; s>>
    139                  0005     y_pos                         equ $05 ; a>>
    140                  0007     y_sub                         equ $07 ; s>>
    141                  0003     x_pixel                       equ x_pos
    142                  0005     y_pixel                       equ x_pos+2>>
    143                  0008     priority                      equ $08 ; $>>
    144                  000A     width_pixels                  equ $0A
    145                  000B     mapping_frame                 equ $0B
    146                  000B     x_vel                         equ $0B ; a>>
    147                  000D     y_vel                         equ $0D ; a>>
    148                  000F     y_radius                      equ $0F ; c>>
    149                  0010     x_radius                      equ $10 ; c>>
    150                  0011     anim_frame                    equ $11
    151                  0012     anim                          equ $12
    152                  0013     prev_anim                     equ $13
    153                  0014     anim_frame_duration           equ $14 ; r>>
    154                  0015     status                        equ $15 ; n>>
    155                  0016     routine                       equ $16
    156                  0017     routine_secondary             equ $17
    157                  0018     objoff_01                     equ $18 ; v>>
    158                  0019     objoff_02                     equ $19
    159                  001A     objoff_03                     equ $1A
    160                  001B     objoff_04                     equ $1B
    161                  001C     objoff_05                     equ $1C
    162                  001D     collision_flags               equ $1D
    163                  001E     subtype                       equ $1E
    164
    165                           * --------------------------------------->>
    166                           * render_flags bitfield variables
    167                  0001     render_xmirror_mask           equ $01 ; b>>
    168                  0002     render_ymirror_mask           equ $02 ; b>>
    169                  0004     render_coordinate1_mask       equ $04 ; b>>
    170                  0008     render_coordinate2_mask       equ $08 ;
    171                  0010     render_ycheckonscreen_mask    equ $10 ; b>>
    172                  0020     render_staticmappings_mask    equ $20 ; b>>
    173                  0040     render_subobjects_mask        equ $40 ; b>>
    174                  0080     render_onscreen_mask          equ $80 ; b>>
    175
    176                           * --------------------------------------->>
    177                           * status bitfield variables
    178                  0001     status_leftfacing_mask        equ $01 ; b>>
    179                  0002     status_inair_mask             equ $02 ; b>>
    180                  0004     status_spinning_mask          equ $04 ; b>>
    181                  0008     status_onobject_mask          equ $08 ; b>>
    182                  0010     status_rolljumping_mask       equ $10 ; b>>
    183                  0020     status_pushing_mask           equ $20 ; b>>
    184                  0040     status_underwater_mask        equ $40 ; b>>
    185                  0080     status_tobedeleted_mask       equ $80 ; b>>
    186
    187                           * --------------------------------------->>
    188                           * status_secondary bitfield variables
    189                  0001     status_sec_hasShield_mask     equ $01 ; b>>
    190                  0002     status_sec_isInvincible_mask  equ $02 ; b>>
    191                  0004     status_sec_hasSpeedShoes_mask equ $04 ; b>>
    192                  0008     status_sec_3_mask             equ $08 ; b>>
    193                  0010     status_sec_4_mask             equ $10 ; b>>
    194                  0020     status_sec_5_mask             equ $20 ; b>>
    195                  0040     status_sec_6_mask             equ $40 ; b>>
    196                  0080     status_sec_isSliding_mask     equ $80 ; b>>
    197
     35
     36                           * =======================================>>
     37                           * Boucle principale
     38                           * =======================================>>
     39        A000               GameModeEngineLoader
     40
     41                           * Chargement de la page 3 a l'ecran
     42                           *****************************************>>
     43        A000               WaitVBL
     44  7     A000 7D   E7E7             tst   $E7E7                    * >>
     45  3     A003 2A   FB               bpl   WaitVBL                  * >>
     46        A005               WaitVBL_01
     47  7     A005 7D   E7E7             tst   $E7E7                    * >>
     48  3     A008 2B   FB               bmi   WaitVBL_01               * >>
     49        A00A               SwapVideoPage
     50  2     A00A C6   C0               ldb   #$C0                     * >>
     51  5     A00C F7   E7DD             stb   $E7DD                    * >>
     52                            
     53                           * Chargement de la page 2 en zone 0000-3F>>
     54                           *****************************************>>
     55  2     A00F C6   62               ldb   #$62                     * >>
     56  5     A011 F7   E7E6             stb   $E7E6                    * >>
     57                            
     58                           * Chargement de la page 0a en zone 4000-5>>
     59                           *****************************************>>
     60  5     A014 F6   E7C3             ldb   $E7C3                    * >>
     61  2     A017 C4   FE               andb  #$FE                     * >>
     62  5     A019 F7   E7C3             stb   $E7C3                    * >>
     63
     64                           * Copie en page 0a du moteur Game Mode et>>
     65                           *****************************************>>
     66  3     A01C 8E   A029             ldx   #GameModeEngine          * >>
     67  4     A01F 108E 4000             ldy   #$4000                   * >>
     68  8     A023 BD   C029             jsr   COPY8k                   * >>
     69                            
     70  4     A026 7E   4000             jmp   $4000
     71                            
     72        A029               GameModeEngine
     73
     74        A029               GameModeEngine_End
     75        A029                       rmb   $2000-(GameModeEngine_End-G>>
     76                            
     77                           *        lda   game_mode
     78                           *        ldx   GameModesArray
     79                           *        ldu   a,x
     80                            
     81                           *GameModesArray
     82                           *        fdb   gm_data_intro
     83                           *        fdb   gm_data_title_screen
     84                           *        fdb   gm_data_level
     85                           *        fdb   gm_data_ending_sequence
     86                            
     87                           *game_mode          fdb $00
     88                           *gm_intro           equ $00
     89                           *gm_title_screen    equ $02
     90                           *gm_level           equ $04
     91                           *gm_ending_sequence equ $06
     92                            
     93                           *gm_data_intro
     94                           *        fdb   $0000
     95                            
     96                           *gm_data_title_screen
     97                           *        fdb   $0000
     98                            
     99                           *gm_data_level
    100                           *        fdb   $0000
    101                            
    102                           *gm_data_ending_sequence
    103                           *        fdb   $0000
    104                            
    105
    106
    107                           * =======================================>>
    108                           * Routines
    109                           * =======================================>>
    198                                   INCLUD COPY8K
    199                           * Recopie 8 ko entre X et Y
    200        C029               COPY8k
    201  5+10  C029 34   7F          PSHS D,X,Y,U,DP,CC
    202  6+5   C02B 10EF 8D 002B     STS  COPY8k3+2,PCR ; sauve S
    203
    204  4+4   C030 33   89 2000     LEAU 8192,X        ; adresse de fin de>>
    205  5+5   C034 EF   8D 001C     STU  COPY8k2+2,PCR ; met a jour test d>>
    206                            
    207  5+3   C038 EC   81          LDD  ,X++          ; 8192 = 21*390 + 2>>
    208  5+3   C03A ED   A1          STD  ,Y++          ; on s'occupe des 2>>
    209                            
    210  4+1   C03C 32   27          LEAS 7,Y           ; mets a jour les p>>
    211  4+0   C03E 33   84          LEAU ,X            ; U=source S=dest
    212        C040               COPY8k1
    213  5+7   C040 37   3E          PULU D,X,Y,DP      ; on lit 7 octets
    214  5+7   C042 34   3E          PSHS D,X,Y,DP      ; on ecrit 7 octets>>
    215  4+1   C044 32   6E          LEAS 14,S          ; reajuste S => 12 >>
    216  5+7   C046 37   3E          PULU D,X,Y,DP      ;
    217  5+7   C048 34   3E          PSHS D,X,Y,DP      ;
    218  4+1   C04A 32   6E          LEAS 14,S          ;
    219  5+7   C04C 37   3E          PULU D,X,Y,DP      ;
    220  5+7   C04E 34   3E          PSHS D,X,Y,DP      ;
    221  4+1   C050 32   6E          LEAS 14,S          ; repete 3 fois = 2>>
    222        C052               COPY8k2
    223  5     C052 1183 0000        CMPU #0            ; fin ?
    224  3     C056 26   E8          BNE  COPY8k1       ; non => boucle 5 +>>
    225        C058               COPY8k3
    226  4     C058 10CE 0000        LDS  #0            ; recup S d'entree
    227  5+10  C05C 35   BF          PULS D,X,Y,DP,CC,PC
    228                            
    111
    112

000000 Total Errors

000069 Total Symbols
     0x          Equ   0012 anim
     0x          Equ   0011 anim_frame
     0x          Equ   0014 anim_frame_duration
     0x          Equ   001D collision_flags
     1x          Label C029 COPY8k
     1x          Label C040 COPY8k1
     1x          Label C052 COPY8k2
     1x          Label C058 COPY8k3
     2x          Label A029 GameModeEngine
     0x          Label A000 GameModeEngineLoader
     1x          Label A029 GameModeEngine_End
     0x          Equ   0038 gravity
     0x          Equ   0000 id
     0x          Equ   000B mapping_frame
     0x          Equ   001F next_object
     0x          Equ   002D number_of_dynamic_objects
     0x          Equ   0003 number_of_level_objects
     0x          Equ   0002 number_of_reserved_objects
     1x          Equ   001F object_size
     0x          Equ   0018 objoff_01
     0x          Equ   0019 objoff_02
     0x          Equ   001A objoff_03
     0x          Equ   001B objoff_04
     0x          Equ   001C objoff_05
     0x          Equ   0013 prev_anim
     0x          Equ   0008 priority
     0x          Equ   0004 render_coordinate1_mask
     0x          Equ   0008 render_coordinate2_mask
     0x          Equ   0002 render_flags
     0x          Equ   0080 render_onscreen_mask
     0x          Equ   0020 render_staticmappings_mask
     0x          Equ   0040 render_subobjects_mask
     0x          Equ   0001 render_xmirror_mask
     0x          Equ   0010 render_ycheckonscreen_mask
     0x          Equ   0002 render_ymirror_mask
     0x          Equ   0016 routine
     0x          Equ   0017 routine_secondary
     0x          Equ   0015 status
     0x          Equ   0002 status_inair_mask
     0x          Equ   0001 status_leftfacing_mask
     0x          Equ   0008 status_onobject_mask
     0x          Equ   0020 status_pushing_mask
     0x          Equ   0010 status_rolljumping_mask
     0x          Equ   0008 status_sec_3_mask
     0x          Equ   0010 status_sec_4_mask
     0x          Equ   0020 status_sec_5_mask
     0x          Equ   0040 status_sec_6_mask
     0x          Equ   0001 status_sec_hasShield_mask
     0x          Equ   0004 status_sec_hasSpeedShoes_mask
     0x          Equ   0002 status_sec_isInvincible_mask
     0x          Equ   0080 status_sec_isSliding_mask
     0x          Equ   0004 status_spinning_mask
     0x          Equ   0080 status_tobedeleted_mask
     0x          Equ   0040 status_underwater_mask
     0x          Equ   001E subtype
     0x          Label A00A SwapVideoPage
     1x          Label A000 WaitVBL
     1x          Label A005 WaitVBL_01
     0x          Equ   000A width_pixels
     0x          Equ   0003 x_pixel
     2x          Equ   0003 x_pos
     0x          Equ   0010 x_radius
     0x          Equ   0005 x_sub
     0x          Equ   000B x_vel
     0x          Equ   0005 y_pixel
     0x          Equ   0005 y_pos
     0x          Equ   000F y_radius
     0x          Equ   0007 y_sub
     0x          Equ   000D y_vel

