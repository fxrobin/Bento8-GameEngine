/*--------------------------------------------------------------*
 * Compilé avec C6809 v0.83                                     *
 *--------------------------------------------------------------*
 * Fichier source      : .\Sonic2\GeneratedCode\TITLESCR\MainEngine.asm
 * Fichier destination : .\Sonic2\GeneratedCode\TMP.BIN
 * Contenu :
 *     Main     0:MAIN.ASM     3612
 *     Include  0:CONSTANT.ASM 5233
 *     Include  0:WAITVBL.ASM  1795
 *     Include  0:READJPDS.ASM 1729
 *     Include  0:RUNOBJTS.ASM 1312
 *     Include  0:MRKOBJGN.ASM 481
 *     Include  0:DISPLSPR.ASM 2223
 *     Include  0:ANIMSPR.ASM  2002
 *     Include  0:OBJMOVE.ASM  752
 *     Include  0:OBJLOAD.ASM  1109
 *     Include  0:DELETOBJ.ASM 2696
 *     Include  0:CLEAROBJ.ASM 586
 *     Include  0:CHECKSPR.ASM 8680
 *     Include  0:ERASESPR.ASM 4626
 *     Include  0:UNSETDSP.ASM 2796
 *     Include  0:DRAWSPR.ASM  5445
 *     Include  0:BGBALLOC.ASM 1029
 *     Include  0:BGBFREE.ASM  1879
 *     Include  0:IMAGEIDX.ASM 2143
 *     Include  0:ANIMSCPT.ASM 495
 *     Include  0:OBJINDEX.ASM 59
 *     Include  0:LOADACT.ASM  32
 *--------------------------------------------------------------*/

Macro Pass
Pass1
Pass2
    171                                   INCLUD CONSTANT
    172                           * --------------------------------------->>
    173                           * Constants
    174                           *
    175                           * Naming convention
    176                           * -----------------
    177                           * - lower case
    178                           * - underscore-separated names
    179                           *
    180                           * --------------------------------------->>
    181
    182                           * =======================================>>
    183                           * TO8 Registers
    184                           * =======================================>>
    185
    186                  6049     dk_lecteur                    equ $6049
    187                  604A     dk_piste                      equ $604A
    188                  604B     dk_pisteL                     equ $604B
    189                  604C     dk_secteur                    equ $604C
    190                  604F     dk_destination                equ $604F
    191
    192                           * =======================================>>
    193                           * Display Constants
    194                           * =======================================>>
    195
    196                  00A0     screen_width                  equ 160 ; s>>
    197                  001C     screen_top                    equ 28 ; in>>
    198                  00E4     screen_bottom                 equ 200+28 >>
    199                  0008     nb_priority_levels            equ 8   ; n>>
    200
    201                           * =======================================>>
    202                           * Physics Constants
    203                           * =======================================>>
    204
    205                  0038     gravity                       equ $38 ; G>>
    206
    207                           * =======================================>>
    208                           * Animation Constants
    209                           * =======================================>>
    210
    211                  00FF     _resetAnim                    equ $FF
    212                  00FE     _goBackNFrames                equ $FE
    213                  00FD     _goToAnimation                equ $FD
    214                  00FC     _nextRoutine                  equ $FC
    215                  00FB     _resetAnimAndSubRoutine       equ $FB
    216                  00FA     _nextSubRoutine               equ $FA
    217
    218                           * =======================================>>
    219                           * Images Constants
    220                           * =======================================>>
    221
    222                  0000     page_bckdraw_routine          equ 0
    223                  0001     bckdraw_routine               equ 1
    224                  0003     page_draw_routine             equ 3
    225                  0004     draw_routine                  equ 4
    226                  0006     page_erase_routine            equ 6
    227                  0007     erase_routine                 equ 7
    228                  0009     erase_nb_cell                 equ 9
    229                  000A     image_x1_offset_l             equ 10
    230                  000B     image_y1_offset_l             equ 11
    231                  000C     image_x_size_l                equ 12
    232                  000D     image_y_size_l                equ 13
    233                  000E     image_meta_size               equ 14 ; nu>>
    234
    235                           * =======================================>>
    236                           * Object Constants
    237                           * =======================================>>
    238
    239                  0002     nb_reserved_objects           equ 2
    240                  0015     nb_dynamic_objects            equ 21
    241                  0003     nb_level_objects              equ 3
    242                  0040     nb_objects                    equ 64 * ma>>
    243
    244                           * --------------------------------------->>
    245                           * Object Status Table offsets
    246                           * --------------------------------------->>
    247
    248                  0052     object_size                   equ 82 ; th>>
    249                  0052     next_object                   equ object_>>
    250
    251                  0000     id                            equ 0      >>
    252                  0001     subtype                       equ 1      >>
    253                  0002     render_flags                  equ 2
    254
    255                           * --- render_flags bitfield variables --->>
    256                  0001     render_xmirror_mask           equ $01 ; (>>
    257                  0002     render_ymirror_mask           equ $02 ; (>>
    258                  0004     render_playfieldcoord_mask    equ $04 ; (>>
    259                  0008     render_hide_mask              equ $08 ; (>>
    260                  0010     render_fixedoverlay_mask      equ $10 ; (>>
    261                  0020     render_todelete_mask          equ $20 ; (>>
    262                  0040     render_free2_mask             equ $40 ; (>>
    263                  0080     render_free3_mask             equ $80 ; (>>
    264                            
    265                  0003     priority                      equ 3      >>
    266                  0004     anim                          equ 4  ; an>>
    267                  0006     prev_anim                     equ 6  ; an>>
    268                  0008     anim_frame                    equ 8      >>
    269                  0009     anim_frame_duration           equ 9      >>
    270                  000A     mapping_frame                 equ 10 ; an>>
    271                  000C     x_pos                         equ 12 ; an>>
    272                  000E     x_sub                         equ 14     >>
    273                  000F     y_pos                         equ 15 ; an>>
    274                  0011     y_sub                         equ 17     >>
    275                  0012     xy_pixel                      equ 18     >>
    276                  0012     x_pixel                       equ 18     >>
    277                  0013     y_pixel                       equ 19     >>
    278                  0014     x_vel                         equ 20 ; an>>
    279                  0016     y_vel                         equ 22 ; an>>
    280                  0018     routine                       equ 24     >>
    281                  0019     routine_secondary             equ 25     >>
    282                  001A     status                        equ 26
    283
    284                           * --- status bitfield variables for objec>>
    285                  0001     status_x_orientation          equ   $01 ;>>
    286                  0002     status_y_orientation          equ   $02 ;>>
    287                  0004     status_bit2                   equ   $04 ;>>
    288                  0008     status_mainchar_standing      equ   $08 ;>>
    289                  0010     status_sidekick_standing      equ   $10 ;>>
    290                  0020     status_mainchar_pushing       equ   $20 ;>>
    291                  0040     status_sidekick_pushing       equ   $40 ;>>
    292                  0080     status_bit7                   equ   $80 ;>>
    293
    294                           * --- status bitfield variables for Main >>
    295                  0002     status_inair                  equ   $02 ;>>
    296                  0004     status_jumporroll             equ   $04 ;>>
    297                  0008     status_norgroundnorfall       equ   $08 ;>>
    298                  0010     status_jumpingafterrolling    equ   $10 ;>>
    299                  0020     status_pushing                equ   $20 ;>>
    300                  0040     status_underwater             equ   $40 ;>>
    301
    302                  001B     ext_variables                 equ 27 ; to>>
    303
    304                           * --------------------------------------->>
    305                           * reserved variables (engine)
    306
    307                  0029     rsv_render_flags              equ 41
    308
    309                           * --- rsv_render_flags bitfield variables>>
    310                  0001     rsv_render_checkrefresh_mask  equ $01 ; (>>
    311                  0002     rsv_render_erasesprite_mask   equ $02 ; (>>
    312                  0004     rsv_render_displaysprite_mask equ $04 ; (>>
    313                  0008     rsv_render_outofrange_mask    equ $08 ; (>>
    314
    315                  002A     rsv_prev_anim                 equ 42 ; an>>
    316                  002C     rsv_curr_mapping_frame        equ 44 ; an>>
    317                  002E     rsv_xy1_pixel                 equ 46     >>
    318                  002E     rsv_x1_pixel                  equ 46     >>
    319                  002F     rsv_y1_pixel                  equ 47     >>
    320                  0030     rsv_xy2_pixel                 equ 48     >>
    321                  0030     rsv_x2_pixel                  equ 48     >>
    322                  0031     rsv_y2_pixel                  equ 49     >>
    323
    324                           * --------------------------------------->>
    325                           * reserved variables (engine) - buffer sp>>
    326
    327                  0032     rsv_buffer_0                  equ 50 ; St>>
    328                  0032     rsv_priority_0                equ 50 ; in>>
    329                  0033     rsv_priority_prev_obj_0       equ 51 ; an>>
    330                  0035     rsv_priority_next_obj_0       equ 53 ; an>>
    331                  0037     rsv_prev_mapping_frame_0      equ 55 ; an>>
    332                  0039     rsv_bgdata_0                  equ 57 ; an>>
    333                  003B     rsv_prev_xy_pixel_0           equ 59 ;
    334                  003B     rsv_prev_x_pixel_0            equ 59 ; pr>>
    335                  003C     rsv_prev_y_pixel_0            equ 60 ; pr>>
    336                  003D     rsv_prev_xy1_pixel_0          equ 61 ;
    337                  003D     rsv_prev_x1_pixel_0           equ 61 ; pr>>
    338                  003E     rsv_prev_y1_pixel_0           equ 62 ; pr>>
    339                  003F     rsv_prev_xy2_pixel_0          equ 63 ;
    340                  003F     rsv_prev_x2_pixel_0           equ 63 ; pr>>
    341                  0040     rsv_prev_y2_pixel_0           equ 64 ; pr>>
    342                  0041     rsv_onscreen_0                equ 65 ; ha>>
    343
    344                  0042     rsv_buffer_1                  equ 66 ; St>>
    345                  0042     rsv_priority_1                equ 66 ; in>>
    346                  0043     rsv_priority_prev_obj_1       equ 67 ; an>>
    347                  0045     rsv_priority_next_obj_1       equ 69 ; an>>
    348                  0047     rsv_prev_mapping_frame_1      equ 71 ; an>>
    349                  0049     rsv_bgdata_1                  equ 73 ; an>>
    350                  004B     rsv_prev_xy_pixel_1           equ 75 ;
    351                  004B     rsv_prev_x_pixel_1            equ 75 ; pr>>
    352                  004C     rsv_prev_y_pixel_1            equ 76 ; pr>>
    353                  004D     rsv_prev_xy1_pixel_1          equ 77 ;
    354                  004D     rsv_prev_x1_pixel_1           equ 77 ; pr>>
    355                  004E     rsv_prev_y1_pixel_1           equ 78 ; pr>>
    356                  004F     rsv_prev_xy2_pixel_1          equ 79 ;
    357                  004F     rsv_prev_x2_pixel_1           equ 79 ; pr>>
    358                  0050     rsv_prev_y2_pixel_1           equ 80 ; pr>>
    359                  0051     rsv_onscreen_1                equ 81 ; ha>>
    360
    361                  0000     buf_priority                  equ 0  ; of>>
    362                  0001     buf_priority_prev_obj         equ 1  ;
    363                  0003     buf_priority_next_obj         equ 3  ;
    364                  0005     buf_prev_mapping_frame        equ 5  ;
    365                  0007     buf_bgdata                    equ 7  ;
    366                  0009     buf_prev_xy_pixel             equ 9  ;
    367                  0009     buf_prev_x_pixel              equ 9  ;
    368                  000A     buf_prev_y_pixel              equ 10 ;
    369                  000B     buf_prev_xy1_pixel            equ 11 ;
    370                  000B     buf_prev_x1_pixel             equ 11 ;
    371                  000C     buf_prev_y1_pixel             equ 12 ;
    372                  000D     buf_prev_xy2_pixel            equ 13 ;
    373                  000D     buf_prev_x2_pixel             equ 13 ;
    374                  000E     buf_prev_y2_pixel             equ 14 ;
    375                  000F     buf_onscreen                  equ 15 ;
    376
     10        6100                       org   $6100
     11
     12  8     6100 BD   7C27             jsr   LoadAct
     13
     14                           * =======================================>>
     15                           * Main Loop
     16                           * =======================================>>
     17        6103               LevelMainLoop
     18  8     6103 BD   6F62             jsr   WaitVBL
     19  8     6106 BD   6F9D             jsr   ReadJoypads
     20  8     6109 BD   6FB5             jsr   RunObjects
     21  8     610C BD   7243             jsr   CheckSpritesRefresh
     22  8     610F BD   7525             jsr   EraseSprites
     23  8     6112 BD   7688             jsr   UnsetDisplayPriority
     24  8     6115 BD   7767             jsr   DrawSprites
     25  3     6118 20   E9               bra   LevelMainLoop
     26
     27                           * =======================================>>
     28                           * Global Data
     29                           *
     30                           * Naming convention
     31                           * -----------------
     32                           * - underscore-separated names
     33                           * - first letter of each word in upper ca>>
     34                           *
     35                           * Templates
     36                           * ---------
     37                           * - Glb_*        : global variable
     38                           * - Tbl_*        : data table
     39                           * - Lst_*        : list is a data table w>>
     40                           * - Obj_*        : address of an object i>>
     41                           *
     42                           * - *_Object_RAM : sub group of objects
     43                           * - *_end        : data end label
     44                           *
     45                           * =======================================>>
     46
     47                           * --------------------------------------->>
     48                           * Display
     49                           * --------------------------------------->>
     50                            
     51        611A 00            Glb_Cur_Wrk_Screen_Id         fcb   $00  >>
     52        611B 0000          Glb_Camera_X_Pos              fdb   $0000>>
     53        611D 0000          Glb_Camera_Y_Pos              fdb   $0000>>
     54        611F 0000          Glb_Sprite_Screen_Pos_PartA   fdb   $0000>>
     55        6121 0000          Glb_Sprite_Screen_Pos_PartB   fdb   $0000>>
     56
     57                           * --------------------------------------->>
     58                           * Background Backup Cells - BBC
     59                           * --------------------------------------->>
     60
     61                           * ----- Cell variables
     62                  0000     nb_cells                      equ   0
     63                  0001     cell_start                    equ   1
     64                  0003     cell_end                      equ   3
     65                  0005     next_entry                    equ   5
     66                  0007     entry_size                    equ   7
     67
     68                           * ----- Cells List
     69                  0082     nb_free_cells                 equ   130
     70                  0040     cell_size                     equ   64   >>
     71                  6000     cell_start_adr                equ   $6000>>
     72
     73        6123 6125          Lst_FreeCellFirstEntry_0      fdb   Lst_F>>
     74        6125 82            Lst_FreeCell_0                fcb   nb_fr>>
     75        6126 3F80                                        fdb   cell_>>
     76        6128 6000                                        fdb   cell_>>
     77        612A 0000                                        fdb   $0000>>
     78        612C                                             rmb   (entr>>
     79                            
     80        62F2 62F4          Lst_FreeCellFirstEntry_1      fdb   Lst_F>>
     81        62F4 82            Lst_FreeCell_1                fcb   nb_fr>>
     82        62F5 3F80                                        fdb   cell_>>
     83        62F7 6000                                        fdb   cell_>>
     84        62F9 0000                                        fdb   $0000>>
     85        62FB                                             rmb   (entr>>
     86                           * --------------------------------------->>
     87                           * Display Priority Structure - DPS
     88                           * --------------------------------------->>
     89
     90        64C1               DPS_buffer_0
     91        64C1               Tbl_Priority_First_Entry_0    rmb   2+(nb>>
     92        64D3               Tbl_Priority_Last_Entry_0     rmb   2+(nb>>
     93        64E5 64E7          Lst_Priority_Unset_0          fdb   Lst_P>>
     94        64E7                                             rmb   (nb_o>>
     95        6567               DPS_buffer_1
     96        6567               Tbl_Priority_First_Entry_1    rmb   2+(nb>>
     97        6579               Tbl_Priority_Last_Entry_1     rmb   2+(nb>>
     98        658B 658D          Lst_Priority_Unset_1          fdb   Lst_P>>
     99        658D                                             rmb   (nb_o>>
    100                            
    101                  0000     buf_Tbl_Priority_First_Entry  equ   0
    102                  0012     buf_Tbl_Priority_Last_Entry   equ   Tbl_P>>
    103                  0024     buf_Lst_Priority_Unset        equ   Lst_P>>
    104
    105                           * --------------------------------------->>
    106                           * Sub Priority Objects List - SOL
    107                           * --------------------------------------->>
    108
    109        660D               Tbl_Sub_Object_Erase          rmb   nb_ob>>
    110        668D               Tbl_Sub_Object_Draw           rmb   nb_ob>>
    111
    112                           * --------------------------------------->>
    113                           * Object Status Table - OST
    114                           * --------------------------------------->>
    115                            
    116        670D               Object_RAM *@globals
    117        670D               Reserved_Object_RAM
    118        670D 02            Obj_MainCharacter             fcb   $02
    119        670E 03                                          fcb   $03  >>
    120        670F                                             rmb   objec>>
    121        675F               Obj_Sidekick                  rmb   objec>>
    122        67B1               Reserved_Object_RAM_End
    123
    124        67B1               Dynamic_Object_RAM            rmb   nb_dy>>
    125        6E6B               Dynamic_Object_RAM_End
    126
    127        6E6B               LevelOnly_Object_RAM                     >>
    128        6E6B               Obj_TailsTails                rmb   objec>>
    129        6EBD               Obj_SonicDust                 rmb   objec>>
    130        6F0F               Obj_TailsDust                 rmb   objec>>
    131        6F61               LevelOnly_Object_RAM_End
    132        6F61               Object_RAM_End
    133
    134                           * --------------------------------------->>
    135                           * Lifecycle
    136                           * --------------------------------------->>
    137
    138        6F61               Glb_MainCharacter_Is_Dead     rmb   $1,0
    139
    140                           * =======================================>>
    141                           * Routines
    142                           * =======================================>>
    377                                   INCLUD WAITVBL
    378                           *****************************************>>
    379                           * Attente VBL
    380                           * Alternance de la page 2 et 3 entre affi>>
    381                           * Alternance de la RAMA et RAM B dans l'e>>
    382                           * --------------------------------------->>
    383                           *
    384                           * Page Affichee par l'automate Video
    385                           * ----------------------------------
    386                           *   $E7DD determine la page affichee a l'>>
    387                           *   bit7=0 bit6=0 bit5=0 bit4=0 (#$0_) : >>
    388                           *   bit7=0 bit6=1 bit5=0 bit4=0 (#$4_) : >>
    389                           *   bit7=1 bit6=0 bit5=0 bit4=0 (#$8_) : >>
    390                           *   bit7=1 bit6=1 bit5=0 bit4=0 (#$C_) : >>
    391                           *   bit3 bit2 bit1 bit0  (#$_0 a #$_F) : >>
    392                           *   Remarque : bit5 et bit4 utilisable un>>
    393                           *
    394                           * Page en espace cartouche (ecriture dans>>
    395                           * --------------------------------------->>
    396                           *   $E7E6 determine la page visible dans >>
    397                           *   bit7 toujours a 0
    398                           *   bit6=1 : ecriture autorisee
    399                           *   bit5=1 : espace cartouche recouvert p>>
    400                           *   bit4=0 : CAS1N valide : banques 0-15 >>
    401                           *   bit5=1 bit4=0 bit3=0 bit2=0 bit1=0 bi>>
    402                           *   ...
    403                           *   bit5=1 bit4=0 bit3=1 bit2=1 bit1=1 bi>>
    404                           *   bit5=1 bit4=1 bit3=0 bit2=0 bit1=0 bi>>
    405                           *   ...
    406                           *   bit5=1 bit4=1 bit3=1 bit2=1 bit1=1 bi>>
    407                           *
    408                           * Demi-Page 0 en espace ecran (4000 a 5FF>>
    409                           * --------------------------------------->>
    410                           *   $E7C3 determine la demi-page de la pa>>
    411                           *   bit0=0 : 8Ko RAMA
    412                           *   bit0=1 : 8ko RAMB
    413                           *
    414                           *****************************************>>
    415        6F62               WaitVBL
    416  7     6F62 7D   E7E7             tst   $E7E7              * le fai>>
    417  3     6F65 2A   FB               bpl   WaitVBL            * tant q>>
    418        6F67               WaitVBL_01
    419  7     6F67 7D   E7E7             tst   $E7E7              * le fai>>
    420  3     6F6A 2B   FB               bmi   WaitVBL_01         * tant q>>
    421                            
    422  6     6F6C FC   6F97             ldd   Vint_runcount
    423  4     6F6F C3   0001             addd  #1
    424  6     6F72 FD   6F97             std   Vint_runcount
    425                            
    426        6F75               SwapVideoPage
    427  5     6F75 F6   6F83             ldb   am_SwapVideoPage+1 * charge>>
    428  2     6F78 C4   40               andb  #$40               * altern>>
    429        6F7A               screen_border_color *@globals
    430  2     6F7A CA   80               orb   #$80               * bit7=1>>
    431  5     6F7C F7   E7DD             stb   $E7DD              * change>>
    432  7     6F7F 73   6F83             com   am_SwapVideoPage+1 * altern>>
    433        6F82               am_SwapVideoPage
    434  2     6F82 C6   00               ldb   #$00
    435  2     6F84 C4   01               andb  #$01               * altern>>
    436  5     6F86 F7   611A             stb   Glb_Cur_Wrk_Screen_Id
    437  2     6F89 CA   62               orb   #$62               * bit6=1>>
    438  5     6F8B F7   E7E6             stb   $E7E6              * change>>
    439  5     6F8E F6   E7C3             ldb   $E7C3              * charge>>
    440  2     6F91 C8   01               eorb  #$01               * altern>>
    441  5     6F93 F7   E7C3             stb   $E7C3
    442  5     6F96 39                    rts
    443                            
    444        6F97               Vint_runcount rmb   $2,0 *@globals
    445
    446                                   INCLUD READJPDS
    447                           * --------------------------------------->>
    448                           * Controller Buttons
    449                           *
    450                  0001     c1_button_up_mask            equ   $01 *@>>
    451                  0002     c1_button_down_mask          equ   $02 *@>>
    452                  0004     c1_button_left_mask          equ   $04 *@>>
    453                  0008     c1_button_right_mask         equ   $08 *@>>
    454                  0010     c2_button_up_mask            equ   $10 *@>>
    455                  0020     c2_button_down_mask          equ   $20 *@>>
    456                  0040     c2_button_left_mask          equ   $40 *@>>
    457                  0080     c2_button_right_mask         equ   $80 *@>>
    458                  0040     c1_button_A_mask             equ   $40 *@>>
    459                  0080     c2_button_A_mask             equ   $80 *@>>
    460
    461        6F99               Joypads
    462        6F99               Joypads_Held
    463        6F99 00            Dpad_Held                    fcb   $00 *@>>
    464        6F9A 00            Fire_Held                    fcb   $00 *@>>
    465        6F9B               Joypads_Press
    466        6F9B 00            Dpad_Press                   fcb   $00 *@>>
    467        6F9C 00            Fire_Press                   fcb   $00 *@>>
    468
    469                           *****************************************>>
    470                           * Get joystick parameters
    471                           *
    472                           * Direction des Joypads
    473                           * ---------------------
    474                           * Registre: $E7CC (8bits)
    475                           *
    476                           * Joypad2     Joypad1
    477                           * 1111        1111 (0: appuye | 1: relach>>
    478                           * ||||_Haut   ||||_Haut
    479                           * |||__Bas    |||__Bas
    480                           * ||___Gauche ||___Gauche
    481                           * |____Droite |____Droite
    482                           *
    483                           * Boutons des Joypads
    484                           * -------------------
    485                           * Registre: $E7CD (8bits)
    486                           *
    487                           * 11 000000 (0: appuye | 1: relache)
    488                           * ||[------] 6 bits convertisseur numeriq>>
    489                           * ||_Fire Joypad1
    490                           * |__Fire Joypad2
    491                           *
    492                           * Variables globales: Joypads_Held, Joypa>>
    493                           * --------------------------------------->>
    494                           * (16 bits)
    495                           * Joypad2     Joypad1
    496                           * 0000        0000 (0: relache | 1: appuy>>
    497                           * ||||_Haut   ||||_Haut                  >>
    498                           * |||__Bas    |||__Bas                   >>
    499                           * ||___Gauche ||___Gauche                >>
    500                           * |____Droite |____Droite
    501                           *
    502                           *****************************************>>
    503                            
    504                                                                  *;>>
    505                                                                  *;>>
    506                                                                  *;>>
    507                                                                  *;>>
    508                                                                  *
    509                                                                  *;>>
    510        6F9D               ReadJoypads                            *R>>
    511                                                                  * >>
    512                                                                  * >>
    513                                                                  * >>
    514                                                                  * >>
    515                                                                  *
    516                                                                  *;>>
    517                                                                  *J>>
    518                                                                  * >>
    519                                                                  * >>
    520                                                                  * >>
    521                                                                  * >>
    522                                                                  * >>
    523                                                                  * >>
    524                                                                  * >>
    525                                                                  * >>
    526                                                                  * >>
    527                                                                  * >>
    528                                                                  * >>
    529                                                                  * >>
    530                                                                  * >>
    531  6     6F9D FC   E7CC             ldd   $E7CC                    * >>
    532  2     6FA0 43                    coma
    533  2     6FA1 53                    comb
    534  5     6FA2 B8   6F99             eora  Dpad_Held                * >>
    535  5     6FA5 B8   6F99             eora  Dpad_Held
    536  6     6FA8 FD   6F99             std   Joypads_Held             * >>
    537  5     6FAB B4   6F99             anda  Dpad_Held                * >>
    538  5     6FAE F4   6F9A             andb  Fire_Held
    539  6     6FB1 FD   6F9B             std   Joypads_Press            * >>
    540  5     6FB4 39                    rts                            * >>
    541                                                                  *;>>
    542
    543
    544                                   INCLUD RUNOBJTS
    545                           * --------------------------------------->>
    546                           * RunObjects
    547                           * ------------
    548                           * Subroutine to run objects code
    549                           *
    550                           * input REG : none
    551                           * --------------------------------------->>
    552                                                                    >>
    553                                                                    >>
    554                                                                    >>
    555                                                                    >>
    556                                                                    >>
    557                                                                    >>
    558                                                                    >>
    559        6FB5               RunObjects                               >>
    560                                                                    >>
    561                                                                    >>
    562  3     6FB5 CE   670D             ldu   #Object_RAM                >>
    563                                                                    >>
    564                                                                    >>
    565                                                                    >>
    566                                                                    >>
    567                                                                    >>
    568                                                                    >>
    569                                                                    >>
    570        6FB8               RunObjects_01                            >>
    571                                                                    >>
    572                                                                    >>
    573                                                                    >>
    574                                                                    >>
    575  7     6FB8 7D   6F61             tst   Glb_MainCharacter_Is_Dead  >>
    576  3     6FBB 26   23               bne   RunObjectsWhenPlayerIsDead >>
    577                                                                    >>
    578                                                                    >>
    579                                                                    >>
    580                                                                    >>
    581                                                                    >>
    582                                                                    >>
    583                                                                    >>
    584                                                                    >>
    585                                                                    >>
    586                                                                    >>
    587        6FBD               RunObject                                >>
    588  2     6FBD 86   00               lda   #$00
    589  4+0   6FBF E6   C4               ldb   ,u                         >>
    590  3     6FC1 27   13               beq   RunNextObject              >>
    591
    592  4     6FC3 108E 7C27             ldy   #Obj_Index_Page
    593  4+4   6FC7 A6   AB               lda   d,y                        >>
    594  5     6FC9 B7   E7E5             sta   $E7E5                      >>
    595  2     6FCC 86   00               lda   #$00
    596  2     6FCE 58                    aslb                             >>
    597  2     6FCF 49                    rola                             >>
    598  4     6FD0 108E 7C27             ldy   #Obj_Index_Address         >>
    599  7+7   6FD4 AD   BB               jsr   [d,y]                      >>
    600                                                                    >>
    601                                                                    >>
    602                                                                    >>
    603        6FD6               RunNextObject                            >>
    604  4+1   6FD6 33   C8 52            leau  next_object,u              >>
    605        6FD9               am_RunNextObject
    606  5     6FD9 1183 6F61             cmpu  #Object_RAM_End            >>
    607  3     6FDD 26   DE               bne   RunObject                  >>
    608        6FDF               RunObjects_End                           >>
    609  5     6FDF 39                    rts                              >>
    610                                                                    >>
    611                                                                    >>
    612                                                                    >>
    613                                                                    >>
    614        6FE0               RunObjectsWhenPlayerIsDead               >>
    615  3     6FE0 CE   670D             ldu   #Reserved_Object_RAM
    616  3     6FE3 8E   67B1             ldx   #Reserved_Object_RAM_End
    617  6     6FE6 BF   6FDB             stx   am_RunNextObject+2         >>
    618  7     6FE9 8D   D2               bsr   RunObject                  >>
    619                                                                    >>
    620                                                                    >>
    621  3     6FEB CE   6E6B             ldu   #LevelOnly_Object_RAM
    622  3     6FEE 8E   6F61             ldx   #LevelOnly_Object_RAM_End
    623  6     6FF1 BF   6FDB             stx   am_RunNextObject+2         >>
    624  7     6FF4 8D   C7               bsr   RunObject                  >>
    625                                                                    >>
    626  3     6FF6 8E   6F61             ldx   #Object_RAM_End            >>
    627  6     6FF9 BF   6FDB             stx   am_RunNextObject+2
    628  5     6FFC 39                    rts
    629                                                                    >>
    630                                                                    >>
    631                                                                    >>
    632                                                                    >>
    633                                                                    >>
    634                                                                    >>
    635                                                                    >>
    636                                                                    >>
    637                                                                    >>
    638                                                                    >>
    639                                                                    >>
    640                                                                    >>
    641                                                                    >>
    642                            
    643                                                                    >>
    644                                                                    >>
    645                                                                    >>
    646                                                                    >>
    647
    648                                   INCLUD MRKOBJGN
    649                           * --------------------------------------->>
    650                           * MarkObjGone
    651                           * -----------
    652                           * Subroutine to destroy an object that is>>
    653                           * -- TODO --
    654                           * waiting for camera implementation
    655                           *
    656                           * input REG : none
    657                           * clear REG : none
    658                           * --------------------------------------->>
    659
    660                                                                  *;>>
    661                                                                  *;>>
    662                                                                  *;>>
    663                                                                  *
    664                                                                  *;>>
    665                                                                  *;>>
    666                                                                  *;>>
    667        6FFD               MarkObjGone *@globals                  *M>>
    668                                                                  * >>
    669                                                                  * >>
    670  3     6FFD 20   06               bra   DisplaySprite            * >>
    671                                                                  *+>>
    672                                                                  * >>
    673                                                                  * >>
    674                                                                  * >>
    675                                                                  * >>
    676                                                                  * >>
    677                                                                  * >>
    678                                                                  *
    679                                                                  *+>>
    680                                                                  * >>
    681                                                                  * >>
    682                                                                  * >>
    683                                                                  * >>
    684                                                                  *+>>
    685                                                                  * >>
    686
    687                                   INCLUD DISPLSPR
    688                           * --------------------------------------->>
    689                           * DisplaySprite
    690                           * -------------
    691                           * Subroutine to manage sprite priority.
    692                           * Object's priority is read and object is>>
    693                           * priority: 0 - unregistred
    694                           * priority: 1 - register non moving overl>>
    695                           * priority; 2-8 - register moving sprite >>
    696                           *
    697                           * Unlike original S2 code, sprite priorit>>
    698                           * it allows to keep an exact sprite order>>
    699                           *
    700                           * DisplaySprite
    701                           * input REG : [u] object pointer (OST)
    702                           *
    703                           * DisplaySprite_x
    704                           * input REG : [x] object pointer (OST)
    705                           * --------------------------------------->>
    706                            
    707        6FFF               DisplaySprite_x *@globals
    708  5+6   6FFF 34   56               pshs  d,x,u
    709  6     7001 1F   13               tfr   x,u
    710  3     7003 20   02               bra   DSP_Start
    711                            
    712        7005               DisplaySprite *@globals
    713  5+6   7005 34   56               pshs  d,x,u
    714                            
    715        7007               DSP_Start
    716  4+1   7007 A6   42               lda   render_flags,u
    717  2     7009 84   F7               anda  #:render_hide_mask         >>
    718  4+1   700B A7   42               sta   render_flags,u
    719
    720  5     700D B6   611A             lda   Glb_Cur_Wrk_Screen_Id      >>
    721  3     7010 26   09               bne   DSP_SetBuffer1
    722                            
    723        7012               DSP_SetBuffer0
    724  4+1   7012 30   C8 32            leax  rsv_buffer_0,u             >>
    725  4     7015 108E 64C1             ldy   #DPS_buffer_0              >>
    726  3     7019 20   07               bra   DSP_BufferPositionned
    727                            
    728        701B               DSP_SetBuffer1
    729  4+1   701B 30   C8 42            leax  rsv_buffer_1,u             >>
    730  4     701E 108E 6567             ldy   #DPS_buffer_1              >>
    731                            
    732        7022               DSP_BufferPositionned
    733  4+1   7022 A6   43               lda   priority,u                 >>
    734  4+1   7024 A1   00               cmpa  buf_priority,x
    735  3     7026 27   1C               beq   DSP_rts                    >>
    736  4+1   7028 E6   00               ldb   buf_priority,x
    737  3     702A 26   3F               bne   DSP_ChangePriority
    738                            
    739        702C               DSP_InitPriority
    740  4+1   702C A7   00               sta   buf_priority,x             >>
    741  2     702E 48                    asla                             >>
    742                            
    743        702F               DSP_CheckLastEntry
    744  4+1   702F 31   A8 12            leay  buf_Tbl_Priority_Last_Entry>>
    745  6+1   7032 6D   A6               tst   a,y                        >>
    746  3     7034 26   10               bne   DSP_addToExistingNode      >>
    747                            
    748        7036               DSP_addFirstNode
    749  5+1   7036 EF   A6               stu   a,y                        >>
    750  4+1   7038 31   A8 EE            leay  buf_Tbl_Priority_First_Entr>>
    751  5+1   703B EF   A6               stu   a,y                        >>
    752  3     703D CC   0000             ldd   #0
    753  5+1   7040 ED   01               std   buf_priority_prev_obj,x    >>
    754  5+1   7042 ED   03               std   buf_priority_next_obj,x
    755                            
    756        7044               DSP_rts
    757  5+8   7044 35   D6               puls  d,x,u,pc                   >>
    758                            
    759        7046               DSP_addToExistingNode
    760  5+1   7046 AE   A6               ldx   a,y                        >>
    761  5     7048 F6   611A             ldb   Glb_Cur_Wrk_Screen_Id
    762  3     704B 26   0E               bne   DSP_LinkBuffer1
    763  5+1   704D EF   88 35            stu   rsv_priority_next_obj_0,x  >>
    764  5+1   7050 AF   C8 33            stx   rsv_priority_prev_obj_0,u  >>
    765  6+1   7053 6F   C8 35            clr   rsv_priority_next_obj_0,u  >>
    766  6+1   7056 6F   C8 36            clr   rsv_priority_next_obj_0+1,u>>
    767  3     7059 20   0C               bra   DSP_LinkCurWithPrev
    768        705B               DSP_LinkBuffer1
    769  5+1   705B EF   88 45            stu   rsv_priority_next_obj_1,x  >>
    770  5+1   705E AF   C8 43            stx   rsv_priority_prev_obj_1,u  >>
    771  6+1   7061 6F   C8 45            clr   rsv_priority_next_obj_1,u  >>
    772  6+1   7064 6F   C8 46            clr   rsv_priority_next_obj_1+1,u>>
    773                            
    774        7067               DSP_LinkCurWithPrev
    775  5+1   7067 EF   A6               stu   a,y                        >>
    776  5+8   7069 35   D6               puls  d,x,u,pc                   >>
    777                            
    778        706B               DSP_ChangePriority
    779  4+1   706B 31   A8 24            leay  buf_Lst_Priority_Unset,y
    780  5+3   706E EF   B4               stu   [,y]                       >>
    781  4+1   7070 31   22               leay  2,y
    782  6+0   7072 10AF A4               sty   ,y                         >>
    783  4+1   7075 31   A8 DA            leay  -buf_Lst_Priority_Unset-2,y>>
    784  2     7078 81   00               cmpa  #0
    785  3     707A 26   B3               bne   DSP_CheckLastEntry         >>
    786  5+8   707C 35   D6               puls  d,x,u,pc                   >>
    787
    788                            
    789                                                                  *;>>
    790                                                                  *;>>
    791                                                                  *;>>
    792                                                                  *
    793                                                                  *;>>
    794                                                                  *
    795                                                                  *;>>
    796                                                                  *D>>
    797                                                                  * >>
    798                                                                  * >>
    799                                                                  * >>
    800                                                                  * >>
    801                                                                  * >>
    802                            
    803                                                                  * >>
    804                                                                  * >>
    805                                                                  * >>
    806                            
    807                                                                  * >>
    808                                                                  * >>
    809                                                                  *
    810                                                                  *r>>
    811                            
    812                                                                  * >>
    813                                                                  *;>>
    814
    815                                   INCLUD ANIMSPR
    816                           * --------------------------------------->>
    817                           * Subroutine to animate a sprite using an>>
    818                           *
    819                           *   this function also change render flag>>
    820                           *   the status byte;
    821                           *
    822                           * input REG : [u] pointeur sur l'objet
    823                           *
    824                           * --------------------------------------->>
    825
    826                  00FF     resetAnim              equ $FF
    827                  00FE     goBackNFrames          equ $FE ; followed>>
    828                  00FD     goToAnimation          equ $FD ; followed>>
    829                  00FC     nextRoutine            equ $FC
    830                  00FB     resetAnimAndSubRoutine equ $FB
    831                  00FA     nextSubRoutine         equ $FA
    832
    833                                                                    >>
    834                                                                    >>
    835                                                                    >>
    836                                                                    >>
    837                                                                    >>
    838                                                                    >>
    839                                                                    >>
    840        707E               AnimateSprite * @globals                 >>
    841                                                                    >>
    842  5+1   707E AE   44               ldx   anim,u                     >>
    843  6+1   7080 AC   46               cmpx  prev_anim,u                >>
    844  3     7082 27   08               beq   Anim_Run                   >>
    845  5+1   7084 AF   46               stx   prev_anim,u                >>
    846  2     7086 C6   00                     ldb   #0
    847  4+1   7088 E7   48               stb   anim_frame,u               >>
    848  4+1   708A E7   49               stb   anim_frame_duration,u      >>
    849                                                                    >>
    850        708C               Anim_Run                                 >>
    851  6+1   708C 6A   49               dec   anim_frame_duration,u      >>
    852  3     708E 2A   23               bpl   Anim_Wait                  >>
    853                                   * no offset table                >>
    854                                   * anim is the address of anim    >>
    855  4+1   7090 E6   1F               ldb   -1,x
    856  4+1   7092 E7   49                     stb   anim_frame_duration,u>>
    857                                                                    >>
    858  4+1   7094 E6   48               ldb   anim_frame,u               >>
    859  2     7096 58                    aslb
    860  4+1   7097 31   85               leay  b,x
    861  5+0   7099 EC   A4               ldd   ,y                         >>
    862                                   * bmi   Anim_End_FF              >>
    863  2     709B 81   FA                     cmpa  #$FA                 >>
    864  3     709D 24   15                     bhs   Anim_End_FF          >>
    865                                                                    >>
    866        709F               Anim_Next                                >>
    867                                      * ne pas utiliser             >>
    868  5+1   709F ED   4A               std   mapping_frame,u            >>
    869  4+1   70A1 E6   C8 1A            ldb   status,u                   >>
    870  2     70A4 C4   03               andb  #status_x_orientation+statu>>
    871  5     70A6 F7   70AE             stb   Anim_dyn+1
    872                                                                    >>
    873  4+1   70A9 A6   42               lda   render_flags,u             >>
    874  2     70AB 84   FC               anda  #:(render_xmirror_mask+rend>>
    875        70AD               Anim_dyn
    876  2     70AD 8A   00               ora   #$00                       >>
    877                                                                    >>
    878  4+1   70AF A7   42               sta   render_flags,u
    879  6+1   70B1 6C   48               inc   anim_frame,u               >>
    880                                                                    >>
    881        70B3               Anim_Wait                                >>
    882  5     70B3 39                    rts                              >>
    883                                                                    >>
    884                                                                    >>
    885        70B4               Anim_End_FF                              >>
    886  2     70B4 4C                    inca                             >>
    887  3     70B5 26   08               bne   Anim_End_FE                >>
    888  2     70B7 C6   00                     ldb   #0
    889  4+1   70B9 E7   48               stb   anim_frame,u               >>
    890  5+0   70BB EC   84               ldd   ,x                         >>
    891  3     70BD 20   E0               bra   Anim_Next                  >>
    892                                                                    >>
    893                                                                    >>
    894        70BF               Anim_End_FE                              >>
    895  2     70BF 4C                    inca                             >>
    896  3     70C0 26   0E               bne   Anim_End_FD                >>
    897  4+1   70C2 A6   48               lda   anim_frame,u
    898  5     70C4 F7   70C8             stb   Anim_End_FE_dyn+1          >>
    899        70C7               Anim_End_FE_dyn
    900  2     70C7 80   00               suba  #$00                       >>
    901  4+1   70C9 A7   48               sta   anim_frame,u               >>
    902                                                                    >>
    903  2     70CB 48                    asla
    904  5+1   70CC EC   86               ldd   a,x                        >>
    905  3     70CE 20   CF               bra   Anim_Next                  >>
    906                                                                    >>
    907                                                                    >>
    908        70D0               Anim_End_FD                              >>
    909  2     70D0 4C                    inca                             >>
    910  3     70D1 26   05               bne   Anim_End_FC                >>
    911  5+1   70D3 EC   21               ldd   1,y                        >>
    912  5+1   70D5 ED   44               std   anim,u                     >>
    913  5     70D7 39                    rts                              >>
    914                                                                    >>
    915                                                                    >>
    916        70D8               Anim_End_FC                              >>
    917  2     70D8 4C                    inca                             >>
    918  3     70D9 26   0F               bne   Anim_End_FB                >>
    919  4+1   70DB E6   C8 18            ldb   routine,u
    920  2     70DE CB   03               addb  #$03
    921  4+1   70E0 E7   C8 18            stb   routine,u                  >>
    922  2     70E3 86   00               lda   #0
    923  4+1   70E5 A7   49               sta   anim_frame_duration,u      >>
    924  6+1   70E7 6C   48               inc   anim_frame,u               >>
    925  5     70E9 39                    rts                              >>
    926                                                                    >>
    927                                                                    >>
    928        70EA               Anim_End_FB                              >>
    929  2     70EA 4C                    inca                             >>
    930  3     70EB 26   08               bne   Anim_End_FA                >>
    931  2     70ED 86   00               lda   #0
    932  4+1   70EF A7   48               sta   anim_frame,u               >>
    933  4+1   70F1 A7   C8 19            sta   routine_secondary,u        >>
    934  5     70F4 39                    rts                              >>
    935                                                                    >>
    936                                                                    >>
    937        70F5               Anim_End_FA                              >>
    938  2     70F5 4C                    inca                             >>
    939  3     70F6 26   08               bne   Anim_End                   >>
    940  4+1   70F8 E6   C8 19            ldb   routine_secondary,u        >>
    941  2     70FB CB   03               addb  #$03
    942  4+1   70FD E7   C8 19            stb   routine_secondary,u
    943        7100               Anim_End
    944  5     7100 39                    rts                              >>
    945                                                                    >>
    946                                                                    >>
    947                                                                    >>
    948                                                                    >>
    949                                                                    >>
    950                                                                    >>
    951                                                                    >>
    952                                                                    >>
    953                                                                    >>
    954                                                                    >>
    955
    956                                   INCLUD OBJMOVE
    957                           * --------------------------------------->>
    958                           * Subroutine translating object speed to >>
    959                           * This moves the object horizontally and >>
    960                           * but does not apply gravity to it
    961                           * --------------------------------------->>
    962
    963                                                                  *;>>
    964                                                                  *;>>
    965                                                                  *;>>
    966                                                                  *;>>
    967                                                                  *;>>
    968                                                                  *
    969                                                                  *;>>
    970                                                                  *
    971                                                                  *;>>
    972        7101               ObjectMove                             *O>>
    973                                                                  * >>
    974                                                                  * >>
    975                                                                  * >>
    976                                                                  * >>
    977                                                                  * >>
    978                                                                  * >>
    979  4+1   7101 E6   C8 14            ldb   x_vel,u
    980  2     7104 1D                    sex                            ; >>
    981  5     7105 B7   7112             sta   am_ObjectMove_01+1
    982  5+1   7108 EC   C8 14            ldd   x_vel,u
    983  6+1   710B E3   4D               addd  x_pos+1,u                ; >>
    984  5+1   710D ED   4D               std   x_pos+1,u                ; >>
    985  4+1   710F A6   4C               lda   x_pos,u
    986        7111               am_ObjectMove_01
    987  2     7111 89   00               adca  #$00                     ; >>
    988  4+1   7113 A7   4C               sta   x_pos,u                  ; >>
    989                            
    990                                                                  * >>
    991                                                                  * >>
    992                                                                  * >>
    993                                                                  * >>
    994                                                                  * >>
    995                                                                  * >>
    996  4+1   7115 E6   C8 16            ldb   y_vel,u
    997  2     7118 1D                    sex                            ; >>
    998  5     7119 B7   7128             sta   am_ObjectMove_02+1
    999  5+1   711C EC   C8 16            ldd   y_vel,u
   1000  6+1   711F E3   C8 10            addd  y_pos+1,u                ; >>
   1001  5+1   7122 ED   C8 10            std   y_pos+1,u                ; >>
   1002  4+1   7125 A6   4F               lda   y_pos,u
   1003        7127               am_ObjectMove_02
   1004  2     7127 89   00               adca  #$00                     ; >>
   1005  4+1   7129 A7   4F               sta   y_pos,u                  ; >>
   1006  5     712B 39                    rts                            * >>
   1007                                                                  *;>>
   1008                                                                  *;>>
   1009
   1010                                   INCLUD OBJLOAD
   1011                           * --------------------------------------->>
   1012                           * Single object loading subroutine
   1013                           * Find an empty object array
   1014                           *
   1015                           * input  REG : [u] pointeur sur l'objet c>>
   1016                           * output REG : [x] pointeur sur l'objet l>>
   1017                           * --------------------------------------->>
   1018
   1019                                                                  *;>>
   1020                                                                  *;>>
   1021                                                                  *;>>
   1022                                                                  *;>>
   1023                                                                  *;>>
   1024                                                                  *
   1025                                                                  *;>>
   1026                                                                  *S>>
   1027                                                                  * >>
   1028                                                                  * >>
   1029                                                                  * >>
   1030                                                                  * >>
   1031                                                                  * >>
   1032                                                                  *
   1033                                                                  */>>
   1034                                                                  * >>
   1035                                                                  * >>
   1036                                                                  * >>
   1037                                                                  * >>
   1038                                                                  *
   1039                                                                  *r>>
   1040                                                                  * >>
   1041                                                                  *;>>
   1042                                                                  *;>>
   1043                                                                  *;>>
   1044                                                                  *;>>
   1045                                                                  *;>>
   1046                                                                  *
   1047                                                                  *;>>
   1048                                                                  *
   1049                                                                  *;>>
   1050        712C               SingleObjLoad2                         *S>>
   1051  6     712C 1F   31               tfr   u,x                      * >>
   1052  4+1   712E 30   88 52            leax  next_object,x            * >>
   1053  4     7131 8C   6E6B             cmpx  #Dynamic_Object_RAM_End  * >>
   1054  3     7134 27   0C               beq   SingleObjLoad2_02        * >>
   1055                                                                  * >>
   1056                                                                  * >>
   1057                                                                  * >>
   1058                                                                  * >>
   1059                                                                  * >>
   1060                                                                  * >>
   1061                                                                  * >>
   1062                                                                  * >>
   1063                                                                  *
   1064        7136               SingleObjLoad2_01                      *->>
   1065  6+0   7136 6D   84               tst   ,x                       * >>
   1066  3     7138 27   08               beq   SingleObjLoad2_02        * >>
   1067  4+1   713A 30   88 52            leax  next_object,x            * >>
   1068  4     713D 8C   6E6B             cmpx  #Dynamic_Object_RAM_End
   1069  3     7140 26   F4               bne   SingleObjLoad2_01        * >>
   1070                                                                  *
   1071        7142               SingleObjLoad2_02                      *r>>
   1072  5     7142 39                    rts                            * >>
   1073                                                                  *
   1074                                                                  * >>
   1075                                                                  *+>>
   1076                                                                  *.>>
   1077                                                                  *.>>
   1078                                                                  *
   1079                                                                  * >>
   1080                                                                  * >>
   1081                                                                  * >>
   1082                                                                  * >>
   1083                                                                  * >>
   1084                                                                  * >>
   1085                                                                  *
   1086                                                                  *.>>
   1087                                                                  *.>>
   1088                                                                  * >>
   1089                                                                  * >>
   1090                                                                  * >>
   1091                                                                  *;>>
   1092                                                                  *;>>
   1093                                                                  *;>>
   1094                                                                  *;>>
   1095                                                                  *;>>
   1096                                                                  *
   1097                                                                  *;>>
   1098                                                                  *
   1099                                                                  *;>>
   1100                                                                  *S>>
   1101                                                                  * >>
   1102                                                                  * >>
   1103                                                                  *
   1104                                                                  *->>
   1105                                                                  * >>
   1106                                                                  * >>
   1107                                                                  * >>
   1108                                                                  * >>
   1109                                                                  *
   1110                                                                  *r>>
   1111                                                                  * >>
   1112                                                                  *;>>
   1113
   1114
   1115                                   INCLUD DELETOBJ
   1116                           * --------------------------------------->>
   1117                           * DeleteObject
   1118                           * ------------
   1119                           * Subroutine to delete an object.
   1120                           * If the object is rendered as a sprite i>>
   1121                           * routine
   1122                           *
   1123                           * DeleteObject
   1124                           * input REG : [u] object pointer (OST)
   1125                           *
   1126                           * DeleteObject_x
   1127                           * input REG : [x] object pointer (OST)
   1128                           * --------------------------------------->>
   1129
   1130                                                                  *;>>
   1131                                                                  *;>>
   1132                                                                  *;>>
   1133                                                                  *
   1134                                                                  *;>>
   1135                                                                  *
   1136                                                                  *;>>
   1137        7143               DeleteObject_x *@globals               *D>>
   1138  5+6   7143 34   56               pshs  d,x,u                    * >>
   1139  6     7145 1F   13               tfr   x,u                      *;>>
   1140  3     7147 20   02               bra   DOB_Start
   1141                            
   1142        7149               DeleteObject *@globals                 *D>>
   1143  5+6   7149 34   56               pshs  d,x,u
   1144                            
   1145        714B               DOB_Start
   1146  4+1   714B A6   C8 41            lda   rsv_onscreen_0,u
   1147  3     714E 27   27               beq   DOB_RemoveFromDPSB0        >>
   1148
   1149        7150               DOB_ToDeleteFlag0
   1150  4+1   7150 A6   42               lda   render_flags,u
   1151  2     7152 8A   20               ora   #render_todelete_mask
   1152  4+1   7154 A7   42               sta   render_flags,u             >>
   1153                            
   1154        7156               DOB_Unset0
   1155  6     7156 BE   64E5             ldx   Lst_Priority_Unset_0       >>
   1156  5+0   7159 EF   84               stu   ,x
   1157  4+1   715B 30   02               leax  2,x
   1158  6     715D BF   64E5             stx   Lst_Priority_Unset_0
   1159                            
   1160        7160               DOB_TestOnscreen1
   1161  4+1   7160 A6   C8 51            lda   rsv_onscreen_1,u
   1162  3     7163 27   54               beq   DOB_RemoveFromDPSB1        >>
   1163                            
   1164        7165               DOB_ToDeleteFlag1
   1165  4+1   7165 A6   42               lda   render_flags,u
   1166  2     7167 8A   20               ora   #render_todelete_mask
   1167  4+1   7169 A7   42               sta   render_flags,u             >>
   1168                            
   1169        716B               DOB_Unset1
   1170  6     716B BE   658B             ldx   Lst_Priority_Unset_1       >>
   1171  5+0   716E EF   84               stu   ,x
   1172  4+1   7170 30   02               leax  2,x
   1173  6     7172 BF   658B             stx   Lst_Priority_Unset_1
   1174  5+8   7175 35   D6               puls  d,x,u,pc                   >>
   1175
   1176        7177               DOB_RemoveFromDPSB0
   1177  5+1   7177 EC   C8 33            ldd   rsv_priority_prev_obj_0,u  >>
   1178  3     717A 26   11               bne   DOB_ChainPrevB0
   1179                            
   1180  4+1   717C A6   C8 32            lda   rsv_priority_0,u
   1181  2     717F 48                    lsla
   1182  4     7180 108E 64C1             ldy   #Tbl_Priority_First_Entry_0>>
   1183  4+1   7184 31   A6               leay  a,y
   1184  5+1   7186 EC   C8 35            ldd   rsv_priority_next_obj_0,u
   1185  5+0   7189 ED   A4               std   ,y
   1186  3     718B 20   0A               bra   DOB_CheckPrioNextB0
   1187                            
   1188        718D               DOB_ChainPrevB0
   1189  5+1   718D EC   C8 35            ldd   rsv_priority_next_obj_0,u
   1190  6+1   7190 10AE C8 33            ldy   rsv_priority_prev_obj_0,u
   1191  5+1   7194 ED   A8 35            std   rsv_priority_next_obj_0,y
   1192
   1193        7197               DOB_CheckPrioNextB0
   1194  5+1   7197 EC   C8 35            ldd   rsv_priority_next_obj_0,u
   1195  3     719A 26   11               bne   DOB_ChainNextB0
   1196
   1197  4+1   719C A6   C8 32            lda   rsv_priority_0,u
   1198  2     719F 48                    lsla
   1199  4     71A0 108E 64D3             ldy   #Tbl_Priority_Last_Entry_0
   1200  4+1   71A4 31   A6               leay  a,y
   1201  5+1   71A6 EC   C8 33            ldd   rsv_priority_prev_obj_0,u
   1202  5+0   71A9 ED   A4               std   ,y
   1203  3     71AB 20   B3               bra   DOB_TestOnscreen1
   1204                            
   1205        71AD               DOB_ChainNextB0
   1206  5+1   71AD EC   C8 33            ldd   rsv_priority_prev_obj_0,u
   1207  6+1   71B0 10AE C8 35            ldy   rsv_priority_next_obj_0,u
   1208  5+1   71B4 ED   A8 33            std   rsv_priority_prev_obj_0,y
   1209  3     71B7 20   A7               bra   DOB_TestOnscreen1
   1210
   1211        71B9               DOB_RemoveFromDPSB1
   1212  5+1   71B9 EC   C8 43            ldd   rsv_priority_prev_obj_1,u
   1213  3     71BC 26   11               bne   DOB_ChainPrevB1
   1214                            
   1215  4+1   71BE A6   C8 42            lda   rsv_priority_1,u
   1216  2     71C1 48                    lsla
   1217  4     71C2 108E 6567             ldy   #Tbl_Priority_First_Entry_1>>
   1218  4+1   71C6 31   A6               leay  a,y
   1219  5+1   71C8 EC   C8 45            ldd   rsv_priority_next_obj_1,u
   1220  5+0   71CB ED   A4               std   ,y
   1221  3     71CD 20   0A               bra   DOB_CheckPrioNextB1
   1222                            
   1223        71CF               DOB_ChainPrevB1
   1224  5+1   71CF EC   C8 45            ldd   rsv_priority_next_obj_1,u
   1225  6+1   71D2 10AE C8 43            ldy   rsv_priority_prev_obj_1,u
   1226  5+1   71D6 ED   A8 45            std   rsv_priority_next_obj_1,y
   1227
   1228        71D9               DOB_CheckPrioNextB1
   1229  5+1   71D9 EC   C8 45            ldd   rsv_priority_next_obj_1,u
   1230  3     71DC 26   19               bne   DOB_ChainNextB1
   1231
   1232  4+1   71DE A6   C8 42            lda   rsv_priority_1,u
   1233  2     71E1 48                    lsla
   1234  4     71E2 108E 6579             ldy   #Tbl_Priority_Last_Entry_1
   1235  4+1   71E6 31   A6               leay  a,y
   1236  5+1   71E8 EC   C8 43            ldd   rsv_priority_prev_obj_1,u
   1237  5+0   71EB ED   A4               std   ,y
   1238  4+1   71ED A6   C8 41            lda   rsv_onscreen_0,u
   1239  3     71F0 26   03               bne   DOB_rts                    >>
   1240  8     71F2 BD   720B             jsr   ClearObj                   >>
   1241        71F5               DOB_rts                                *
   1242  5+8   71F5 35   D6               puls  d,x,u,pc
   1243                            
   1244        71F7               DOB_ChainNextB1
   1245  5+1   71F7 EC   C8 43            ldd   rsv_priority_prev_obj_1,u
   1246  6+1   71FA 10AE C8 45            ldy   rsv_priority_next_obj_1,u
   1247  5+1   71FE ED   A8 43            std   rsv_priority_prev_obj_1,y
   1248  4+1   7201 A6   C8 41            lda   rsv_onscreen_0,u
   1249  3     7204 26   EF               bne   DOB_rts                    >>
   1250  8     7206 BD   720B             jsr   ClearObj                   >>
   1251  5+8   7209 35   D6               puls  d,x,u,pc
   1252
   1253                                                                  * >>
   1254                                                                  *
   1255                                                                  * >>
   1256                                                                  * >>
   1257                                                                  *->>
   1258                                                                  * >>
   1259                                                                  * >>
   1260                                                                  * >>
   1261                                                                  * >>
   1262                                                                  *
   1263                                                                  * >>
   1264                                                                  *;>>
   1265
   1266                                   INCLUD CLEAROBJ
   1267                           * --------------------------------------->>
   1268                           * ClearObj
   1269                           * --------
   1270                           * Subroutine to clear an object data in O>>
   1271                           *
   1272                           * input REG : [u] pointer on objet (OST)
   1273                           * clear REG : [d,y]
   1274                           * --------------------------------------->>
   1275
   1276        720B               ClearObj *@globals
   1277  7     720B 10FF 7237             sts   CLO_1+2
   1278  6     720F BF   723A             stx   CLO_2+1
   1279  3     7212 CC   0000             ldd   #$0000
   1280  3     7215 8E   0000             ldx   #$0000
   1281  4+0   7218 31   84               leay  ,x
   1282  4+0   721A 32   84               leas  ,x
   1283  4+1   721C 33   C8 52            leau  object_size,u
   1284  5+8   721F 36   76               pshu  d,x,y,s
   1285  5+8   7221 36   76               pshu  d,x,y,s
   1286  5+8   7223 36   76               pshu  d,x,y,s
   1287  5+8   7225 36   76               pshu  d,x,y,s
   1288  5+8   7227 36   76               pshu  d,x,y,s
   1289  5+8   7229 36   76               pshu  d,x,y,s
   1290  5+8   722B 36   76               pshu  d,x,y,s
   1291  5+8   722D 36   76               pshu  d,x,y,s
   1292  5+8   722F 36   76               pshu  d,x,y,s
   1293  5+8   7231 36   76               pshu  d,x,y,s
   1294  5+2   7233 36   06               pshu  d         ; DEPENDENCY on o>>
   1295        7235               CLO_1
   1296  4     7235 10CE 0000             lds   #$0000
   1297        7239               CLO_2
   1298  3     7239 8E   0000             ldx   #$0000
   1299  5     723C 39                    rts
   1300
   1301                                   INCLUD CHECKSPR
   1302                           * --------------------------------------->>
   1303                           * CheckSpritesRefresh
   1304                           * -------------------
   1305                           * Subroutine to determine if sprites are >>
   1306                           * Read Display Priority Structure (back t>>
   1307                           * priority: 0 - unregistred
   1308                           * priority: 1 - register non moving overl>>
   1309                           * priority; 2-8 - register moving sprite >>
   1310                           *
   1311                           * input REG : none
   1312                           * --------------------------------------->>
   1313
   1314        723D 0000          cur_priority            fdb   $00
   1315        723F 0000          cur_ptr_sub_obj_erase   fdb   $0000
   1316        7241 0000          cur_ptr_sub_obj_draw    fdb   $0000
   1317                            
   1318        7243               CheckSpritesRefresh
   1319
   1320        7243               CSR_Start
   1321  3     7243 CC   660D             ldd   #Tbl_Sub_Object_Erase
   1322  6     7246 FD   723F             std   cur_ptr_sub_obj_erase
   1323  3     7249 CC   668D             ldd   #Tbl_Sub_Object_Draw
   1324  6     724C FD   7241             std   cur_ptr_sub_obj_draw
   1325  5     724F B6   611A             lda   Glb_Cur_Wrk_Screen_Id      >>
   1326  3     7252 26   6E               bne   CSR_SetBuffer1
   1327                            
   1328        7254               CSR_SetBuffer0
   1329  2     7254 86   32               lda   #rsv_buffer_0              >>
   1330  5     7256 B7   7332             sta   CSR_ProcessEachPriorityLeve>>
   1331        7259               CSR_P8B0
   1332  6     7259 FE   64D1             ldu   DPS_buffer_0+buf_Tbl_Priori>>
   1333  3     725C 27   08               beq   CSR_P7B0
   1334  2     725E 86   08               lda   #$08
   1335  5     7260 B7   723D             sta   cur_priority
   1336  8     7263 BD   7330             jsr   CSR_ProcessEachPriorityLeve>>
   1337        7266               CSR_P7B0
   1338  6     7266 FE   64CF             ldu   DPS_buffer_0+buf_Tbl_Priori>>
   1339  3     7269 27   08               beq   CSR_P6B0
   1340  2     726B 86   07               lda   #$07
   1341  5     726D B7   723D             sta   cur_priority
   1342  8     7270 BD   7330             jsr   CSR_ProcessEachPriorityLeve>>
   1343        7273               CSR_P6B0
   1344  6     7273 FE   64CD             ldu   DPS_buffer_0+buf_Tbl_Priori>>
   1345  3     7276 27   08               beq   CSR_P5B0
   1346  2     7278 86   06               lda   #$06
   1347  5     727A B7   723D             sta   cur_priority
   1348  8     727D BD   7330             jsr   CSR_ProcessEachPriorityLeve>>
   1349        7280               CSR_P5B0
   1350  6     7280 FE   64CB             ldu   DPS_buffer_0+buf_Tbl_Priori>>
   1351  3     7283 27   08               beq   CSR_P4B0
   1352  2     7285 86   05               lda   #$05
   1353  5     7287 B7   723D             sta   cur_priority
   1354  8     728A BD   7330             jsr   CSR_ProcessEachPriorityLeve>>
   1355        728D               CSR_P4B0
   1356  6     728D FE   64C9             ldu   DPS_buffer_0+buf_Tbl_Priori>>
   1357  3     7290 27   08               beq   CSR_P3B0
   1358  2     7292 86   04               lda   #$04
   1359  5     7294 B7   723D             sta   cur_priority
   1360  8     7297 BD   7330             jsr   CSR_ProcessEachPriorityLeve>>
   1361        729A               CSR_P3B0
   1362  6     729A FE   64C7             ldu   DPS_buffer_0+buf_Tbl_Priori>>
   1363  3     729D 27   08               beq   CSR_P2B0
   1364  2     729F 86   03               lda   #$03
   1365  5     72A1 B7   723D             sta   cur_priority
   1366  8     72A4 BD   7330             jsr   CSR_ProcessEachPriorityLeve>>
   1367        72A7               CSR_P2B0
   1368  6     72A7 FE   64C5             ldu   DPS_buffer_0+buf_Tbl_Priori>>
   1369  3     72AA 27   08               beq   CSR_P1B0
   1370  2     72AC 86   02               lda   #$02
   1371  5     72AE B7   723D             sta   cur_priority
   1372  8     72B1 BD   7330             jsr   CSR_ProcessEachPriorityLeve>>
   1373        72B4               CSR_P1B0
   1374  6     72B4 FE   64C3             ldu   DPS_buffer_0+buf_Tbl_Priori>>
   1375  3     72B7 27   08               beq   CSR_rtsB0
   1376  2     72B9 86   01               lda   #$01
   1377  5     72BB B7   723D             sta   cur_priority
   1378  8     72BE BD   7330             jsr   CSR_ProcessEachPriorityLeve>>
   1379        72C1               CSR_rtsB0
   1380  5     72C1 39                    rts
   1381                            
   1382        72C2               CSR_SetBuffer1
   1383  2     72C2 86   42               lda   #rsv_buffer_1              >>
   1384  5     72C4 B7   7332             sta   CSR_ProcessEachPriorityLeve>>
   1385        72C7               CSR_P8B1
   1386  6     72C7 FE   6577             ldu   DPS_buffer_1+buf_Tbl_Priori>>
   1387  3     72CA 27   08               beq   CSR_P7B1
   1388  2     72CC 86   08               lda   #$08
   1389  5     72CE B7   723D             sta   cur_priority
   1390  8     72D1 BD   7330             jsr   CSR_ProcessEachPriorityLeve>>
   1391        72D4               CSR_P7B1
   1392  6     72D4 FE   6575             ldu   DPS_buffer_1+buf_Tbl_Priori>>
   1393  3     72D7 27   08               beq   CSR_P6B1
   1394  2     72D9 86   07               lda   #$07
   1395  5     72DB B7   723D             sta   cur_priority
   1396  8     72DE BD   7330             jsr   CSR_ProcessEachPriorityLeve>>
   1397        72E1               CSR_P6B1
   1398  6     72E1 FE   6573             ldu   DPS_buffer_1+buf_Tbl_Priori>>
   1399  3     72E4 27   08               beq   CSR_P5B1
   1400  2     72E6 86   06               lda   #$06
   1401  5     72E8 B7   723D             sta   cur_priority
   1402  8     72EB BD   7330             jsr   CSR_ProcessEachPriorityLeve>>
   1403        72EE               CSR_P5B1
   1404  6     72EE FE   6571             ldu   DPS_buffer_1+buf_Tbl_Priori>>
   1405  3     72F1 27   08               beq   CSR_P4B1
   1406  2     72F3 86   05               lda   #$05
   1407  5     72F5 B7   723D             sta   cur_priority
   1408  8     72F8 BD   7330             jsr   CSR_ProcessEachPriorityLeve>>
   1409        72FB               CSR_P4B1
   1410  6     72FB FE   656F             ldu   DPS_buffer_1+buf_Tbl_Priori>>
   1411  3     72FE 27   08               beq   CSR_P3B1
   1412  2     7300 86   04               lda   #$04
   1413  5     7302 B7   723D             sta   cur_priority
   1414  8     7305 BD   7330             jsr   CSR_ProcessEachPriorityLeve>>
   1415        7308               CSR_P3B1
   1416  6     7308 FE   656D             ldu   DPS_buffer_1+buf_Tbl_Priori>>
   1417  3     730B 27   08               beq   CSR_P2B1
   1418  2     730D 86   03               lda   #$03
   1419  5     730F B7   723D             sta   cur_priority
   1420  8     7312 BD   7330             jsr   CSR_ProcessEachPriorityLeve>>
   1421        7315               CSR_P2B1
   1422  6     7315 FE   656B             ldu   DPS_buffer_1+buf_Tbl_Priori>>
   1423  3     7318 27   08               beq   CSR_P1B1
   1424  2     731A 86   02               lda   #$02
   1425  5     731C B7   723D             sta   cur_priority
   1426  8     731F BD   7330             jsr   CSR_ProcessEachPriorityLeve>>
   1427        7322               CSR_P1B1
   1428  6     7322 FE   6569             ldu   DPS_buffer_1+buf_Tbl_Priori>>
   1429  3     7325 27   08               beq   CSR_rtsB1
   1430  2     7327 86   01               lda   #$01
   1431  5     7329 B7   723D             sta   cur_priority
   1432  8     732C BD   7330             jsr   CSR_ProcessEachPriorityLeve>>
   1433        732F               CSR_rtsB1
   1434  5     732F 39                    rts
   1435
   1436        7330               CSR_ProcessEachPriorityLevel
   1437  4+1   7330 30   C8 10            leax  16,u                       >>
   1438                            
   1439        7333               CSR_CheckDelHide
   1440  4+1   7333 A6   42               lda   render_flags,u
   1441  2     7335 84   28               anda  #render_hide_mask!render_to>>
   1442  3     7337 26   63               bne   CSR_DoNotDisplaySprite
   1443
   1444        7339               CSR_CheckRefresh
   1445  4+1   7339 A6   C8 29            lda   rsv_render_flags,u
   1446  2     733C 84   01               anda  #rsv_render_checkrefresh_ma>>
   1447  6     733E 1026 00BB             lbne  CSR_CheckErase
   1448
   1449        7342               CSR_UpdSpriteImageBasedOnMirror
   1450  4+1   7342 A6   C8 29            lda   rsv_render_flags,u
   1451  2     7345 8A   01               ora   #rsv_render_checkrefresh_ma>>
   1452  4+1   7347 A7   C8 29            sta   rsv_render_flags,u         >>
   1453                            
   1454  4+1   734A A6   42               lda   render_flags,u             >>
   1455  2     734C 84   03               anda  #render_xmirror_mask!render>>
   1456  2     734E C6   0E               ldb   #image_meta_size
   1457  11    7350 3D                    mul
   1458  6+1   7351 E3   4A               addd  mapping_frame,u
   1459  5+1   7353 ED   C8 2C            std   rsv_curr_mapping_frame,u
   1460                            
   1461        7356               CSR_CheckPlayFieldCoord
   1462  4+1   7356 A6   42               lda   render_flags,u
   1463  2     7358 84   04               anda  #render_playfieldcoord_mask>>
   1464  3     735A 27   69               beq   CSR_CheckVerticalPosition  >>
   1465                            
   1466  5+1   735C EC   4C               ldd   x_pos,u
   1467  7     735E B3   611B             subd  Glb_Camera_X_Pos
   1468  6+1   7361 10AE C8 2C            ldy   rsv_curr_mapping_frame,u
   1469                                   *addd  image_x_offset,y
   1470  6     7365 1029 008C             lbvs   CSR_SetOutOfRange         >>
   1471  6     7369 102B 0088             lbmi   CSR_SetOutOfRange         >>
   1472  4+1   736D E7   C8 12            stb   x_pixel,u
   1473                                   *addb  image_x_size_l,y
   1474  6     7370 1029 0081             lbvs   CSR_SetOutOfRange         >>
   1475  4+1   7374 E7   C8 30            stb   rsv_x2_pixel,u
   1476  2     7377 C1   A0               cmpb  #screen_width
   1477  6     7379 102E 0078             lbgt   CSR_SetOutOfRange         >>
   1478
   1479  5+1   737D EC   4F               ldd   y_pos,u
   1480  7     737F B3   611D             subd  Glb_Camera_Y_Pos
   1481                                   *addd  image_y1_offset,y
   1482  3     7382 29   71               bvs   CSR_SetOutOfRange          >>
   1483  3     7384 2B   6F               bmi   CSR_SetOutOfRange          >>
   1484  4+1   7386 E7   C8 13            stb   y_pixel,u
   1485                                   *addb  image_y_size_l,y
   1486  3     7389 29   6A               bvs   CSR_SetOutOfRange          >>
   1487  4+1   738B E7   C8 31            stb   rsv_y2_pixel,u
   1488  2     738E C1   E4               cmpb  #screen_bottom
   1489  3     7390 22   63               bhi   CSR_SetOutOfRange          >>
   1490  4+1   7392 A6   C8 29            lda   rsv_render_flags,u
   1491  2     7395 84   F7               anda  #:rsv_render_outofrange_mas>>
   1492  4+1   7397 A7   C8 29            sta   rsv_render_flags,u
   1493  3     739A 20   61               bra   CSR_CheckErase
   1494                            
   1495        739C               CSR_DoNotDisplaySprite
   1496  4+1   739C A6   43               lda   priority,u
   1497  5     739E B1   723D             cmpa  cur_priority
   1498  3     73A1 26   1B               bne   CSR_NextObject             >>
   1499                            
   1500  4+1   73A3 A6   C8 29            lda   rsv_render_flags,u
   1501  2     73A6 84   F9               anda  #:rsv_render_erasesprite_ma>>
   1502  4+1   73A8 A7   C8 29            sta   rsv_render_flags,u
   1503                            
   1504  4+1   73AB E6   0F               ldb   buf_onscreen,x
   1505  3     73AD 27   0F               beq   CSR_NextObject             >>
   1506                            
   1507  2     73AF 8A   02               ora   #rsv_render_erasesprite_mas>>
   1508  4+1   73B1 A7   C8 29            sta   rsv_render_flags,u
   1509                            
   1510  7     73B4 10BE 723F             ldy   cur_ptr_sub_obj_erase      >>
   1511  5+3   73B8 EF   A1               stu   ,y++
   1512  7     73BA 10BF 723F             sty   cur_ptr_sub_obj_erase
   1513                            
   1514        73BE               CSR_NextObject
   1515  5+1   73BE EE   03               ldu   buf_priority_next_obj,x
   1516  6     73C0 1026 FF6C             lbne  CSR_ProcessEachPriorityLeve>>
   1517  5     73C4 39                    rts
   1518
   1519        73C5               CSR_CheckVerticalPosition
   1520  4+1   73C5 E6   C8 13            ldb   y_pixel,u
   1521  6+1   73C8 10AE C8 2C            ldy   rsv_curr_mapping_frame,u
   1522                            
   1523  4+1   73CC EB   2B               addb  image_y1_offset_l,y
   1524  4+1   73CE E7   C8 2F            stb   rsv_y1_pixel,u
   1525
   1526  2     73D1 C1   1C               cmpb  #screen_top
   1527  3     73D3 25   20               bcs   CSR_SetOutOfRange
   1528                            
   1529  4+1   73D5 EB   2D               addb  image_y_size_l,y
   1530  4+1   73D7 E7   C8 31            stb   rsv_y2_pixel,u
   1531
   1532  2     73DA C1   E4               cmpb  #screen_bottom
   1533  3     73DC 22   17               bhi   CSR_SetOutOfRange
   1534                            
   1535  4+1   73DE E6   C8 12            ldb   x_pixel,u
   1536  4+1   73E1 EB   2A               addb  image_x1_offset_l,y
   1537  4+1   73E3 E7   C8 2E            stb   rsv_x1_pixel,u
   1538  4+1   73E6 EB   2C               addb  image_x_size_l,y
   1539  4+1   73E8 E7   C8 30            stb   rsv_x2_pixel,u
   1540                            
   1541  4+1   73EB A6   C8 29            lda   rsv_render_flags,u
   1542  2     73EE 84   F7               anda  #:rsv_render_outofrange_mas>>
   1543  4+1   73F0 A7   C8 29            sta   rsv_render_flags,u
   1544  3     73F3 20   08               bra   CSR_CheckErase
   1545                            
   1546        73F5               CSR_SetOutOfRange
   1547  4+1   73F5 A6   C8 29            lda   rsv_render_flags,u
   1548  2     73F8 8A   08               ora   #rsv_render_outofrange_mask>>
   1549  4+1   73FA A7   C8 29            sta   rsv_render_flags,u
   1550
   1551        73FD               CSR_CheckErase
   1552  7     73FD 10FF 74D0             sts   CSR_CheckDraw+2
   1553  4+1   7401 A6   00               lda   buf_priority,x
   1554  5     7403 B1   723D             cmpa  cur_priority
   1555  6     7406 1026 00C4             lbne  CSR_CheckDraw
   1556                            
   1557  7     740A 10BE 723F             ldy   cur_ptr_sub_obj_erase
   1558                            
   1559  4+1   740E A6   0F               lda   buf_onscreen,x
   1560  6     7410 1027 00B2             lbeq   CSR_SetEraseFalse         >>
   1561  5+1   7414 EC   C8 12            ldd   xy_pixel,u
   1562  7+1   7417 10A3 09               cmpd  buf_prev_xy_pixel,x
   1563  3     741A 26   10               bne   CSR_SetEraseTrue           >>
   1564  5+1   741C EC   C8 2C            ldd   rsv_curr_mapping_frame,u
   1565  7+1   741F 10A3 05               cmpd  buf_prev_mapping_frame,x
   1566  3     7422 26   08               bne   CSR_SetEraseTrue           >>
   1567  4+1   7424 A6   43               lda   priority,u
   1568  4+1   7426 A1   00               cmpa  buf_priority,x
   1569  3     7428 26   02               bne   CSR_SetEraseTrue           >>
   1570  3     742A 20   11               bra   CSR_SubEraseSpriteSearchIni>>
   1571                            
   1572        742C               CSR_SetEraseTrue
   1573  4+1   742C A6   C8 29            lda   rsv_render_flags,u
   1574  2     742F 8A   02               ora   #rsv_render_erasesprite_mas>>
   1575  4+1   7431 A7   C8 29            sta   rsv_render_flags,u
   1576                            
   1577  5+3   7434 EF   A1               stu   ,y++
   1578  7     7436 10BF 723F             sty   cur_ptr_sub_obj_erase
   1579                            
   1580  5     743A 16   0091             lbra   CSR_CheckDraw
   1581                            
   1582        743D               CSR_SubEraseSpriteSearchInit
   1583
   1584                                   * search a collision with a sprit>>
   1585                                   * the sprite under should have to>>
   1586                                   * in this case it forces the refr>>
   1587                                   * as a sub loop, this should be o>>
   1588                                   * there are two lists because a s>>
   1589                                   * and displayed at another positi>>
   1590
   1591  7     743D 10FE 723F             lds   cur_ptr_sub_obj_erase
   1592  5     7441 B6   611A             lda   Glb_Cur_Wrk_Screen_Id      >>
   1593  3     7444 26   29               bne   CSR_SubEraseSearchB1
   1594                            
   1595        7446               CSR_SubEraseSearchB0
   1596  5     7446 118C 660D             cmps  #Tbl_Sub_Object_Erase
   1597  3     744A 27   4C               beq   CSR_SubDrawSpriteSearchInit>>
   1598  6+3   744C 10AE E3               ldy   ,--s
   1599                            
   1600        744F               CSR_SubEraseCheckCollisionB0
   1601  5+1   744F EC   A8 3D            ldd   rsv_prev_xy1_pixel_0,y     >>
   1602  4+1   7452 A1   C8 30            cmpa  rsv_x2_pixel,u             >>
   1603  3     7455 24   EF               bhs   CSR_SubEraseSearchB0
   1604  4+1   7457 E1   C8 31            cmpb  rsv_y2_pixel,u             >>
   1605  3     745A 24   EA               bhs   CSR_SubEraseSearchB0
   1606  5+1   745C EC   A8 3F            ldd   rsv_prev_xy2_pixel_0,y     >>
   1607  4+1   745F A1   C8 2E            cmpa  rsv_x1_pixel,u             >>
   1608  3     7462 23   E2               bls   CSR_SubEraseSearchB0
   1609  4+1   7464 E1   C8 2F            cmpb  rsv_y1_pixel,u             >>
   1610  3     7467 23   DD               bls   CSR_SubEraseSearchB0
   1611                            
   1612  7     7469 10BE 723F             ldy   cur_ptr_sub_obj_erase
   1613  3     746D 20   BD               bra   CSR_SetEraseTrue           >>
   1614
   1615        746F               CSR_SubEraseSearchB1
   1616  5     746F 118C 660D             cmps  #Tbl_Sub_Object_Erase
   1617  3     7473 27   23               beq   CSR_SubDrawSpriteSearchInit>>
   1618  6+3   7475 10AE E3               ldy   ,--s
   1619                            
   1620        7478               CSR_SubEraseCheckCollisionB1
   1621  5+1   7478 EC   A8 4D            ldd   rsv_prev_xy1_pixel_1,y     >>
   1622  4+1   747B A1   C8 30            cmpa  rsv_x2_pixel,u             >>
   1623  3     747E 22   EF               bhi   CSR_SubEraseSearchB1
   1624  4+1   7480 E1   C8 31            cmpb  rsv_y2_pixel,u             >>
   1625  3     7483 22   EA               bhi   CSR_SubEraseSearchB1
   1626  5+1   7485 EC   A8 4F            ldd   rsv_prev_xy2_pixel_1,y     >>
   1627  4+1   7488 A1   C8 2E            cmpa  rsv_x1_pixel,u             >>
   1628  3     748B 25   E2               blo   CSR_SubEraseSearchB1
   1629  4+1   748D E1   C8 2F            cmpb  rsv_y1_pixel,u             >>
   1630  3     7490 25   DD               blo   CSR_SubEraseSearchB1
   1631                            
   1632  7     7492 10BE 723F             ldy   cur_ptr_sub_obj_erase
   1633  3     7496 20   94               bra   CSR_SetEraseTrue           >>
   1634
   1635        7498               CSR_SubDrawSpriteSearchInit
   1636  7     7498 10FE 7241             lds   cur_ptr_sub_obj_draw
   1637                            
   1638        749C               CSR_SubDrawSearch
   1639  5     749C 118C 668D             cmps  #Tbl_Sub_Object_Draw
   1640  3     74A0 27   24               beq   CSR_SetEraseFalse          >>
   1641  6+3   74A2 10AE E3               ldy   ,--s
   1642
   1643        74A5               CSR_SubDrawCheckCollision
   1644  5+1   74A5 EC   A8 2E            ldd   rsv_xy1_pixel,y            >>
   1645  4+1   74A8 A1   C8 30            cmpa  rsv_x2_pixel,u             >>
   1646  3     74AB 22   EF               bhi   CSR_SubDrawSearch
   1647  4+1   74AD E1   C8 31            cmpb  rsv_y2_pixel,u             >>
   1648  3     74B0 22   EA               bhi   CSR_SubDrawSearch
   1649  5+1   74B2 EC   A8 30            ldd   rsv_xy2_pixel,y            >>
   1650  4+1   74B5 A1   C8 2E            cmpa  rsv_x1_pixel,u             >>
   1651  3     74B8 25   E2               blo   CSR_SubDrawSearch
   1652  4+1   74BA E1   C8 2F            cmpb  rsv_y1_pixel,u             >>
   1653  3     74BD 25   DD               blo   CSR_SubDrawSearch
   1654                            
   1655  7     74BF 10BE 723F             ldy   cur_ptr_sub_obj_erase
   1656  5     74C3 16   FF66             lbra  CSR_SetEraseTrue           >>
   1657
   1658        74C6               CSR_SetEraseFalse
   1659  4+1   74C6 A6   C8 29            lda   rsv_render_flags,u
   1660  2     74C9 84   FD               anda  #:rsv_render_erasesprite_ma>>
   1661  4+1   74CB A7   C8 29            sta   rsv_render_flags,u
   1662                            
   1663        74CE               CSR_CheckDraw
   1664  4     74CE 10CE FFFF             lds   #$FFFF                     >>
   1665  4+1   74D2 A6   43               lda   priority,u
   1666  5     74D4 B1   723D             cmpa  cur_priority
   1667  6     74D7 1026 FEE3             lbne  CSR_NextObject
   1668                            
   1669  7     74DB 10BE 7241             ldy   cur_ptr_sub_obj_draw
   1670                            
   1671  4+1   74DF A6   C8 29            lda   rsv_render_flags,u
   1672  2     74E2 84   08               anda  #rsv_render_outofrange_mask>>
   1673  3     74E4 26   30               bne   CSR_SetDrawFalse           >>
   1674  5+1   74E6 EC   C8 2C            ldd   rsv_curr_mapping_frame,u
   1675  3     74E9 27   2B               beq   CSR_SetDrawFalse           >>
   1676  4+1   74EB A6   42               lda   render_flags,u
   1677  2     74ED 84   08               anda  #render_hide_mask
   1678  3     74EF 26   25               bne   CSR_SetDrawFalse           >>
   1679                            
   1680        74F1               CSR_SetDrawTrue
   1681  4+1   74F1 A6   C8 29            lda   rsv_render_flags,u
   1682  2     74F4 8A   04               ora   #rsv_render_displaysprite_m>>
   1683  4+1   74F6 A7   C8 29            sta   rsv_render_flags,u
   1684                            
   1685  4+1   74F9 A6   C8 29            lda   rsv_render_flags,u
   1686  2     74FC 84   02               anda  #rsv_render_erasesprite_mas>>
   1687  2     74FE 44                    lsra                             >>
   1688  4+1   74FF A1   0F               cmpa  buf_onscreen,x
   1689  3     7501 26   06               bne   CSR_SetHide
   1690                            
   1691  5+3   7503 EF   A1               stu   ,y++
   1692  7     7505 10BF 7241             sty   cur_ptr_sub_obj_draw       >>
   1693
   1694        7509               CSR_SetHide
   1695  4+1   7509 A6   42               lda   render_flags,u
   1696  2     750B 8A   08               ora   #render_hide_mask          >>
   1697  4+1   750D A7   42               sta   render_flags,u
   1698                            
   1699  5+1   750F EE   03               ldu   buf_priority_next_obj,x
   1700  6     7511 1026 FE1B             lbne   CSR_ProcessEachPriorityLev>>
   1701  5     7515 39                    rts
   1702
   1703        7516               CSR_SetDrawFalse
   1704  4+1   7516 A6   C8 29            lda   rsv_render_flags,u
   1705  2     7519 84   FB               anda  #:rsv_render_displaysprite_>>
   1706  4+1   751B A7   C8 29            sta   rsv_render_flags,u
   1707                            
   1708  5+1   751E EE   03               ldu   buf_priority_next_obj,x
   1709  6     7520 1026 FE0C             lbne   CSR_ProcessEachPriorityLev>>
   1710  5     7524 39                    rts
   1711
   1712
   1713                                   INCLUD ERASESPR
   1714                           * --------------------------------------->>
   1715                           * EraseSprites
   1716                           * ------------
   1717                           * Subroutine to erase sprites on screen
   1718                           * Read Display Priority Structure (front >>
   1719                           * priority: 0 - unregistred
   1720                           * priority: 1 - register non moving overl>>
   1721                           * priority; 2-8 - register moving sprite >>
   1722                           *
   1723                           * input REG : none
   1724                           * --------------------------------------->>
   1725                            
   1726        7525               EraseSprites
   1727
   1728        7525               ESP_Start
   1729  5     7525 B6   611A             lda   Glb_Cur_Wrk_Screen_Id      >>
   1730  3     7528 26   69               bne   ESP_P1B1
   1731
   1732        752A               ESP_P1B0
   1733  6     752A FE   64D5             ldu   DPS_buffer_0+buf_Tbl_Priori>>
   1734  3     752D 27   08               beq   ESP_P2B0
   1735  2     752F 86   01               lda   #$01
   1736  5     7531 B7   7600             sta   ESP_CheckPriorityB0+1
   1737  8     7534 BD   75FC             jsr   ESP_ProcessEachPriorityLeve>>
   1738        7537               ESP_P2B0
   1739  6     7537 FE   64D7             ldu   DPS_buffer_0+buf_Tbl_Priori>>
   1740  3     753A 27   08               beq   ESP_P3B0
   1741  2     753C 86   02               lda   #$02
   1742  5     753E B7   7600             sta   ESP_CheckPriorityB0+1
   1743  8     7541 BD   75FC             jsr   ESP_ProcessEachPriorityLeve>>
   1744        7544               ESP_P3B0
   1745  6     7544 FE   64D9             ldu   DPS_buffer_0+buf_Tbl_Priori>>
   1746  3     7547 27   08               beq   ESP_P4B0
   1747  2     7549 86   03               lda   #$03
   1748  5     754B B7   7600             sta   ESP_CheckPriorityB0+1
   1749  8     754E BD   75FC             jsr   ESP_ProcessEachPriorityLeve>>
   1750        7551               ESP_P4B0
   1751  6     7551 FE   64DB             ldu   DPS_buffer_0+buf_Tbl_Priori>>
   1752  3     7554 27   08               beq   ESP_P5B0
   1753  2     7556 86   04               lda   #$04
   1754  5     7558 B7   7600             sta   ESP_CheckPriorityB0+1
   1755  8     755B BD   75FC             jsr   ESP_ProcessEachPriorityLeve>>
   1756        755E               ESP_P5B0
   1757  6     755E FE   64DD             ldu   DPS_buffer_0+buf_Tbl_Priori>>
   1758  3     7561 27   08               beq   ESP_P6B0
   1759  2     7563 86   05               lda   #$05
   1760  5     7565 B7   7600             sta   ESP_CheckPriorityB0+1
   1761  8     7568 BD   75FC             jsr   ESP_ProcessEachPriorityLeve>>
   1762        756B               ESP_P6B0
   1763  6     756B FE   64DF             ldu   DPS_buffer_0+buf_Tbl_Priori>>
   1764  3     756E 27   08               beq   ESP_P7B0
   1765  2     7570 86   06               lda   #$06
   1766  5     7572 B7   7600             sta   ESP_CheckPriorityB0+1
   1767  8     7575 BD   75FC             jsr   ESP_ProcessEachPriorityLeve>>
   1768        7578               ESP_P7B0
   1769  6     7578 FE   64E1             ldu   DPS_buffer_0+buf_Tbl_Priori>>
   1770  3     757B 27   08               beq   ESP_P8B0
   1771  2     757D 86   07               lda   #$07
   1772  5     757F B7   7600             sta   ESP_CheckPriorityB0+1
   1773  8     7582 BD   75FC             jsr   ESP_ProcessEachPriorityLeve>>
   1774        7585               ESP_P8B0
   1775  6     7585 FE   64E3             ldu   DPS_buffer_0+buf_Tbl_Priori>>
   1776  3     7588 27   08               beq   ESP_rtsB0
   1777  2     758A 86   08               lda   #$08
   1778  5     758C B7   7600             sta   ESP_CheckPriorityB0+1
   1779  8     758F BD   75FC             jsr   ESP_ProcessEachPriorityLeve>>
   1780        7592               ESP_rtsB0
   1781  5     7592 39                    rts
   1782                            
   1783        7593               ESP_P1B1
   1784  6     7593 FE   657B             ldu   DPS_buffer_1+buf_Tbl_Priori>>
   1785  3     7596 27   08               beq   ESP_P2B1
   1786  2     7598 86   01               lda   #$01
   1787  5     759A B7   7646             sta   ESP_CheckPriorityB1+1
   1788  8     759D BD   7642             jsr   ESP_ProcessEachPriorityLeve>>
   1789        75A0               ESP_P2B1
   1790  6     75A0 FE   657D             ldu   DPS_buffer_1+buf_Tbl_Priori>>
   1791  3     75A3 27   08               beq   ESP_P3B1
   1792  2     75A5 86   02               lda   #$02
   1793  5     75A7 B7   7646             sta   ESP_CheckPriorityB1+1
   1794  8     75AA BD   7642             jsr   ESP_ProcessEachPriorityLeve>>
   1795        75AD               ESP_P3B1
   1796  6     75AD FE   657F             ldu   DPS_buffer_1+buf_Tbl_Priori>>
   1797  3     75B0 27   08               beq   ESP_P4B1
   1798  2     75B2 86   03               lda   #$03
   1799  5     75B4 B7   7646             sta   ESP_CheckPriorityB1+1
   1800  8     75B7 BD   7642             jsr   ESP_ProcessEachPriorityLeve>>
   1801        75BA               ESP_P4B1
   1802  6     75BA FE   6581             ldu   DPS_buffer_1+buf_Tbl_Priori>>
   1803  3     75BD 27   08               beq   ESP_P5B1
   1804  2     75BF 86   04               lda   #$04
   1805  5     75C1 B7   7646             sta   ESP_CheckPriorityB1+1
   1806  8     75C4 BD   7642             jsr   ESP_ProcessEachPriorityLeve>>
   1807        75C7               ESP_P5B1
   1808  6     75C7 FE   6583             ldu   DPS_buffer_1+buf_Tbl_Priori>>
   1809  3     75CA 27   08               beq   ESP_P6B1
   1810  2     75CC 86   05               lda   #$05
   1811  5     75CE B7   7646             sta   ESP_CheckPriorityB1+1
   1812  8     75D1 BD   7642             jsr   ESP_ProcessEachPriorityLeve>>
   1813        75D4               ESP_P6B1
   1814  6     75D4 FE   6585             ldu   DPS_buffer_1+buf_Tbl_Priori>>
   1815  3     75D7 27   08               beq   ESP_P7B1
   1816  2     75D9 86   06               lda   #$06
   1817  5     75DB B7   7646             sta   ESP_CheckPriorityB1+1
   1818  8     75DE BD   7642             jsr   ESP_ProcessEachPriorityLeve>>
   1819        75E1               ESP_P7B1
   1820  6     75E1 FE   6587             ldu   DPS_buffer_1+buf_Tbl_Priori>>
   1821  3     75E4 27   08               beq   ESP_P8B1
   1822  2     75E6 86   07               lda   #$07
   1823  5     75E8 B7   7646             sta   ESP_CheckPriorityB1+1
   1824  8     75EB BD   7642             jsr   ESP_ProcessEachPriorityLeve>>
   1825        75EE               ESP_P8B1
   1826  6     75EE FE   6589             ldu   DPS_buffer_1+buf_Tbl_Priori>>
   1827  3     75F1 27   08               beq   ESP_rtsB1
   1828  2     75F3 86   08               lda   #$08
   1829  5     75F5 B7   7646             sta   ESP_CheckPriorityB1+1
   1830  8     75F8 BD   7642             jsr   ESP_ProcessEachPriorityLeve>>
   1831        75FB               ESP_rtsB1
   1832  5     75FB 39                    rts
   1833
   1834                           * *******
   1835                           * BUFFER0
   1836                           * *******
   1837
   1838        75FC               ESP_ProcessEachPriorityLevelB0
   1839  4+1   75FC A6   C8 32            lda   rsv_priority_0,u
   1840                            
   1841        75FF               ESP_CheckPriorityB0
   1842  2     75FF 81   00               cmpa  #0                         >>
   1843  3     7601 26   39               bne   ESP_NextObjectB0           >>
   1844                            
   1845        7603               ESP_UnsetCheckRefreshB0
   1846  4+1   7603 A6   C8 29            lda   rsv_render_flags,u
   1847  4+1   7606 E6   42               ldb   render_flags,u
   1848  2     7608 C4   10               andb  #render_fixedoverlay_mask
   1849  3     760A 26   05               bne   ESP_CheckEraseB0
   1850  2     760C 84   FE               anda  #:rsv_render_checkrefresh_m>>
   1851  4+1   760E A7   C8 29            sta   rsv_render_flags,u
   1852                            
   1853        7611               ESP_CheckEraseB0
   1854  2     7611 84   02               anda  #rsv_render_erasesprite_mas>>
   1855  3     7613 27   27               beq   ESP_NextObjectB0
   1856  2     7615 C4   10               andb  #render_fixedoverlay_mask
   1857  3     7617 26   20               bne   ESP_UnsetOnScreenFlagB0
   1858                            
   1859        7619               ESP_CallEraseRoutineB0
   1860  6     7619 FF   762D             stu   ESP_CallEraseRoutineB0_00+1>>
   1861  5+1   761C AE   C8 37            ldx   rsv_prev_mapping_frame_0,u >>
   1862  4+1   761F A6   06               lda   page_erase_routine,x
   1863  5     7621 B7   E7E5             sta   $E7E5                      >>
   1864  5+1   7624 EE   C8 39            ldu   rsv_bgdata_0,u             >>
   1865  7+4   7627 AD   98 07            jsr   [erase_routine,x]          >>
   1866  4+0   762A 31   C4               leay  ,u                         >>
   1867        762C               ESP_CallEraseRoutineB0_00
   1868  3     762C CE   0000             ldu   #$0000                     >>
   1869  5+1   762F EC   C8 39            ldd   rsv_bgdata_0,u             >>
   1870  2     7632 C4   C0               andb  #256-cell_size             >>
   1871  6     7634 1F   01               tfr   d,x                        >>
   1872                            
   1873        7636               ESP_FreeEraseBufferB0
   1874  8     7636 BD   797C             jsr   BgBufferFree               >>
   1875                            
   1876        7639               ESP_UnsetOnScreenFlagB0
   1877  6+1   7639 6F   C8 41            clr   rsv_onscreen_0,u           >>
   1878
   1879        763C               ESP_NextObjectB0
   1880  5+1   763C EE   C8 33            ldu   rsv_priority_prev_obj_0,u
   1881  3     763F 26   BB               bne   ESP_ProcessEachPriorityLeve>>
   1882  5     7641 39                    rts
   1883
   1884                           * *******
   1885                           * BUFFER1
   1886                           * *******
   1887                            
   1888        7642               ESP_ProcessEachPriorityLevelB1
   1889  4+1   7642 A6   C8 42            lda   rsv_priority_1,u
   1890                            
   1891        7645               ESP_CheckPriorityB1
   1892  2     7645 81   00               cmpa  #0                         >>
   1893  3     7647 26   39               bne   ESP_NextObjectB1           >>
   1894                            
   1895        7649               ESP_UnsetCheckRefreshB1
   1896  4+1   7649 A6   C8 29            lda   rsv_render_flags,u
   1897  4+1   764C E6   42               ldb   render_flags,u
   1898  2     764E C4   10               andb  #render_fixedoverlay_mask
   1899  3     7650 26   05               bne   ESP_CheckEraseB1
   1900  2     7652 84   FE               anda  #:rsv_render_checkrefresh_m>>
   1901  4+1   7654 A7   C8 29            sta   rsv_render_flags,u
   1902                            
   1903        7657               ESP_CheckEraseB1
   1904  2     7657 84   02               anda  #rsv_render_erasesprite_mas>>
   1905  3     7659 27   27               beq   ESP_NextObjectB1
   1906  2     765B C4   10               andb  #render_fixedoverlay_mask
   1907  3     765D 26   20               bne   ESP_UnsetOnScreenFlagB1
   1908                            
   1909        765F               ESP_CallEraseRoutineB1
   1910  6     765F FF   7673             stu   ESP_CallEraseRoutineB1_00+1>>
   1911  5+1   7662 AE   C8 47            ldx   rsv_prev_mapping_frame_1,u >>
   1912  4+1   7665 A6   06               lda   page_erase_routine,x
   1913  5     7667 B7   E7E5             sta   $E7E5                      >>
   1914  5+1   766A EE   C8 49            ldu   rsv_bgdata_1,u             >>
   1915  7+4   766D AD   98 07            jsr   [erase_routine,x]          >>
   1916  4+0   7670 31   C4               leay  ,u                         >>
   1917        7672               ESP_CallEraseRoutineB1_00
   1918  3     7672 CE   0000             ldu   #$0000                     >>
   1919  5+1   7675 EC   C8 49            ldd   rsv_bgdata_1,u             >>
   1920  2     7678 C4   C0               andb  #256-cell_size             >>
   1921  6     767A 1F   01               tfr   d,x                        >>
   1922                            
   1923        767C               ESP_FreeEraseBufferB1
   1924  8     767C BD   797C             jsr   BgBufferFree               >>
   1925                            
   1926        767F               ESP_UnsetOnScreenFlagB1
   1927  6+1   767F 6F   C8 51            clr   rsv_onscreen_1,u           >>
   1928                            
   1929        7682               ESP_NextObjectB1
   1930  5+1   7682 EE   C8 43            ldu   rsv_priority_prev_obj_1,u
   1931  3     7685 26   BB               bne   ESP_ProcessEachPriorityLeve>>
   1932  5     7687 39                    rts
   1933
   1934                                   INCLUD UNSETDSP
   1935                           * --------------------------------------->>
   1936                           * UnsetDisplayPriority
   1937                           * --------------------
   1938                           * Subroutine to unset sprites in Display >>
   1939                           * Read Lst_Priority_Unset_0/1
   1940                           *
   1941                           * input REG : none
   1942                           * --------------------------------------->>
   1943                            
   1944        7688               UnsetDisplayPriority
   1945
   1946        7688               UDP_Start
   1947  5     7688 B6   611A             lda   Glb_Cur_Wrk_Screen_Id      >>
   1948  3     768B 26   6D               bne   UDP_B1
   1949                            
   1950        768D               UDP_B0
   1951  3     768D 8E   64E7             ldx   #Lst_Priority_Unset_0+2
   1952                            
   1953        7690               UDP_CheckEndB0
   1954  7     7690 BC   64E5             cmpx  Lst_Priority_Unset_0       >>
   1955  3     7693 26   07               bne   UDP_CheckPrioPrevB0
   1956                            
   1957        7695               UDP_InitListB0
   1958  3     7695 8E   64E7             ldx   #Lst_Priority_Unset_0+2
   1959  6     7698 BF   64E5             stx   Lst_Priority_Unset_0       >>
   1960  5     769B 39                    rts
   1961                            
   1962        769C               UDP_CheckPrioPrevB0
   1963  5+3   769C EE   81               ldu   ,x++
   1964  5+1   769E EC   C8 33            ldd   rsv_priority_prev_obj_0,u
   1965  3     76A1 26   11               bne   UDP_ChainPrevB0
   1966                            
   1967  4+1   76A3 A6   C8 32            lda   rsv_priority_0,u
   1968  2     76A6 48                    lsla
   1969  4     76A7 108E 64C1             ldy   #Tbl_Priority_First_Entry_0>>
   1970  4+1   76AB 31   A6               leay  a,y
   1971  5+1   76AD EC   C8 35            ldd   rsv_priority_next_obj_0,u
   1972  5+0   76B0 ED   A4               std   ,y
   1973  3     76B2 20   0A               bra   UDP_CheckPrioNextB0
   1974                            
   1975        76B4               UDP_ChainPrevB0
   1976  5+1   76B4 EC   C8 35            ldd   rsv_priority_next_obj_0,u
   1977  6+1   76B7 10AE C8 33            ldy   rsv_priority_prev_obj_0,u
   1978  5+1   76BB ED   A8 35            std   rsv_priority_next_obj_0,y
   1979
   1980        76BE               UDP_CheckPrioNextB0
   1981  5+1   76BE EC   C8 35            ldd   rsv_priority_next_obj_0,u
   1982  3     76C1 26   11               bne   UDP_ChainNextB0
   1983
   1984  4+1   76C3 A6   C8 32            lda   rsv_priority_0,u
   1985  2     76C6 48                    lsla
   1986  4     76C7 108E 64D3             ldy   #Tbl_Priority_Last_Entry_0
   1987  4+1   76CB 31   A6               leay  a,y
   1988  5+1   76CD EC   C8 33            ldd   rsv_priority_prev_obj_0,u
   1989  5+0   76D0 ED   A4               std   ,y
   1990  3     76D2 20   0A               bra   UDP_CheckDeleteB0
   1991                            
   1992        76D4               UDP_ChainNextB0
   1993  5+1   76D4 EC   C8 33            ldd   rsv_priority_prev_obj_0,u
   1994  6+1   76D7 10AE C8 35            ldy   rsv_priority_next_obj_0,u
   1995  5+1   76DB ED   A8 33            std   rsv_priority_prev_obj_0,y
   1996                            
   1997        76DE               UDP_CheckDeleteB0
   1998  4+1   76DE A6   42               lda   render_flags,u
   1999  2     76E0 84   20               anda  #render_todelete_mask
   2000  3     76E2 27   0F               beq   UDP_SetNewPrioB0
   2001  4+1   76E4 A6   C8 41            lda   rsv_onscreen_0,u
   2002  3     76E7 26   0A               bne   UDP_SetNewPrioB0
   2003  4+1   76E9 A6   C8 51            lda   rsv_onscreen_1,u
   2004  3     76EC 26   05               bne   UDP_SetNewPrioB0
   2005  8     76EE BD   720B             jsr   ClearObj
   2006  3     76F1 20   9D               bra   UDP_CheckEndB0
   2007                            
   2008        76F3               UDP_SetNewPrioB0
   2009  4+1   76F3 A6   43               lda   priority,u
   2010  4+1   76F5 A7   C8 32            sta   rsv_priority_0,u
   2011  3     76F8 20   96               bra   UDP_CheckEndB0
   2012
   2013        76FA               UDP_B1
   2014  3     76FA 8E   658D             ldx   #Lst_Priority_Unset_1+2
   2015                            
   2016        76FD               UDP_CheckEndB1
   2017  7     76FD BC   658B             cmpx  Lst_Priority_Unset_1       >>
   2018  3     7700 26   07               bne   UDP_CheckPrioPrevB1
   2019                            
   2020        7702               UDP_InitListB1
   2021  3     7702 8E   658D             ldx   #Lst_Priority_Unset_1+2
   2022  6     7705 BF   658B             stx   Lst_Priority_Unset_1       >>
   2023  5     7708 39                    rts
   2024                            
   2025        7709               UDP_CheckPrioPrevB1
   2026  5+3   7709 EE   81               ldu   ,x++
   2027  5+1   770B EC   C8 43            ldd   rsv_priority_prev_obj_1,u
   2028  3     770E 26   11               bne   UDP_ChainPrevB1
   2029                            
   2030  4+1   7710 A6   C8 42            lda   rsv_priority_1,u
   2031  2     7713 48                    lsla
   2032  4     7714 108E 6567             ldy   #Tbl_Priority_First_Entry_1>>
   2033  4+1   7718 31   A6               leay  a,y
   2034  5+1   771A EC   C8 45            ldd   rsv_priority_next_obj_1,u
   2035  5+0   771D ED   A4               std   ,y
   2036  3     771F 20   0A               bra   UDP_CheckPrioNextB1
   2037                            
   2038        7721               UDP_ChainPrevB1
   2039  5+1   7721 EC   C8 45            ldd   rsv_priority_next_obj_1,u
   2040  6+1   7724 10AE C8 43            ldy   rsv_priority_prev_obj_1,u
   2041  5+1   7728 ED   A8 45            std   rsv_priority_next_obj_1,y
   2042
   2043        772B               UDP_CheckPrioNextB1
   2044  5+1   772B EC   C8 45            ldd   rsv_priority_next_obj_1,u
   2045  3     772E 26   11               bne   UDP_ChainNextB1
   2046
   2047  4+1   7730 A6   C8 42            lda   rsv_priority_1,u
   2048  2     7733 48                    lsla
   2049  4     7734 108E 6579             ldy   #Tbl_Priority_Last_Entry_1
   2050  4+1   7738 31   A6               leay  a,y
   2051  5+1   773A EC   C8 43            ldd   rsv_priority_prev_obj_1,u
   2052  5+0   773D ED   A4               std   ,y
   2053  3     773F 20   0A               bra   UDP_CheckDeleteB1
   2054                            
   2055        7741               UDP_ChainNextB1
   2056  5+1   7741 EC   C8 43            ldd   rsv_priority_prev_obj_1,u
   2057  6+1   7744 10AE C8 45            ldy   rsv_priority_next_obj_1,u
   2058  5+1   7748 ED   A8 43            std   rsv_priority_prev_obj_1,y
   2059                            
   2060        774B               UDP_CheckDeleteB1
   2061  4+1   774B A6   42               lda   render_flags,u
   2062  2     774D 84   20               anda  #render_todelete_mask
   2063  3     774F 27   0F               beq   UDP_SetNewPrioB1
   2064  4+1   7751 A6   C8 41            lda   rsv_onscreen_0,u
   2065  3     7754 26   0A               bne   UDP_SetNewPrioB1
   2066  4+1   7756 A6   C8 51            lda   rsv_onscreen_1,u
   2067  3     7759 26   05               bne   UDP_SetNewPrioB1
   2068  8     775B BD   720B             jsr   ClearObj
   2069  3     775E 20   9D               bra   UDP_CheckEndB1
   2070                            
   2071        7760               UDP_SetNewPrioB1
   2072  4+1   7760 A6   43               lda   priority,u
   2073  4+1   7762 A7   C8 42            sta   rsv_priority_1,u
   2074  3     7765 20   96               bra   UDP_CheckEndB1
   2075
   2076                                   INCLUD DRAWSPR
   2077                           * --------------------------------------->>
   2078                           * DrawSprites
   2079                           * ------------
   2080                           * Subroutine to draw sprites on screen
   2081                           * Read Display Priority Structure (back t>>
   2082                           * priority: 0 - unregistred
   2083                           * priority: 1 - register non moving overl>>
   2084                           * priority; 2-8 - register moving sprite >>
   2085                           *
   2086                           * input REG : none
   2087                           * --------------------------------------->>
   2088                            
   2089        7767               DrawSprites
   2090
   2091        7767               DRS_Start
   2092  5     7767 B6   611A             lda   Glb_Cur_Wrk_Screen_Id      >>
   2093  3     776A 26   41               bne   DRS_P8B1
   2094                            
   2095        776C               DRS_P8B0
   2096  6     776C BE   64D1             ldx   DPS_buffer_0+buf_Tbl_Priori>>
   2097  3     776F 27   03               beq   DRS_P7B0
   2098  8     7771 BD   77EE             jsr   DRS_ProcessEachPriorityLeve>>
   2099        7774               DRS_P7B0
   2100  6     7774 BE   64CF             ldx   DPS_buffer_0+buf_Tbl_Priori>>
   2101  3     7777 27   03               beq   DRS_P6B0
   2102  8     7779 BD   77EE             jsr   DRS_ProcessEachPriorityLeve>>
   2103        777C               DRS_P6B0
   2104  6     777C BE   64CD             ldx   DPS_buffer_0+buf_Tbl_Priori>>
   2105  3     777F 27   03               beq   DRS_P5B0
   2106  8     7781 BD   77EE             jsr   DRS_ProcessEachPriorityLeve>>
   2107        7784               DRS_P5B0
   2108  6     7784 BE   64CB             ldx   DPS_buffer_0+buf_Tbl_Priori>>
   2109  3     7787 27   03               beq   DRS_P4B0
   2110  8     7789 BD   77EE             jsr   DRS_ProcessEachPriorityLeve>>
   2111        778C               DRS_P4B0
   2112  6     778C BE   64C9             ldx   DPS_buffer_0+buf_Tbl_Priori>>
   2113  3     778F 27   03               beq   DRS_P3B0
   2114  8     7791 BD   77EE             jsr   DRS_ProcessEachPriorityLeve>>
   2115        7794               DRS_P3B0
   2116  6     7794 BE   64C7             ldx   DPS_buffer_0+buf_Tbl_Priori>>
   2117  3     7797 27   03               beq   DRS_P2B0
   2118  8     7799 BD   77EE             jsr   DRS_ProcessEachPriorityLeve>>
   2119        779C               DRS_P2B0
   2120  6     779C BE   64C5             ldx   DPS_buffer_0+buf_Tbl_Priori>>
   2121  3     779F 27   03               beq   DRS_P1B0
   2122  8     77A1 BD   77EE             jsr   DRS_ProcessEachPriorityLeve>>
   2123        77A4               DRS_P1B0
   2124  6     77A4 BE   64C3             ldx   DPS_buffer_0+buf_Tbl_Priori>>
   2125  3     77A7 27   03               beq   DRS_rtsB0
   2126  8     77A9 BD   77EE             jsr   DRS_ProcessEachPriorityLeve>>
   2127        77AC               DRS_rtsB0
   2128  5     77AC 39                    rts
   2129                            
   2130        77AD               DRS_P8B1
   2131  6     77AD BE   6577             ldx   DPS_buffer_1+buf_Tbl_Priori>>
   2132  3     77B0 27   03               beq   DRS_P7B1
   2133  8     77B2 BD   78A2             jsr   DRS_ProcessEachPriorityLeve>>
   2134        77B5               DRS_P7B1
   2135  6     77B5 BE   6575             ldx   DPS_buffer_1+buf_Tbl_Priori>>
   2136  3     77B8 27   03               beq   DRS_P6B1
   2137  8     77BA BD   78A2             jsr   DRS_ProcessEachPriorityLeve>>
   2138        77BD               DRS_P6B1
   2139  6     77BD BE   6573             ldx   DPS_buffer_1+buf_Tbl_Priori>>
   2140  3     77C0 27   03               beq   DRS_P5B1
   2141  8     77C2 BD   78A2             jsr   DRS_ProcessEachPriorityLeve>>
   2142        77C5               DRS_P5B1
   2143  6     77C5 BE   6571             ldx   DPS_buffer_1+buf_Tbl_Priori>>
   2144  3     77C8 27   03               beq   DRS_P4B1
   2145  8     77CA BD   78A2             jsr   DRS_ProcessEachPriorityLeve>>
   2146        77CD               DRS_P4B1
   2147  6     77CD BE   656F             ldx   DPS_buffer_1+buf_Tbl_Priori>>
   2148  3     77D0 27   03               beq   DRS_P3B1
   2149  8     77D2 BD   78A2             jsr   DRS_ProcessEachPriorityLeve>>
   2150        77D5               DRS_P3B1
   2151  6     77D5 BE   656D             ldx   DPS_buffer_1+buf_Tbl_Priori>>
   2152  3     77D8 27   03               beq   DRS_P2B1
   2153  8     77DA BD   78A2             jsr   DRS_ProcessEachPriorityLeve>>
   2154        77DD               DRS_P2B1
   2155  6     77DD BE   656B             ldx   DPS_buffer_1+buf_Tbl_Priori>>
   2156  3     77E0 27   03               beq   DRS_P1B1
   2157  8     77E2 BD   78A2             jsr   DRS_ProcessEachPriorityLeve>>
   2158        77E5               DRS_P1B1
   2159  6     77E5 BE   6569             ldx   DPS_buffer_1+buf_Tbl_Priori>>
   2160  3     77E8 27   03               beq   DRS_rtsB1
   2161  8     77EA BD   78A2             jsr   DRS_ProcessEachPriorityLeve>>
   2162        77ED               DRS_rtsB1
   2163  5     77ED 39                    rts
   2164
   2165        77EE               DRS_ProcessEachPriorityLevelB0
   2166  4+1   77EE A6   88 29            lda   rsv_render_flags,x
   2167  2     77F1 84   04               anda  #rsv_render_displaysprite_m>>
   2168  3     77F3 27   54               beq   DRS_NextObjectB0
   2169  4+1   77F5 A6   88 41            lda   rsv_onscreen_0,x
   2170  3     77F8 26   4F               bne   DRS_NextObjectB0
   2171  4+1   77FA A6   02               lda   render_flags,x
   2172  2     77FC 84   10               anda  #render_fixedoverlay_mask
   2173  3     77FE 26   51               bne   DRS_DrawWithoutBackupB0
   2174  5+1   7800 EE   88 2C            ldu   rsv_curr_mapping_frame,x
   2175  4+1   7803 A6   49               lda   erase_nb_cell,u
   2176  8     7805 BD   7929             jsr   BgBufferAlloc              >>
   2177  5     7808 108C 0000             cmpy  #$0000                     >>
   2178  3     780C 27   3B               beq   DRS_NextObjectB0           >>
   2179  5+1   780E EC   88 12            ldd   xy_pixel,x                 >>
   2180  5+1   7811 ED   88 3B            std   rsv_prev_xy_pixel_0,x      >>
   2181  8     7814 BD   7875             jsr   DRS_XYToAddress
   2182  5+1   7817 EE   88 2C            ldu   rsv_curr_mapping_frame,x   >>
   2183  5+1   781A EF   88 37            stu   rsv_prev_mapping_frame_0,x >>
   2184  4+1   781D A6   40               lda   page_bckdraw_routine,u
   2185  5     781F B7   E7E5             sta   $E7E5                      >>
   2186  6     7822 BF   7833             stx   DRS_dyn3B0+1               >>
   2187  5+1   7825 AE   41               ldx   bckdraw_routine,u
   2188  4+0   7827 33   A4               leau  ,y                         >>
   2189  4     7829 108E 6121             ldy   #Glb_Sprite_Screen_Pos_Part>>
   2190  6     782D FC   611F             ldd   Glb_Sprite_Screen_Pos_PartA>>
   2191  7+0   7830 AD   84               jsr   ,x                         >>
   2192        7832               DRS_dyn3B0
   2193  3     7832 8E   0000             ldx   #$0000                     >>
   2194  5+1   7835 EF   88 39            stu   rsv_bgdata_0,x             >>
   2195  5+1   7838 EC   88 2E            ldd   rsv_xy1_pixel,x            >>
   2196  5+1   783B ED   88 3D            std   rsv_prev_xy1_pixel_0,x     >>
   2197  5+1   783E EC   88 30            ldd   rsv_xy2_pixel,x            >>
   2198  5+1   7841 ED   88 3F            std   rsv_prev_xy2_pixel_0,x     >>
   2199  2     7844 86   01               lda   #$01
   2200  4+1   7846 A7   88 41            sta   rsv_onscreen_0,x           >>
   2201        7849               DRS_NextObjectB0
   2202  5+1   7849 AE   88 35            ldx   rsv_priority_next_obj_0,x
   2203  6     784C 1026 FF9E             lbne  DRS_ProcessEachPriorityLeve>>
   2204  5     7850 39                    rts
   2205                            
   2206        7851               DRS_DrawWithoutBackupB0
   2207  5+1   7851 EC   88 12            ldd   xy_pixel,x                 >>
   2208  5+1   7854 ED   88 3B            std   rsv_prev_xy_pixel_0,x      >>
   2209  8     7857 BD   7875             jsr   DRS_XYToAddress
   2210  5+1   785A EE   88 2C            ldu   rsv_curr_mapping_frame,x   >>
   2211  5+1   785D EF   88 37            stu   rsv_prev_mapping_frame_0,x >>
   2212  4+1   7860 A6   43               lda   page_draw_routine,u
   2213  5     7862 B7   E7E5             sta   $E7E5                      >>
   2214  6     7865 BF   7833             stx   DRS_dyn3B0+1               >>
   2215  5+1   7868 AE   44               ldx   draw_routine,u
   2216  4     786A 108E 6121             ldy   #Glb_Sprite_Screen_Pos_Part>>
   2217  6     786E FC   611F             ldd   Glb_Sprite_Screen_Pos_PartA>>
   2218  7+0   7871 AD   84               jsr   ,x                         >>
   2219  3     7873 20   BD               bra   DRS_dyn3B0
   2220
   2221                           *****************************************>>
   2222                           * x_pixel and y_pixel coordinate system
   2223                           * x coordinates:
   2224                           *    - off-screen left 00-2F (0-47)
   2225                           *    - on screen 30-CF (48-207)
   2226                           *    - off-screen right D0-FF (208-255)
   2227                           *
   2228                           * y coordinates:
   2229                           *    - off-screen top 00-1B (0-27)
   2230                           *    - on screen 1C-E3 (28-227)
   2231                           *    - off-screen bottom E4-FF (228-255)
   2232                           *****************************************>>
   2233
   2234        7875               DRS_XYToAddress
   2235  2     7875 80   30               suba  #$30
   2236  2     7877 C0   1C               subb  #$1C
   2237  2     7879 44                    lsra                             >>
   2238  2     787A 44                    lsra                             >>
   2239  3     787B 25   12               bcs   DRS_XYToAddressRAMBFirst   >>
   2240        787D               DRS_XYToAddressRAMAFirst
   2241  5     787D B7   7885             sta   DRS_dyn1+2
   2242  2     7880 86   28               lda   #$28                       >>
   2243  11    7882 3D                    mul
   2244        7883               DRS_dyn1
   2245  4     7883 C3   0000             addd  #$0000                     >>
   2246  6     7886 FD   611F             std   Glb_Sprite_Screen_Pos_PartA>>
   2247  2     7889 8A   20               ora   #$20                       >>
   2248  6     788B FD   6121             std   Glb_Sprite_Screen_Pos_PartB>>
   2249  5     788E 39                    rts
   2250        788F               DRS_XYToAddressRAMBFirst
   2251  5     788F B7   7897             sta   DRS_dyn2+2
   2252  2     7892 86   28               lda   #$28                       >>
   2253  11    7894 3D                    mul
   2254        7895               DRS_dyn2
   2255  4     7895 C3   2000             addd  #$2000                     >>
   2256  6     7898 FD   611F             std   Glb_Sprite_Screen_Pos_PartA>>
   2257  4     789B 83   1FFF             subd  #$1FFF
   2258  6     789E FD   6121             std   Glb_Sprite_Screen_Pos_PartB>>
   2259  5     78A1 39                    rts
   2260                            
   2261        78A2               DRS_ProcessEachPriorityLevelB1
   2262  4+1   78A2 A6   88 29            lda   rsv_render_flags,x
   2263  2     78A5 84   04               anda  #rsv_render_displaysprite_m>>
   2264  3     78A7 27   54               beq   DRS_NextObjectB1
   2265  4+1   78A9 A6   88 51            lda   rsv_onscreen_1,x
   2266  3     78AC 26   4F               bne   DRS_NextObjectB1
   2267  4+1   78AE A6   02               lda   render_flags,x
   2268  2     78B0 84   10               anda  #render_fixedoverlay_mask
   2269  3     78B2 26   51               bne   DRS_DrawWithoutBackupB1
   2270  5+1   78B4 EE   88 2C            ldu   rsv_curr_mapping_frame,x
   2271  4+1   78B7 A6   49               lda   erase_nb_cell,u
   2272  8     78B9 BD   7929             jsr   BgBufferAlloc              >>
   2273  5     78BC 108C 0000             cmpy  #$0000                     >>
   2274  3     78C0 27   3B               beq   DRS_NextObjectB1           >>
   2275  5+1   78C2 EC   88 12            ldd   xy_pixel,x                 >>
   2276  5+1   78C5 ED   88 4B            std   rsv_prev_xy_pixel_1,x      >>
   2277  8     78C8 BD   7875             jsr   DRS_XYToAddress
   2278  5+1   78CB EE   88 2C            ldu   rsv_curr_mapping_frame,x   >>
   2279  5+1   78CE EF   88 47            stu   rsv_prev_mapping_frame_1,x >>
   2280  4+1   78D1 A6   40               lda   page_bckdraw_routine,u
   2281  5     78D3 B7   E7E5             sta   $E7E5                      >>
   2282  6     78D6 BF   78E7             stx   DRS_dyn3B1+1               >>
   2283  5+1   78D9 AE   41               ldx   bckdraw_routine,u
   2284  4+0   78DB 33   A4               leau  ,y                         >>
   2285  4     78DD 108E 6121             ldy   #Glb_Sprite_Screen_Pos_Part>>
   2286  6     78E1 FC   611F             ldd   Glb_Sprite_Screen_Pos_PartA>>
   2287  7+0   78E4 AD   84               jsr   ,x                         >>
   2288        78E6               DRS_dyn3B1
   2289  3     78E6 8E   0000             ldx   #$0000                     >>
   2290  5+1   78E9 EF   88 49            stu   rsv_bgdata_1,x             >>
   2291  5+1   78EC EC   88 2E            ldd   rsv_xy1_pixel,x            >>
   2292  5+1   78EF ED   88 4D            std   rsv_prev_xy1_pixel_1,x     >>
   2293  5+1   78F2 EC   88 30            ldd   rsv_xy2_pixel,x            >>
   2294  5+1   78F5 ED   88 4F            std   rsv_prev_xy2_pixel_1,x     >>
   2295  2     78F8 86   01               lda   #$01
   2296  4+1   78FA A7   88 51            sta   rsv_onscreen_1,x           >>
   2297        78FD               DRS_NextObjectB1
   2298  5+1   78FD AE   88 45            ldx   rsv_priority_next_obj_1,x
   2299  6     7900 1026 FF9E             lbne  DRS_ProcessEachPriorityLeve>>
   2300  5     7904 39                    rts
   2301                            
   2302        7905               DRS_DrawWithoutBackupB1
   2303  5+1   7905 EC   88 12            ldd   xy_pixel,x                 >>
   2304  5+1   7908 ED   88 4B            std   rsv_prev_xy_pixel_1,x      >>
   2305  8     790B BD   7875             jsr   DRS_XYToAddress
   2306  5+1   790E EE   88 2C            ldu   rsv_curr_mapping_frame,x   >>
   2307  5+1   7911 EF   88 47            stu   rsv_prev_mapping_frame_1,x >>
   2308  4+1   7914 A6   43               lda   page_draw_routine,u
   2309  5     7916 B7   E7E5             sta   $E7E5                      >>
   2310  6     7919 BF   78E7             stx   DRS_dyn3B1+1               >>
   2311  5+1   791C AE   44               ldx   draw_routine,u
   2312  4     791E 108E 6121             ldy   #Glb_Sprite_Screen_Pos_Part>>
   2313  6     7922 FC   611F             ldd   Glb_Sprite_Screen_Pos_PartA>>
   2314  7+0   7925 AD   84               jsr   ,x                         >>
   2315  3     7927 20   BD               bra   DRS_dyn3B1
   2316
   2317                                   INCLUD BGBALLOC
   2318                           * --------------------------------------->>
   2319                           * BgBufferAlloc
   2320                           * -------------
   2321                           * Subroutine to allocate memory into back>>
   2322                           *
   2323                           * input  REG : [a] number of requested ce>>
   2324                           * output REG : [y] cell_end or 0000 if no>>
   2325                           * --------------------------------------->>
   2326
   2327        7929               BgBufferAlloc
   2328  5+3   7929 34   14               pshs  b,x
   2329  5     792B F6   611A             ldb   Glb_Cur_Wrk_Screen_Id      >>
   2330  3     792E 26   09               bne   BBA1                       >>
   2331                            
   2332        7930               BBA0
   2333  3     7930 8E   6123             ldx   #Lst_FreeCellFirstEntry_0  >>
   2334  7     7933 10BE 6123             ldy   Lst_FreeCellFirstEntry_0   >>
   2335  3     7937 20   07               bra   BBA_Next
   2336                            
   2337        7939               BBA1
   2338  3     7939 8E   62F2             ldx   #Lst_FreeCellFirstEntry_1  >>
   2339  7     793C 10BE 62F2             ldy   Lst_FreeCellFirstEntry_1   >>
   2340                            
   2341        7940               BBA_Next
   2342  3     7940 27   38               beq   BBA_rts                    >>
   2343  4+1   7942 A1   20               cmpa  nb_cells,y                 >>
   2344  3     7944 27   09               beq   BBA_FitCell                >>
   2345  3     7946 23   12               bls   BBA_DivideCell             >>
   2346  4+1   7948 30   25               leax  next_entry,y               >>
   2347  6+1   794A 10AE 25               ldy   next_entry,y               >>
   2348  3     794D 20   F1               bra   BBA_Next
   2349                            
   2350        794F               BBA_FitCell
   2351  5+1   794F EC   25               ldd   next_entry,y
   2352  5+0   7951 ED   84               std   ,x                         >>
   2353  6+1   7953 6F   20               clr   nb_cells,y                 >>
   2354  6+1   7955 10AE 23               ldy   cell_end,y                 >>
   2355  3     7958 20   20               bra   BBA_rts
   2356                            
   2357        795A               BBA_DivideCell
   2358  5     795A B7   7960             sta   BBA_dyn+1
   2359  4+1   795D E6   20               ldb   nb_cells,y
   2360        795F               BBA_dyn
   2361  2     795F C0   00               subb  #$00                       >>
   2362  4+1   7961 E7   20               stb   nb_cells,y                 >>
   2363                            
   2364  2     7963 C6   40               ldb   #cell_size
   2365  11    7965 3D                    mul
   2366  2     7966 88   FF               eora  #$FF                       >>
   2367  2     7968 C8   FF               eorb  #$FF                       >>
   2368  4     796A C3   0001             addd  #$01
   2369  5+1   796D AE   23               ldx   cell_end,y
   2370  6     796F BF   7978             stx   cell_end_return+2
   2371  4+4   7972 30   8B               leax  d,x                        >>
   2372  5+1   7974 AF   23               stx   cell_end,y                 >>
   2373        7976               cell_end_return
   2374  4     7976 108E 0000             ldy   #$0000
   2375        797A               BBA_rts
   2376  5+5   797A 35   94               puls  b,x,pc
   2377
   2378                                   INCLUD BGBFREE
   2379                           * --------------------------------------->>
   2380                           * BgBufferFree
   2381                           * ------------
   2382                           * Subroutine to free memory from backgrou>>
   2383                           *
   2384                           * input  REG : [x] cell_start
   2385                           *              [y] cell_end
   2386                           * output REG : none
   2387                           * --------------------------------------->>
   2388
   2389        797C               BgBufferFree
   2390  5+4   797C 34   46               pshs  d,u
   2391  3     797E CC   0000             ldd   #$0000
   2392  6     7981 FD   79DE             std   BBF_SetNewEntryNextentry+1 >>
   2393  5     7984 F6   611A             ldb   Glb_Cur_Wrk_Screen_Id      >>
   2394  3     7987 26   16               bne   BBF1                       >>
   2395                            
   2396        7989               BBF0
   2397  5+1   7989 EE   C8 37            ldu   rsv_prev_mapping_frame_0,u >>
   2398  4+1   798C A6   49               lda   erase_nb_cell,u            >>
   2399  3     798E CE   6123             ldu   #Lst_FreeCellFirstEntry_0
   2400  6     7991 FF   79E3             stu   BBF_SetNewEntryPrevLink+1  >>
   2401  3     7994 CE   6125             ldu   #Lst_FreeCell_0            >>
   2402  6     7997 FF   79CC             stu   BBF_AddNewEntryAtEnd+1     >>
   2403  6     799A FE   6123             ldu   Lst_FreeCellFirstEntry_0   >>
   2404  3     799D 20   14               bra   BBF_Next
   2405                            
   2406        799F               BBF1
   2407  5+1   799F EE   C8 47            ldu   rsv_prev_mapping_frame_1,u
   2408  4+1   79A2 A6   49               lda   erase_nb_cell,u
   2409  3     79A4 CE   62F2             ldu   #Lst_FreeCellFirstEntry_1
   2410  6     79A7 FF   79E3             stu   BBF_SetNewEntryPrevLink+1
   2411  3     79AA CE   62F4             ldu   #Lst_FreeCell_1
   2412  6     79AD FF   79CC             stu   BBF_AddNewEntryAtEnd+1
   2413  6     79B0 FE   62F2             ldu   Lst_FreeCellFirstEntry_1
   2414                            
   2415        79B3               BBF_Next
   2416  3     79B3 27   16               beq   BBF_AddNewEntryAtEnd       >>
   2417  7+1   79B5 10AC 41               cmpy  cell_start,u               >>
   2418  3     79B8 27   2D               beq   BBF_ExpandAtStart          >>
   2419  3     79BA 22   4C               bhi   BBF_ExpandAtEnd            >>
   2420  5+1   79BC EE   45               ldu   next_entry,u               >>
   2421  6     79BE 1F   30               tfr   u,d
   2422  4     79C0 C3   0005             addd  #next_entry                >>
   2423  6     79C3 FD   79E3             std   BBF_SetNewEntryPrevLink+1
   2424  3     79C6 20   EB               bra   BBF_Next
   2425
   2426        79C8               BBF_AddNewEntry
   2427  6     79C8 FF   79DE             stu   BBF_SetNewEntryNextentry+1
   2428        79CB               BBF_AddNewEntryAtEnd
   2429  3     79CB CE   0000             ldu   #$0000                     >>
   2430        79CE               BBF_FindFreeSlot
   2431  4+1   79CE E6   40               ldb   nb_cells,u                 >>
   2432  3     79D0 27   04               beq   BBF_SetNewEntry            >>
   2433  4+1   79D2 33   47               leau  entry_size,u               >>
   2434  3     79D4 20   F8               bra   BBF_FindFreeSlot           >>
   2435        79D6               BBF_SetNewEntry
   2436  4+1   79D6 A7   40               sta   nb_cells,u                 >>
   2437  5+1   79D8 AF   41               stx   cell_start,u               >>
   2438  6+1   79DA 10AF 43               sty   cell_end,u                 >>
   2439        79DD               BBF_SetNewEntryNextentry
   2440  3     79DD 8E   0000             ldx   #$0000                     >>
   2441  5+1   79E0 AF   45               stx   next_entry,u               >>
   2442        79E2               BBF_SetNewEntryPrevLink
   2443  6     79E2 FF   FFFF             stu   $FFFF                      >>
   2444  3     79E5 20   2C               bra   BBF_rts
   2445
   2446        79E7               BBF_ExpandAtStart
   2447  5+1   79E7 AF   41               stx   cell_start,u
   2448  4+1   79E9 AB   40               adda  nb_cells,u
   2449  4+1   79EB A7   40               sta   nb_cells,u
   2450  6+1   79ED 10AE 45               ldy   next_entry,u
   2451  3     79F0 27   21               beq   BBF_rts
   2452        79F2               BBF_Join
   2453  6+1   79F2 AC   23               cmpx  cell_end,y
   2454  3     79F4 26   1D               bne   BBF_rts
   2455  5+1   79F6 EC   21               ldd   cell_start,y
   2456  5+1   79F8 ED   41               std   cell_start,u
   2457  4+1   79FA A6   20               lda   nb_cells,y
   2458  4+1   79FC AB   40               adda  nb_cells,u
   2459  4+1   79FE A7   40               sta   nb_cells,u
   2460  6+1   7A00 6F   20               clr   nb_cells,y                 >>
   2461  5+1   7A02 EC   25               ldd   next_entry,y
   2462  5+1   7A04 ED   45               std   next_entry,u               >>
   2463  3     7A06 20   0B               bra   BBF_rts
   2464
   2465        7A08               BBF_ExpandAtEnd
   2466  6+1   7A08 AC   43               cmpx  cell_end,u
   2467  3     7A0A 26   BC               bne   BBF_AddNewEntry
   2468  6+1   7A0C 10AF 43               sty   cell_end,u
   2469  4+1   7A0F AB   40               adda  nb_cells,u
   2470  4+1   7A11 A7   40               sta   nb_cells,u
   2471                            
   2472        7A13               BBF_rts
   2473  5+6   7A13 35   C6               puls  d,u,pc
   2474
    159                            
    160                           * =======================================>>
    161                           * Level Specific Generated Data
    162                           * IMG and ANI should be in first position>>
    163                           * =======================================>>
   2475                                   INCLUD IMAGEIDX
   2476                           * Generated Code
   2477
   2478        7A15               Img_star_4 *@globals
   2479        7A15 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7A19 00 00 00 00
               7A1D 00 00 00 00
               7A21 00 00
   2480        7A23               Img_star_3 *@globals
   2481        7A23 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7A27 00 00 00 00
               7A2B 00 00 00 00
               7A2F 00 00
   2482        7A31               Img_sonicHand *@globals
   2483        7A31 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7A35 00 00 00 00
               7A39 00 00 00 00
               7A3D 00 00
(2484)0:IMAGEIDX.ASM Multiply Defined Symbol
   2484 Img_star_2 *@globals
   2485        7A3F 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7A43 00 00 00 00
               7A47 00 00 00 00
               7A4B 00 00
(2486)0:IMAGEIDX.ASM Multiply Defined Symbol
   2486 Img_star_2 *@globals
   2487        7A4D 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7A51 00 00 00 00
               7A55 00 00 00 00
               7A59 00 00
(2488)0:IMAGEIDX.ASM Multiply Defined Symbol
   2488 Img_star_1 *@globals
   2489        7A5B 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7A5F 00 00 00 00
               7A63 00 00 00 00
               7A67 00 00
(2490)0:IMAGEIDX.ASM Multiply Defined Symbol
   2490 Img_star_1 *@globals
   2491        7A69 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7A6D 00 00 00 00
               7A71 00 00 00 00
               7A75 00 00
   2492        7A77               Img_emblemBack08 *@globals
   2493        7A77 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7A7B 00 00 00 00
               7A7F 00 00 00 00
               7A83 00 00
   2494        7A85               Img_emblemBack07 *@globals
   2495        7A85 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7A89 00 00 00 00
               7A8D 00 00 00 00
               7A91 00 00
   2496        7A93               Img_emblemBack09 *@globals
   2497        7A93 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7A97 00 00 00 00
               7A9B 00 00 00 00
               7A9F 00 00
   2498        7AA1               Img_emblemBack04 *@globals
   2499        7AA1 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7AA5 00 00 00 00
               7AA9 00 00 00 00
               7AAD 00 00
   2500        7AAF               Img_emblemBack03 *@globals
   2501        7AAF 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7AB3 00 00 00 00
               7AB7 00 00 00 00
               7ABB 00 00
   2502        7ABD               Img_emblemBack06 *@globals
   2503        7ABD 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7AC1 00 00 00 00
               7AC5 00 00 00 00
               7AC9 00 00
   2504        7ACB               Img_emblemBack05 *@globals
   2505        7ACB 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7ACF 00 00 00 00
               7AD3 00 00 00 00
               7AD7 00 00
   2506        7AD9               Img_tails_5 *@globals
   2507        7AD9 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7ADD 00 00 00 00
               7AE1 00 00 00 00
               7AE5 00 00
   2508        7AE7               Img_tails_4 *@globals
   2509        7AE7 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7AEB 00 00 00 00
               7AEF 00 00 00 00
               7AF3 00 00
   2510        7AF5               Img_tails_3 *@globals
   2511        7AF5 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7AF9 00 00 00 00
               7AFD 00 00 00 00
               7B01 00 00
   2512        7B03               Img_tails_2 *@globals
   2513        7B03 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7B07 00 00 00 00
               7B0B 00 00 00 00
               7B0F 00 00
   2514        7B11               Img_tails_1 *@globals
   2515        7B11 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7B15 00 00 00 00
               7B19 00 00 00 00
               7B1D 00 00
   2516        7B1F               Img_tailsHand *@globals
   2517        7B1F 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7B23 00 00 00 00
               7B27 00 00 00 00
               7B2B 00 00
   2518        7B2D               Img_sonic_1 *@globals
   2519        7B2D 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7B31 00 00 00 00
               7B35 00 00 00 00
               7B39 00 00
   2520        7B3B               Img_sonic_2 *@globals
   2521        7B3B 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7B3F 00 00 00 00
               7B43 00 00 00 00
               7B47 00 00
   2522        7B49               Img_emblemBack02 *@globals
   2523        7B49 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7B4D 00 00 00 00
               7B51 00 00 00 00
               7B55 00 00
   2524        7B57               Img_emblemBack01 *@globals
   2525        7B57 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7B5B 00 00 00 00
               7B5F 00 00 00 00
               7B63 00 00
   2526        7B65               Img_sonic_5 *@globals
   2527        7B65 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7B69 00 00 00 00
               7B6D 00 00 00 00
               7B71 00 00
   2528        7B73               Img_sonic_3 *@globals
   2529        7B73 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7B77 00 00 00 00
               7B7B 00 00 00 00
               7B7F 00 00
   2530        7B81               Img_sonic_4 *@globals
   2531        7B81 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7B85 00 00 00 00
               7B89 00 00 00 00
               7B8D 00 00
   2532        7B8F               Img_emblemFront07 *@globals
   2533        7B8F 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7B93 00 00 00 00
               7B97 00 00 00 00
               7B9B 00 00
   2534        7B9D               Img_emblemFront08 *@globals
   2535        7B9D 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7BA1 00 00 00 00
               7BA5 00 00 00 00
               7BA9 00 00
   2536        7BAB               Img_emblemFront05 *@globals
   2537        7BAB 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7BAF 00 00 00 00
               7BB3 00 00 00 00
               7BB7 00 00
   2538        7BB9               Img_emblemFront06 *@globals
   2539        7BB9 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7BBD 00 00 00 00
               7BC1 00 00 00 00
               7BC5 00 00
   2540        7BC7               Img_emblemFront03 *@globals
   2541        7BC7 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7BCB 00 00 00 00
               7BCF 00 00 00 00
               7BD3 00 00
   2542        7BD5               Img_emblemFront04 *@globals
   2543        7BD5 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7BD9 00 00 00 00
               7BDD 00 00 00 00
               7BE1 00 00
   2544        7BE3               Img_emblemFront01 *@globals
   2545        7BE3 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7BE7 00 00 00 00
               7BEB 00 00 00 00
               7BEF 00 00
   2546        7BF1               Img_emblemFront02 *@globals
   2547        7BF1 00 00 00 00           fcb   00,00,00,00,00,00,00,00,00,>>
               7BF5 00 00 00 00
               7BF9 00 00 00 00
               7BFD 00 00
   2548
   2549                                   INCLUD ANIMSCPT
   2550                           * Generated Code
   2551
   2552        7BFF 00                    fcb   00
   2553        7C00               Ani_smallStar *@globals
(2554)0:ANIMSCPT.ASM Multiply Defined Symbol
   2554         fdb   Img_star_2
(2555)0:ANIMSCPT.ASM Multiply Defined Symbol
   2555         fdb   Img_star_1
   2556        7C00 00                    fcb   00
   2557        7C01 00                    fcb   00
   2558        7C02               Ani_largeStar *@globals
(2559)0:ANIMSCPT.ASM Multiply Defined Symbol
   2559         fdb   Img_star_1
(2560)0:ANIMSCPT.ASM Multiply Defined Symbol
   2560         fdb   Img_star_2
   2561        7C02 7A23                  fdb   Img_star_3
(2562)0:ANIMSCPT.ASM Multiply Defined Symbol
   2562         fdb   Img_star_2
(2563)0:ANIMSCPT.ASM Multiply Defined Symbol
   2563         fdb   Img_star_1
   2564        7C04 00                    fcb   00
   2565        7C05 00                    fcb   00
   2566        7C06               Ani_tails *@globals
   2567        7C06 7B11                  fdb   Img_tails_1
   2568        7C08 7B03                  fdb   Img_tails_2
   2569        7C0A 7AF5                  fdb   Img_tails_3
   2570        7C0C 7AE7                  fdb   Img_tails_4
   2571        7C0E 7AD9                  fdb   Img_tails_5
   2572        7C10 00                    fcb   00
   2573        7C11 00                    fcb   00
   2574        7C12               Ani_sonic *@globals
   2575        7C12 7B2D                  fdb   Img_sonic_1
   2576        7C14 7B3B                  fdb   Img_sonic_2
   2577        7C16 7B73                  fdb   Img_sonic_3
   2578        7C18 7B81                  fdb   Img_sonic_4
   2579        7C1A 00                    fcb   00
   2580
   2581                                   INCLUD OBJINDEX
   2582                           * Generated Code
   2583
   2584        7C1B               Obj_Index_Page
   2585        7C1B               Obj_Index_Address
   2586
   2587                                   INCLUD LOADACT
   2588                           * Generated Code
   2589
   2590        7C1B               LoadAct
    168                            
    169
    170

000010 Total Errors
 Multiply Defined Symbol    2484 Img_star_2 *@globals
 Multiply Defined Symbol    2486 Img_star_2 *@globals
 Multiply Defined Symbol    2488 Img_star_1 *@globals
 Multiply Defined Symbol    2490 Img_star_1 *@globals
 Multiply Defined Symbol    2554         fdb   Img_star_2
 Multiply Defined Symbol    2555         fdb   Img_star_1
 Multiply Defined Symbol    2559         fdb   Img_star_1
 Multiply Defined Symbol    2560         fdb   Img_star_2
 Multiply Defined Symbol    2562         fdb   Img_star_2
 Multiply Defined Symbol    2563         fdb   Img_star_1

000477 Total Symbols
     1x          Label 7111 am_ObjectMove_01
     1x          Label 7127 am_ObjectMove_02
     3x          Label 6FD9 am_RunNextObject
     2x          Label 6F82 am_SwapVideoPage
     2x          Equ   0004 anim
     0x          Label 707E AnimateSprite
     1x          Label 70AD Anim_dyn
     1x          Label 7100 Anim_End
     1x          Label 70F5 Anim_End_FA
     1x          Label 70EA Anim_End_FB
     1x          Label 70D8 Anim_End_FC
     1x          Label 70D0 Anim_End_FD
     1x          Label 70BF Anim_End_FE
     1x          Label 70C7 Anim_End_FE_dyn
     1x          Label 70B4 Anim_End_FF
     8x          Equ   0008 anim_frame
     4x          Equ   0009 anim_frame_duration
     2x          Label 709F Anim_Next
     1x          Label 708C Anim_Run
     1x          Label 70B3 Anim_Wait
     0x          Label 7C06 Ani_largeStar
     0x          Label 7C00 Ani_smallStar
     0x          Label 7C1E Ani_sonic
     0x          Label 7C12 Ani_tails
     0x          Label 7930 BBA0
     1x          Label 7939 BBA1
     1x          Label 795A BBA_DivideCell
     1x          Label 795F BBA_dyn
     1x          Label 794F BBA_FitCell
     2x          Label 7940 BBA_Next
     2x          Label 797A BBA_rts
     0x          Label 7989 BBF0
     1x          Label 799F BBF1
     1x          Label 79C8 BBF_AddNewEntry
     3x          Label 79CB BBF_AddNewEntryAtEnd
     1x          Label 7A08 BBF_ExpandAtEnd
     1x          Label 79E7 BBF_ExpandAtStart
     1x          Label 79CE BBF_FindFreeSlot
     0x          Label 79F2 BBF_Join
     2x          Label 79B3 BBF_Next
     4x          Label 7A13 BBF_rts
     1x          Label 79D6 BBF_SetNewEntry
     2x          Label 79DD BBF_SetNewEntryNextentry
     3x          Label 79E2 BBF_SetNewEntryPrevLink
     2x          Equ   0001 bckdraw_routine
     2x          Label 7929 BgBufferAlloc
     2x          Label 797C BgBufferFree
     0x          Equ   0007 buf_bgdata
     2x          Equ   0024 buf_Lst_Priority_Unset
     3x          Equ   000F buf_onscreen
     1x          Equ   0005 buf_prev_mapping_frame
     0x          Equ   000B buf_prev_x1_pixel
     0x          Equ   000D buf_prev_x2_pixel
     0x          Equ   000B buf_prev_xy1_pixel
     0x          Equ   000D buf_prev_xy2_pixel
     1x          Equ   0009 buf_prev_xy_pixel
     0x          Equ   0009 buf_prev_x_pixel
     0x          Equ   000C buf_prev_y1_pixel
     0x          Equ   000E buf_prev_y2_pixel
     0x          Equ   000A buf_prev_y_pixel
     5x          Equ   0000 buf_priority
     4x          Equ   0003 buf_priority_next_obj
     1x          Equ   0001 buf_priority_prev_obj
    33x          Equ   0000 buf_Tbl_Priority_First_Entry
    18x          Equ   0012 buf_Tbl_Priority_Last_Entry
     0x          Equ   0040 c1_button_A_mask
     0x          Equ   0002 c1_button_down_mask
     0x          Equ   0004 c1_button_left_mask
     0x          Equ   0008 c1_button_right_mask
     0x          Equ   0001 c1_button_up_mask
     0x          Equ   0080 c2_button_A_mask
     0x          Equ   0020 c2_button_down_mask
     0x          Equ   0040 c2_button_left_mask
     0x          Equ   0080 c2_button_right_mask
     0x          Equ   0010 c2_button_up_mask
     7x          Equ   0003 cell_end
     1x          Label 7976 cell_end_return
     5x          Equ   0040 cell_size
     5x          Equ   0001 cell_start
     4x          Equ   6000 cell_start_adr
     1x          Label 7243 CheckSpritesRefresh
     4x          Label 720B ClearObj
     1x          Label 7235 CLO_1
     1x          Label 7239 CLO_2
     0x          Label 7333 CSR_CheckDelHide
     3x          Label 74CE CSR_CheckDraw
     3x          Label 73FD CSR_CheckErase
     0x          Label 7356 CSR_CheckPlayFieldCoord
     0x          Label 7339 CSR_CheckRefresh
     1x          Label 73C5 CSR_CheckVerticalPosition
     1x          Label 739C CSR_DoNotDisplaySprite
     3x          Label 73BE CSR_NextObject
     1x          Label 72B4 CSR_P1B0
     1x          Label 7322 CSR_P1B1
     1x          Label 72A7 CSR_P2B0
     1x          Label 7315 CSR_P2B1
     1x          Label 729A CSR_P3B0
     1x          Label 7308 CSR_P3B1
     1x          Label 728D CSR_P4B0
     1x          Label 72FB CSR_P4B1
     1x          Label 7280 CSR_P5B0
     1x          Label 72EE CSR_P5B1
     1x          Label 7273 CSR_P6B0
     1x          Label 72E1 CSR_P6B1
     1x          Label 7266 CSR_P7B0
     1x          Label 72D4 CSR_P7B1
     0x          Label 7259 CSR_P8B0
     0x          Label 72C7 CSR_P8B1
    21x          Label 7330 CSR_ProcessEachPriorityLevel
     1x          Label 72C1 CSR_rtsB0
     1x          Label 732F CSR_rtsB1
     0x          Label 7254 CSR_SetBuffer0
     1x          Label 72C2 CSR_SetBuffer1
     3x          Label 7516 CSR_SetDrawFalse
     0x          Label 74F1 CSR_SetDrawTrue
     2x          Label 74C6 CSR_SetEraseFalse
     6x          Label 742C CSR_SetEraseTrue
     1x          Label 7509 CSR_SetHide
    10x          Label 73F5 CSR_SetOutOfRange
     0x          Label 7243 CSR_Start
     0x          Label 74A5 CSR_SubDrawCheckCollision
     4x          Label 749C CSR_SubDrawSearch
     2x          Label 7498 CSR_SubDrawSpriteSearchInit
     0x          Label 744F CSR_SubEraseCheckCollisionB0
     0x          Label 7478 CSR_SubEraseCheckCollisionB1
     4x          Label 7446 CSR_SubEraseSearchB0
     5x          Label 746F CSR_SubEraseSearchB1
     1x          Label 743D CSR_SubEraseSpriteSearchInit
     0x          Label 7342 CSR_UpdSpriteImageBasedOnMirror
    19x          Label 723D cur_priority
     4x          Label 7241 cur_ptr_sub_obj_draw
     9x          Label 723F cur_ptr_sub_obj_erase
     0x          Label 7149 DeleteObject
     0x          Label 7143 DeleteObject_x
     1x          Label 7005 DisplaySprite
     0x          Label 6FFF DisplaySprite_x
     0x          Equ   604F dk_destination
     0x          Equ   6049 dk_lecteur
     0x          Equ   604A dk_piste
     0x          Equ   604B dk_pisteL
     0x          Equ   604C dk_secteur
     1x          Label 71AD DOB_ChainNextB0
     1x          Label 71F7 DOB_ChainNextB1
     1x          Label 718D DOB_ChainPrevB0
     1x          Label 71CF DOB_ChainPrevB1
     1x          Label 7197 DOB_CheckPrioNextB0
     1x          Label 71D9 DOB_CheckPrioNextB1
     1x          Label 7177 DOB_RemoveFromDPSB0
     1x          Label 71B9 DOB_RemoveFromDPSB1
     2x          Label 71F5 DOB_rts
     1x          Label 714B DOB_Start
     2x          Label 7160 DOB_TestOnscreen1
     0x          Label 7150 DOB_ToDeleteFlag0
     0x          Label 7165 DOB_ToDeleteFlag1
     0x          Label 7156 DOB_Unset0
     0x          Label 716B DOB_Unset1
     3x          Label 6F99 Dpad_Held
     0x          Label 6F9B Dpad_Press
    27x          Label 64C1 DPS_buffer_0
    25x          Label 6567 DPS_buffer_1
     1x          Label 7767 DrawSprites
     2x          Equ   0004 draw_routine
     1x          Label 7851 DRS_DrawWithoutBackupB0
     1x          Label 7905 DRS_DrawWithoutBackupB1
     1x          Label 7883 DRS_dyn1
     1x          Label 7895 DRS_dyn2
     3x          Label 7832 DRS_dyn3B0
     3x          Label 78E6 DRS_dyn3B1
     3x          Label 7849 DRS_NextObjectB0
     3x          Label 78FD DRS_NextObjectB1
     1x          Label 77A4 DRS_P1B0
     1x          Label 77E5 DRS_P1B1
     1x          Label 779C DRS_P2B0
     1x          Label 77DD DRS_P2B1
     1x          Label 7794 DRS_P3B0
     1x          Label 77D5 DRS_P3B1
     1x          Label 778C DRS_P4B0
     1x          Label 77CD DRS_P4B1
     1x          Label 7784 DRS_P5B0
     1x          Label 77C5 DRS_P5B1
     1x          Label 777C DRS_P6B0
     1x          Label 77BD DRS_P6B1
     1x          Label 7774 DRS_P7B0
     1x          Label 77B5 DRS_P7B1
     0x          Label 776C DRS_P8B0
     1x          Label 77AD DRS_P8B1
     9x          Label 77EE DRS_ProcessEachPriorityLevelB0
     9x          Label 78A2 DRS_ProcessEachPriorityLevelB1
     1x          Label 77AC DRS_rtsB0
     1x          Label 77ED DRS_rtsB1
     0x          Label 7767 DRS_Start
     4x          Label 7875 DRS_XYToAddress
     0x          Label 787D DRS_XYToAddressRAMAFirst
     1x          Label 788F DRS_XYToAddressRAMBFirst
     0x          Label 7036 DSP_addFirstNode
     1x          Label 7046 DSP_addToExistingNode
     1x          Label 7022 DSP_BufferPositionned
     1x          Label 706B DSP_ChangePriority
     1x          Label 702F DSP_CheckLastEntry
     0x          Label 702C DSP_InitPriority
     1x          Label 705B DSP_LinkBuffer1
     1x          Label 7067 DSP_LinkCurWithPrev
     1x          Label 7044 DSP_rts
     0x          Label 7012 DSP_SetBuffer0
     1x          Label 701B DSP_SetBuffer1
     1x          Label 7007 DSP_Start
     0x          Label 67B1 Dynamic_Object_RAM
     2x          Label 6E6B Dynamic_Object_RAM_End
     3x          Equ   0007 entry_size
     1x          Label 7525 EraseSprites
     4x          Equ   0009 erase_nb_cell
     2x          Equ   0007 erase_routine
     0x          Label 7619 ESP_CallEraseRoutineB0
     1x          Label 762C ESP_CallEraseRoutineB0_00
     0x          Label 765F ESP_CallEraseRoutineB1
     1x          Label 7672 ESP_CallEraseRoutineB1_00
     1x          Label 7611 ESP_CheckEraseB0
     1x          Label 7657 ESP_CheckEraseB1
     8x          Label 75FF ESP_CheckPriorityB0
     8x          Label 7645 ESP_CheckPriorityB1
     0x          Label 7636 ESP_FreeEraseBufferB0
     0x          Label 767C ESP_FreeEraseBufferB1
     2x          Label 763C ESP_NextObjectB0
     2x          Label 7682 ESP_NextObjectB1
     0x          Label 752A ESP_P1B0
     1x          Label 7593 ESP_P1B1
     1x          Label 7537 ESP_P2B0
     1x          Label 75A0 ESP_P2B1
     1x          Label 7544 ESP_P3B0
     1x          Label 75AD ESP_P3B1
     1x          Label 7551 ESP_P4B0
     1x          Label 75BA ESP_P4B1
     1x          Label 755E ESP_P5B0
     1x          Label 75C7 ESP_P5B1
     1x          Label 756B ESP_P6B0
     1x          Label 75D4 ESP_P6B1
     1x          Label 7578 ESP_P7B0
     1x          Label 75E1 ESP_P7B1
     1x          Label 7585 ESP_P8B0
     1x          Label 75EE ESP_P8B1
     9x          Label 75FC ESP_ProcessEachPriorityLevelB0
     9x          Label 7642 ESP_ProcessEachPriorityLevelB1
     1x          Label 7592 ESP_rtsB0
     1x          Label 75FB ESP_rtsB1
     0x          Label 7525 ESP_Start
     0x          Label 7603 ESP_UnsetCheckRefreshB0
     0x          Label 7649 ESP_UnsetCheckRefreshB1
     1x          Label 7639 ESP_UnsetOnScreenFlagB0
     1x          Label 767F ESP_UnsetOnScreenFlagB1
     0x          Equ   001B ext_variables
     1x          Label 6F9A Fire_Held
     0x          Label 6F9C Fire_Press
     1x          Label 611B Glb_Camera_X_Pos
     1x          Label 611D Glb_Camera_Y_Pos
    10x          Label 611A Glb_Cur_Wrk_Screen_Id
     1x          Label 6F61 Glb_MainCharacter_Is_Dead
     6x          Label 611F Glb_Sprite_Screen_Pos_PartA
     6x          Label 6121 Glb_Sprite_Screen_Pos_PartB
     0x          Equ   00FE goBackNFrames
     0x          Equ   00FD goToAnimation
     0x          Equ   0038 gravity
     0x          Equ   0000 id
     1x          Equ   000E image_meta_size
     1x          Equ   000A image_x1_offset_l
     1x          Equ   000C image_x_size_l
     1x          Equ   000B image_y1_offset_l
     1x          Equ   000D image_y_size_l
     0x          Label 7B57 Img_emblemBack01
     0x          Label 7B49 Img_emblemBack02
     0x          Label 7AAF Img_emblemBack03
     0x          Label 7AA1 Img_emblemBack04
     0x          Label 7ACB Img_emblemBack05
     0x          Label 7ABD Img_emblemBack06
     0x          Label 7A85 Img_emblemBack07
     0x          Label 7A77 Img_emblemBack08
     0x          Label 7A93 Img_emblemBack09
     0x          Label 7BE3 Img_emblemFront01
     0x          Label 7BF1 Img_emblemFront02
     0x          Label 7BC7 Img_emblemFront03
     0x          Label 7BD5 Img_emblemFront04
     0x          Label 7BAB Img_emblemFront05
     0x          Label 7BB9 Img_emblemFront06
     0x          Label 7B8F Img_emblemFront07
     0x          Label 7B9D Img_emblemFront08
     0x          Label 7A31 Img_sonicHand
     1x          Label 7B2D Img_sonic_1
     1x          Label 7B3B Img_sonic_2
     1x          Label 7B73 Img_sonic_3
     1x          Label 7B81 Img_sonic_4
     0x          Label 7B65 Img_sonic_5
     3x Multiply Label 7A5B Img_star_1
     3x Multiply Label 7A3F Img_star_2
     1x          Label 7A23 Img_star_3
     0x          Label 7A15 Img_star_4
     0x          Label 7B1F Img_tailsHand
     1x          Label 7B11 Img_tails_1
     1x          Label 7B03 Img_tails_2
     1x          Label 7AF5 Img_tails_3
     1x          Label 7AE7 Img_tails_4
     1x          Label 7AD9 Img_tails_5
     0x          Label 6F99 Joypads
     1x          Label 6F99 Joypads_Held
     1x          Label 6F9B Joypads_Press
     1x          Label 6103 LevelMainLoop
     1x          Label 6E6B LevelOnly_Object_RAM
     1x          Label 6F61 LevelOnly_Object_RAM_End
     1x          Label 7C27 LoadAct
     4x          Label 6123 Lst_FreeCellFirstEntry_0
     4x          Label 62F2 Lst_FreeCellFirstEntry_1
     2x          Label 6125 Lst_FreeCell_0
     2x          Label 62F4 Lst_FreeCell_1
     8x          Label 64E5 Lst_Priority_Unset_0
     7x          Label 658B Lst_Priority_Unset_1
     2x          Equ   000A mapping_frame
     0x          Label 6FFD MarkObjGone
    14x          Equ   0000 nb_cells
     1x          Equ   0015 nb_dynamic_objects
     6x          Equ   0082 nb_free_cells
     0x          Equ   0003 nb_level_objects
     4x          Equ   0040 nb_objects
     4x          Equ   0008 nb_priority_levels
     0x          Equ   0002 nb_reserved_objects
     0x          Equ   00FC nextRoutine
     0x          Equ   00FA nextSubRoutine
     9x          Equ   0005 next_entry
     3x          Equ   0052 next_object
     0x          Label 7101 ObjectMove
     1x          Label 670D Object_RAM
     2x          Label 6F61 Object_RAM_End
     8x          Equ   0052 object_size
     1x          Label 7C27 Obj_Index_Address
     1x          Label 7C27 Obj_Index_Page
     0x          Label 670D Obj_MainCharacter
     0x          Label 675F Obj_Sidekick
     0x          Label 6EBD Obj_SonicDust
     0x          Label 6F0F Obj_TailsDust
     0x          Label 6E6B Obj_TailsTails
     2x          Equ   0000 page_bckdraw_routine
     2x          Equ   0003 page_draw_routine
     2x          Equ   0006 page_erase_routine
     2x          Equ   0006 prev_anim
     6x          Equ   0003 priority
     1x          Label 6F9D ReadJoypads
     6x          Equ   0010 render_fixedoverlay_mask
    20x          Equ   0002 render_flags
     0x          Equ   0040 render_free2_mask
     0x          Equ   0080 render_free3_mask
     4x          Equ   0008 render_hide_mask
     1x          Equ   0004 render_playfieldcoord_mask
     5x          Equ   0020 render_todelete_mask
     2x          Equ   0001 render_xmirror_mask
     2x          Equ   0002 render_ymirror_mask
     1x          Label 670D Reserved_Object_RAM
     1x          Label 67B1 Reserved_Object_RAM_End
     0x          Equ   00FF resetAnim
     0x          Equ   00FB resetAnimAndSubRoutine
     2x          Equ   0018 routine
     3x          Equ   0019 routine_secondary
     3x          Equ   0039 rsv_bgdata_0
     3x          Equ   0049 rsv_bgdata_1
     2x          Equ   0032 rsv_buffer_0
     2x          Equ   0042 rsv_buffer_1
    11x          Equ   002C rsv_curr_mapping_frame
     8x          Equ   0041 rsv_onscreen_0
     6x          Equ   0051 rsv_onscreen_1
     0x          Equ   002A rsv_prev_anim
     4x          Equ   0037 rsv_prev_mapping_frame_0
     4x          Equ   0047 rsv_prev_mapping_frame_1
     0x          Equ   003D rsv_prev_x1_pixel_0
     0x          Equ   004D rsv_prev_x1_pixel_1
     0x          Equ   003F rsv_prev_x2_pixel_0
     0x          Equ   004F rsv_prev_x2_pixel_1
     2x          Equ   003D rsv_prev_xy1_pixel_0
     2x          Equ   004D rsv_prev_xy1_pixel_1
     2x          Equ   003F rsv_prev_xy2_pixel_0
     2x          Equ   004F rsv_prev_xy2_pixel_1
     2x          Equ   003B rsv_prev_xy_pixel_0
     2x          Equ   004B rsv_prev_xy_pixel_1
     0x          Equ   003B rsv_prev_x_pixel_0
     0x          Equ   004B rsv_prev_x_pixel_1
     0x          Equ   003E rsv_prev_y1_pixel_0
     0x          Equ   004E rsv_prev_y1_pixel_1
     0x          Equ   0040 rsv_prev_y2_pixel_0
     0x          Equ   0050 rsv_prev_y2_pixel_1
     0x          Equ   003C rsv_prev_y_pixel_0
     0x          Equ   004C rsv_prev_y_pixel_1
     6x          Equ   0032 rsv_priority_0
     6x          Equ   0042 rsv_priority_1
    14x          Equ   0035 rsv_priority_next_obj_0
    14x          Equ   0045 rsv_priority_next_obj_1
    12x          Equ   0033 rsv_priority_prev_obj_0
    12x          Equ   0043 rsv_priority_prev_obj_1
     4x          Equ   0001 rsv_render_checkrefresh_mask
     5x          Equ   0004 rsv_render_displaysprite_mask
     7x          Equ   0002 rsv_render_erasesprite_mask
    28x          Equ   0029 rsv_render_flags
     4x          Equ   0008 rsv_render_outofrange_mask
     4x          Equ   002E rsv_x1_pixel
     5x          Equ   0030 rsv_x2_pixel
     3x          Equ   002E rsv_xy1_pixel
     3x          Equ   0030 rsv_xy2_pixel
     4x          Equ   002F rsv_y1_pixel
     5x          Equ   0031 rsv_y2_pixel
     1x          Label 6FD6 RunNextObject
     3x          Label 6FBD RunObject
     1x          Label 6FB5 RunObjects
     1x          Label 6FE0 RunObjectsWhenPlayerIsDead
     0x          Label 6FB8 RunObjects_01
     0x          Label 6FDF RunObjects_End
     0x          Label 6F7A screen_border_color
     2x          Equ   00E4 screen_bottom
     1x          Equ   001C screen_top
     1x          Equ   00A0 screen_width
     0x          Label 712C SingleObjLoad2
     1x          Label 7136 SingleObjLoad2_01
     2x          Label 7142 SingleObjLoad2_02
     1x          Equ   001A status
     0x          Equ   0004 status_bit2
     0x          Equ   0080 status_bit7
     0x          Equ   0002 status_inair
     0x          Equ   0010 status_jumpingafterrolling
     0x          Equ   0004 status_jumporroll
     0x          Equ   0020 status_mainchar_pushing
     0x          Equ   0008 status_mainchar_standing
     0x          Equ   0008 status_norgroundnorfall
     0x          Equ   0020 status_pushing
     0x          Equ   0040 status_sidekick_pushing
     0x          Equ   0010 status_sidekick_standing
     0x          Equ   0040 status_underwater
     1x          Equ   0001 status_x_orientation
     1x          Equ   0002 status_y_orientation
     0x          Equ   0001 subtype
     0x          Label 6F75 SwapVideoPage
     2x          Label 64C1 Tbl_Priority_First_Entry_0
     2x          Label 6567 Tbl_Priority_First_Entry_1
     3x          Label 64D3 Tbl_Priority_Last_Entry_0
     2x          Label 6579 Tbl_Priority_Last_Entry_1
     2x          Label 668D Tbl_Sub_Object_Draw
     3x          Label 660D Tbl_Sub_Object_Erase
     0x          Label 768D UDP_B0
     1x          Label 76FA UDP_B1
     1x          Label 76D4 UDP_ChainNextB0
     1x          Label 7741 UDP_ChainNextB1
     1x          Label 76B4 UDP_ChainPrevB0
     1x          Label 7721 UDP_ChainPrevB1
     1x          Label 76DE UDP_CheckDeleteB0
     1x          Label 774B UDP_CheckDeleteB1
     2x          Label 7690 UDP_CheckEndB0
     2x          Label 76FD UDP_CheckEndB1
     1x          Label 76BE UDP_CheckPrioNextB0
     1x          Label 772B UDP_CheckPrioNextB1
     1x          Label 769C UDP_CheckPrioPrevB0
     1x          Label 7709 UDP_CheckPrioPrevB1
     0x          Label 7695 UDP_InitListB0
     0x          Label 7702 UDP_InitListB1
     3x          Label 76F3 UDP_SetNewPrioB0
     3x          Label 7760 UDP_SetNewPrioB1
     0x          Label 7688 UDP_Start
     1x          Label 7688 UnsetDisplayPriority
     2x          Label 6F97 Vint_runcount
     2x          Label 6F62 WaitVBL
     1x          Label 6F67 WaitVBL_01
     5x          Equ   0012 xy_pixel
     2x          Equ   0012 x_pixel
     5x          Equ   000C x_pos
     0x          Equ   000E x_sub
     2x          Equ   0014 x_vel
     2x          Equ   0013 y_pixel
     5x          Equ   000F y_pos
     0x          Equ   0011 y_sub
     2x          Equ   0016 y_vel
     0x          Equ   00FE _goBackNFrames
     0x          Equ   00FD _goToAnimation
     0x          Equ   00FC _nextRoutine
     0x          Equ   00FA _nextSubRoutine
     0x          Equ   00FF _resetAnim
     0x          Equ   00FB _resetAnimAndSubRoutine

