/*--------------------------------------------------------------*
 * Compilé avec C6809 v0.83                                     *
 *--------------------------------------------------------------*
 * Fichier source      : ./input/CODE/MAIN.ASS
 * Fichier destination : TMP.BIN
 * Contenu :
 *     Main     0:MAIN.ASM     16013
 *--------------------------------------------------------------*/

Macro Pass
Pass1
Pass2
     12        6300                      ORG $6300
     13
     14                           *****************************************>>
     15                           * Constantes et variables
     16                           *****************************************>>
     17
     18                  6205     DK_lecture               EQU $6205 * rout>>
     19                  620A     DK_piste                 EQU $620A * 2B n>>
     20                  620F     DK_secteur               EQU $620F * 1B n>>
     21                  6213     DK_destination           EQU $6213 * 2B d>>
     22                  622C     DK_dernier_bloc_a_ecrire EQU $622C * 2B f>>
     23
     24                  0014     DEBUTECRANA EQU $0014 * test pour fin sta>>
     25                  1F40     FINECRANA   EQU $1F40 * fin de la RAM A v>>
     26                  2014     DEBUTECRANB EQU $2014 * test pour fin sta>>
     27                  3F40     FINECRANB   EQU $3F40 * fin de la RAM B v>>
     28
     29                  0005     JOY_BD EQU $05 * Bas Droite
     30                  0006     JOY_HD EQU $06 * Haut Droite
     31                  0007     JOY_D  EQU $07 * Droite
     32                  0009     JOY_BG EQU $09 * Bas Gauche
     33                  000A     JOY_HG EQU $0A * Haut Gauche
     34                  000B     JOY_G  EQU $0B * Gauche
     35                  000D     JOY_B  EQU $0D * Bas
     36                  000E     JOY_H  EQU $0E * Haut
     37                  000F     JOY_C  EQU $0F * Centre
     38
     39                  9F00     SSAVE    EQU $9F00 * BUFFER for S when us>>
     40                  9F02     HERO_POS EQU $9F02
     41
     42                           *****************************************>>
     43                           * Debut du programme
     44                           *****************************************>>
     45        6300               BEGIN
     46  2     6300 1A   50              ORCC #$50     * a documenter (inte>>
     47                            
     48  3     6302 CC   0000            LDD #$0000     * Init variables gl>>
     49  6     6305 FD   9F00            STD SSAVE
     50  3     6308 CC   1F40            LDD #FINECRANA
     51  6     630B FD   9F02            STD HERO_POS
     52  3     630E CC   3F40            LDD #FINECRANB
     53  6     6311 FD   9F04            STD HERO_POS+2
     54
     55                           *****************************************>>
     56                           * Chargement des pages memoire
     57                           *****************************************>>
     58                                  * Chargement de la page 4 depuis l>>
     59                                  **********************************>>
     60  2     6314 C6   04              LDB #$04                       * O>>
     61  5     6316 F7   E7E5            STB $E7E5                      * e>>
     62                            
     63  3     6319 CC   0004            LDD #$0004
     64  6     631C FD   620A            STD DK_piste
     65  2     631F 86   01              LDA #$01
     66  5     6321 B7   620F            STA DK_secteur
     67  3     6324 CC   A000            LDD #$A000
     68  6     6327 FD   6213            STD DK_destination
     69  3     632A CC   DF00            LDD #$DF00
     70  6     632D FD   622C            STD DK_dernier_bloc_a_ecrire
     71  8     6330 BD   6205            JSR DK_lecture
     72                            
     73                                  * Copie de la page 4 en page 5
     74                                  ******************************
     75  2     6333 C6   65              LDB #$65                       * O>>
     76  5     6335 F7   E7E6            STB $E7E6                      * e>>
     77
     78  4     6338 108E 4010         LDY #$4010                     * Nb B>>
     79  7     633C 10BF 6425            STY MEM_COPY_DATA_TO_CART_02+2
     80  3     6340 CE   A000         LDU #$A000                     * Sour>>
     81  4     6343 108E 0010         LDY #$0000+16                  * Dest>>
     82  8     6347 BD   63EC         JSR MEM_COPY_DATA_TO_CART      * Copi>>
     83                            
     84                                  * Initialisation de la page 0
     85                                  *****************************
     86  2     634A C6   60              LDB #$60                       * O>>
     87  5     634C F7   E7E6            STB $E7E6                      * e>>
     88  8     634F BD   642E            JSR CLR_CART
     89                            
     90                           *****************************************>>
     91                           * Initialisation de la routine de commuta>>
     92                           *****************************************>>
     93        6352               INIT_VID
     94  5     6352 F6   6081            LDB $6081 * A documenter
     95  2     6355 CA   10              ORB #$10  * mettre le bit d4 a 1
     96  5     6357 F7   6081            STB $6081
     97  5     635A F7   E7E7            STB $E7E7
     98  8     635D BD   63BC            JSR SCRC * page 2 en RAM Cartouche>>
     99
    100                           *****************************************>>
    101                           * Initialisation de la palette de couleur>>
    102                           *****************************************>>
    103  4     6360 108E 6668            LDY #TABPALETTE
    104  2     6364 4F                   CLRA
    105        6365               SETPALETTE
    106  5+1   6365 34   02              PSHS A
    107  2     6367 48                   ASLA
    108  5     6368 B7   E7DB            STA $E7DB
    109  5+3   636B EC   A1              LDD ,Y++
    110  5     636D F7   E7DA            STB $E7DA
    111  5     6370 B7   E7DA            STA $E7DA
    112  5+1   6373 35   02              PULS A
    113  2     6375 4C                   INCA
    114  5     6376 108C 6688            CMPY #FINTABPALETTE
    115  3     637A 26   E9              BNE    SETPALETTE
    116
    117                           *****************************************>>
    118                           * Initialisation du mode video
    119                           *****************************************>>
    120  2     637C 86   7B              LDA #$7B      * passage en mode 16>>
    121  5     637E B7   E7DC            STA $E7DC
    122
    123                           *****************************************>>
    124                           * Initialisation des deux pages videos av>>
    125                           *****************************************>>
    126  3     6381 8E   66EE            LDX #HERO_IDLE_R
    127  8     6384 BD   6688            JSR HERO_ANIMATION_LOAD
    128
    129  8     6387 BD   642E            JSR CLR_CART
    130  5     638A F6   6712            LDB HERO_ANIMATION_PAG            >>
    131  5     638D F7   E7E5            STB $E7E5                         >>
    132  7+3   6390 AD   9F 6715         JSR [HERO_ANIMATION_DRW]
    133  8     6394 BD   63BC            JSR SCRC                          >>
    134
    135  8     6397 BD   642E            JSR CLR_CART
    136  7+3   639A AD   9F 6715         JSR [HERO_ANIMATION_DRW]
    137  8     639E BD   63BC            JSR SCRC                          >>
    138
    139                           *****************************************>>
    140                           * Boucle principale
    141                           *****************************************>>
    142        63A1               MAIN
    143                                  * Effacement et affichage des spri>>
    144  5     63A1 F6   6712            LDB HERO_ANIMATION_PAG            >>
    145  5     63A4 F7   E7E5            STB $E7E5                         >>
    146                                  *JSR [HERO_ANIMATION_DEL]         >>
    147  7+3   63A7 AD   9F 6715         JSR [HERO_ANIMATION_DRW]          >>
    148
    149                                  * Gestion des deplacements
    150  8     63AB BD   646A            JSR JOY_READ
    151  8     63AE BD   6484            JSR Hero_Move
    152  8     63B1 BD   65C0            JSR Compute_Position
    153                            
    154  8     63B4 BD   66DE            JSR HERO_ANIMATION_NEXT
    155
    156  8     63B7 BD   63BC            JSR SCRC                          >>
    157  3     63BA 20   E5              BRA MAIN
    158
    159                           *****************************************>>
    160                           * Changement de page ESPACE ECRAN (affich>>
    161                           *      $E7DD determine la page affichee d>>
    162                           *      D7=0 D6=0 D5=0 D4=0 (#$0_) : page >>
    163                           *      D7=0 D6=1 D5=0 D4=0 (#$4_) : page >>
    164                           *      D7=1 D6=0 D5=0 D4=0 (#$8_) : page >>
    165                           *      D7=1 D6=1 D5=0 D4=0 (#$C_) : page >>
    166                           *   D3 D2 D1 D0  (#$_0 a #$_F) : couleur >>
    167                           *   Remarque : D5 et D4 utilisable unique>>
    168                           *
    169                           * Changement de page ESPACE CARTOUCHE (ec>>
    170                           *      $E7E6 determine la page affichee d>>
    171                           *   D5 : 1 = espace cartouche recouvert p>>
    172                           *   D4 : 0 = CAS1N valide : banques 0-15 >>
    173                           *      D5=1 D4=0 D3=0 D2=0 D1=0 D0=0 (#$6>>
    174                           *   ...
    175                           *      D5=1 D4=0 D3=1 D2=1 D1=1 D0=1 (#$6>>
    176                           *      D5=1 D4=1 D3=0 D2=0 D1=0 D0=0 (#$7>>
    177                           *   ...
    178                           *      D5=1 D4=1 D3=1 D2=1 D1=1 D0=1 (#$7>>
    179                           *****************************************>>
    180        63BC               SCRC
    181  8     63BC BD   63E1            JSR VSYNC
    182
    183  5     63BF F6   63D8            LDB SCRC0+1
    184  2     63C2 C4   01              ANDB #$01
    185  5     63C4 FB   6712            ADDB HERO_ANIMATION_PAG
    186  5     63C7 F7   6712            STB HERO_ANIMATION_PAG
    187                            
    188  5     63CA F6   63D8            LDB SCRC0+1   * charge la valeur d>>
    189  2     63CD C4   80              ANDB #$80     * permute #$00 ou #$>>
    190  2     63CF CA   00              ORB #$00      * recharger la coule>>
    191  5     63D1 F7   E7DD            STB $E7DD     * changement page da>>
    192  7     63D4 73   63D8            COM SCRC0+1   * modification du co>>
    193        63D7               SCRC0
    194  2     63D7 C6   00              LDB #$00
    195  2     63D9 C4   02              ANDB #$02     * permute #$60 ou #$>>
    196  2     63DB CA   60              ORB #$60      * espace cartouche r>>
    197  5     63DD F7   E7E6            STB $E7E6     * changement page da>>
    198  5     63E0 39                   RTS                  * E7E6 D5=1 p>>
    199                                                       * CAS1N : ban>>
    200
    201                           *****************************************>>
    202                           * Attente VBL
    203                           *****************************************>>
    204        63E1               VSYNC
    205        63E1               VSYNC_1
    206  7     63E1 7D   E7E7            TST    $E7E7
    207  3     63E4 2A   FB              BPL    VSYNC_1
    208        63E6               VSYNC_2
    209  7     63E6 7D   E7E7            TST    $E7E7
    210  3     63E9 2B   FB              BMI    VSYNC_2
    211  5     63EB 39                   RTS
    212
    213                           *****************************************>>
    214                           * Copie Memoire de la zone donnee vers ca>>
    215                           *****************************************>>
    216        63EC               MEM_COPY_DATA_TO_CART
    217  7     63EC 10FF 642B        STS     MEM_COPY_DATA_TO_CART_03+2    >>
    218        63F0               MEM_COPY_DATA_TO_CART_01
    219  5+6   63F0 37   56          PULU    D,X,S
    220  5+1   63F2 ED   30          STD     -16,Y
    221  5+1   63F4 AF   32          STX     -14,Y
    222  6+1   63F6 10EF 34          STS     -12,Y
    223  5+6   63F9 37   56          PULU    D,X,S
    224  5+1   63FB ED   36          STD     -10,Y
    225  5+1   63FD AF   38          STX     -8,Y
    226  6+1   63FF 10EF 3A          STS     -6,Y
    227  5+6   6402 37   56          PULU    D,X,S
    228  5+1   6404 ED   3C          STD     -4,Y
    229  5+1   6406 AF   3E          STX     -2,Y
    230  6+0   6408 10EF A4          STS     ,Y
    231  5+6   640B 37   56          PULU    D,X,S
    232  5+1   640D ED   22          STD     2,Y
    233  5+1   640F AF   24          STX     4,Y
    234  6+1   6411 10EF 26          STS     6,Y
    235  5+4   6414 37   16          PULU    D,X
    236  5+1   6416 ED   28          STD     8,Y
    237  5+1   6418 AF   2A          STX     10,Y
    238  5+4   641A 37   16          PULU    D,X
    239  5+1   641C ED   2C          STD     12,Y
    240  5+1   641E AF   2E          STX     14,Y
    241  4+1   6420 31   A8 20       LEAY    32,Y
    242        6423               MEM_COPY_DATA_TO_CART_02
    243  5     6423 108C 0030        CMPY    #$0030
    244  3     6427 26   C7          BNE     MEM_COPY_DATA_TO_CART_01
    245        6429               MEM_COPY_DATA_TO_CART_03
    246  4     6429 10CE 0000        LDS     #$0000    * Rechargement du po>>
    247  5     642D 39               RTS
    248
    249                           *****************************************>>
    250                           * Effacement memoire Cartouche
    251                           *****************************************>>
    252        642E               CLR_CART
    253  5+3   642E 34   48              PSHS U,DP
    254  7     6430 10FF 6465            STS CLR_CART_3+2
    255  4     6434 10CE 4000            LDS #$4000
    256  3     6438 CE   0000            LDU #$0000
    257  4     643B 108E 0000            LDY #$0000
    258  3     643F 8E   0000            LDX #$0000
    259  3     6442 CC   0000            LDD #$0000
    260  6     6445 1F   8B              TFR A,DP
    261        6447               CLR_CART_2
    262  5+9   6447 34   7E           PSHS U,Y,X,DP,B,A
    263  5+9   6449 34   7E           PSHS U,Y,X,DP,B,A
    264  5+9   644B 34   7E           PSHS U,Y,X,DP,B,A
    265  5+9   644D 34   7E           PSHS U,Y,X,DP,B,A
    266  5+9   644F 34   7E           PSHS U,Y,X,DP,B,A
    267  5+9   6451 34   7E           PSHS U,Y,X,DP,B,A
    268  5+9   6453 34   7E           PSHS U,Y,X,DP,B,A
    269  5+9   6455 34   7E           PSHS U,Y,X,DP,B,A
    270  5+9   6457 34   7E           PSHS U,Y,X,DP,B,A
    271  5+9   6459 34   7E           PSHS U,Y,X,DP,B,A
    272  5     645B 118C 0004            CMPS #$0004
    273  3     645F 26   E6              BNE CLR_CART_2
    274  5+4   6461 34   60           PSHS U,Y
    275        6463               CLR_CART_3
    276  4     6463 10CE 0000         LDS #$0000
    277  5+3   6467 35   48           PULS DP,U
    278  5     6469 39                   RTS
    279
    280                           *****************************************>>
    281                           * Get joystick parameters
    282                           *****************************************>>
    283        646A               JOY_READ
    284  3     646A 8E   E7CF            ldx    #$e7cf
    285  4     646D 108E E7CD            ldy    #$e7cd
    286  3     6471 CC   400F            ldd    #$400f
    287  5     6474 F4   E7CC            andb   >$e7cc     * Read position
    288  5     6477 F7   6482            stb    JOY_DIR_STATUS
    289  4+0   647A A4   A4              anda   ,y         * Read button
    290  2     647C 88   40              eora   #$40
    291  5     647E B7   6483            sta    JOY_BTN_STATUS
    292  5     6481 39                   RTS
    293        6482               JOY_DIR_STATUS
    294        6482 00                   FCB $00 * Position Pad
    295        6483               JOY_BTN_STATUS
    296        6483 00                   FCB $00 * 40 Bouton A enfonce
    297
    298                           *****************************************>>
    299                           * Subroutine to      make HERO walk/run
    300                           *****************************************>>
    301        6484               Hero_Move
    302  5     6484 B6   6482            LDA JOY_DIR_STATUS
    303  2     6487 81   0B              CMPA #JOY_G
    304  3     6489 26   02              BNE Hero_NotLeft
    305  3     648B 20   69              BRA Hero_MoveLeft
    306
    307        648D               Hero_NotLeft                   * XREF: He>>
    308  2     648D 81   07              CMPA #JOY_D
    309  3     648F 26   03              BNE Hero_NotLeftOrRight
    310  5     6491 16   00A6            LBRA Hero_MoveRight
    311
    312        6494               Hero_NotLeftOrRight            * XREF: He>>
    313  6     6494 FC   66FA            LDD HERO_G_SPEED
    314  5     6497 1083 0000            CMPD #$0000
    315  3     649B 2D   2E              BLT Hero_NotLeftOrRight_00 * se de>>
    316  7     649D B3   670C            SUBD HERO_FRICTION     * se deplac>>
    317  3     64A0 24   12              BCC Hero_NotLeftOrRight_01 * si on>>
    318  3     64A2 CC   0000            LDD #$0000
    319  6     64A5 FD   66FA            STD HERO_G_SPEED
    320  6     64A8 FD   66FE            STD HERO_X_SPS
    321  3     64AB 8E   66EE            LDX #HERO_IDLE_R        * Charge a>>
    322  6     64AE BF   670E            STX HERO_ANIMATION_ADR      * Sauv>>
    323  5     64B1 16   00C4            LBRA Hero_MoveUpdatePos
    324        64B4               Hero_NotLeftOrRight_01
    325  5     64B4 1083 0600            CMPD #HERO_JOG_SPD_LIMIT
    326  3     64B8 2C   0B              BGE Hero_NotLeftOrRight_02
    327  6     64BA FD   66FA            STD HERO_G_SPEED
    328  3     64BD 8E   66EE            LDX #HERO_WALK_R        * Charge a>>
    329  6     64C0 BF   670E            STX HERO_ANIMATION_ADR      * Sauv>>
    330  3     64C3 20   03              BRA Hero_NotLeftOrRight_03
    331        64C5               Hero_NotLeftOrRight_02
    332  6     64C5 FD   66FA            STD HERO_G_SPEED
    333        64C8               Hero_NotLeftOrRight_03
    334  5     64C8 16   00AD            LBRA Hero_MoveUpdatePos
    335        64CB               Hero_NotLeftOrRight_00
    336  7     64CB F3   670C            ADDD HERO_FRICTION     * se deplac>>
    337  3     64CE 24   0F              BCC Hero_NotLeftOrRight_11 * si on>>
    338  3     64D0 CC   0000            LDD #$0000
    339  6     64D3 FD   66FA            STD HERO_G_SPEED
    340  3     64D6 8E   66EE            LDX #HERO_IDLE_L        * Charge a>>
    341  6     64D9 BF   670E            STX HERO_ANIMATION_ADR      * Sauv>>
    342  5     64DC 16   0099            LBRA Hero_MoveUpdatePos
    343        64DF               Hero_NotLeftOrRight_11
    344  5     64DF 1083 0600            CMPD #HERO_JOG_SPD_LIMIT
    345  3     64E3 2F   0B              BLE Hero_NotLeftOrRight_12
    346  6     64E5 FD   66FA            STD HERO_G_SPEED
    347  3     64E8 8E   66EE            LDX #HERO_WALK_L        * Charge a>>
    348  6     64EB BF   670E            STX HERO_ANIMATION_ADR      * Sauv>>
    349  3     64EE 20   03              BRA Hero_NotLeftOrRight_13
    350        64F0               Hero_NotLeftOrRight_12
    351  6     64F0 FD   66FA            STD HERO_G_SPEED
    352        64F3               Hero_NotLeftOrRight_13
    353  5     64F3 16   0082            LBRA Hero_MoveUpdatePos
    354
    355        64F6               Hero_MoveLeft                      * XREF>>
    356  6     64F6 FC   66FA            LDD HERO_G_SPEED            * Char>>
    357  5     64F9 1083 0000            CMPD #$0000                 * Test>>
    358  3     64FD 2F   11              BLE Hero_MoveLeft_00        * BRAN>>
    359  7     64FF B3   670A            SUBD HERO_DECELERATION      * orie>>
    360  3     6502 24   06              BCC Hero_MoveLeft_03        * BRAN>>
    361  3     6504 CC   0000            LDD #$0000
    362  7     6507 B3   670A            SUBD HERO_DECELERATION      * si l>>
    363        650A               Hero_MoveLeft_03
    364  6     650A FD   66FA            STD HERO_G_SPEED            * On s>>
    365  5     650D 16   0068            LBRA Hero_MoveUpdatePos           >>
    366        6510               Hero_MoveLeft_00                         >>
    367                           *      CMPD #$0000                       >>
    368                           *      BNE Hero_MoveLeft_02        * BRAN>>
    369                           *      LDD #$FEFF                        >>
    370                           *Hero_MoveLeft_02
    371  8     6510 10B3 6706            CMPD HERO_NEG_TOP_SPEED     * Comp>>
    372  3     6514 27   62              BEQ Hero_MoveUpdatePos      * vite>>
    373  7     6516 B3   6708            SUBD HERO_ACCELERATION      * acce>>
    374  8     6519 10B3 6706            CMPD HERO_NEG_TOP_SPEED     * Comp>>
    375  3     651D 2E   0F              BGT Hero_MoveLeft_01        * BRAN>>
    376  3     651F 8E   66EE            LDX #HERO_RUN_L        * Charge an>>
    377  6     6522 BF   670E            STX HERO_ANIMATION_ADR      * Sauv>>
    378  6     6525 FC   6706            LDD HERO_NEG_TOP_SPEED      * Limi>>
    379  6     6528 FD   66FA            STD HERO_G_SPEED            * Enre>>
    380  5     652B 16   004A            LBRA Hero_MoveUpdatePos     * Mise>>
    381        652E               Hero_MoveLeft_01
    382  6     652E FD   66FA            STD HERO_G_SPEED            * Enre>>
    383  3     6531 8E   66EE            LDX #HERO_WALK_L        * Charge a>>
    384  6     6534 BF   670E            STX HERO_ANIMATION_ADR      * Sauv>>
    385  5     6537 16   003E            LBRA Hero_MoveUpdatePos
    386
    387        653A               Hero_MoveRight                  * XREF: H>>
    388  6     653A FC   66FA            LDD HERO_G_SPEED        * Chargeme>>
    389  5     653D 1083 0000            CMPD #$0000                 * Test>>
    390  3     6541 2C   0E              BGE Hero_MoveRight_00       * BRAN>>
    391  7     6543 F3   670A            ADDD HERO_DECELERATION      * orie>>
    392  3     6546 24   03              BCC Hero_MoveRight_03       * BRAN>>
    393  6     6548 FC   670A            LDD HERO_DECELERATION   * si la vi>>
    394        654B               Hero_MoveRight_03
    395  6     654B FD   66FA            STD HERO_G_SPEED        * On stock>>
    396  5     654E 16   0027            LBRA Hero_MoveUpdatePos           >>
    397        6551               Hero_MoveRight_00                  * Orie>>
    398                           *      CMPD #$0000                       >>
    399                           *      BNE Hero_MoveRight_02       * BRAN>>
    400                           *      LDD #$0100                        >>
    401                           *Hero_MoveRight_02
    402  8     6551 10B3 6704            CMPD HERO_TOP_SPEED         * Comp>>
    403  3     6555 27   21              BEQ Hero_MoveUpdatePos      * vite>>
    404  7     6557 F3   6708            ADDD HERO_ACCELERATION      * acce>>
    405  8     655A 10B3 6704            CMPD HERO_TOP_SPEED         * Comp>>
    406  3     655E 2D   0F              BLT Hero_MoveRight_01       * BRAN>>
    407  3     6560 8E   66EE            LDX #HERO_RUN_R                   >>
    408  6     6563 BF   670E            STX HERO_ANIMATION_ADR      * Sauv>>
    409  6     6566 FC   6704            LDD HERO_TOP_SPEED          * Limi>>
    410  6     6569 FD   66FA            STD HERO_G_SPEED            * Enre>>
    411  5     656C 16   0009            LBRA Hero_MoveUpdatePos           >>
    412        656F               Hero_MoveRight_01
    413  6     656F FD   66FA            STD HERO_G_SPEED            * Enre>>
    414  3     6572 8E   66EE            LDX #HERO_WALK_R        * Charge a>>
    415  6     6575 BF   670E            STX HERO_ANIMATION_ADR      * Sauv>>
    416
    417        6578               Hero_MoveUpdatePos
    418  6     6578 FC   66FA            LDD HERO_G_SPEED            * Char>>
    419  6     657B FD   66FC            STD HERO_X_SPEED        * Stockage>>
    420  5     657E 1083 0000            CMPD #$0000                 * Test>>
    421  3     6582 2D   0E              BLT Hero_MoveUpdatePos_00   * BRAN>>
    422  7     6584 F3   66FE            ADDD HERO_X_SPS         * Ajout du>>
    423  5     6587 F7   66FF            STB HERO_X_SPS+1            * sauv>>
    424  6     658A 1F   89              TFR A,B                     * Divi>>
    425  5     658C FB   66F8            ADDB HERO_X_POS                   >>
    426  3     658F 20   18              BRA Hero_MoveUpdatePos_01
    427        6591               Hero_MoveUpdatePos_V00
    428        6591 00                   FCB $00
    429        6592               Hero_MoveUpdatePos_00
    430  3     6592 CC   0000            LDD #$0000
    431  7     6595 B3   66FC            SUBD HERO_X_SPEED           * La v>>
    432  7     6598 F3   66FE            ADDD HERO_X_SPS         * Ajout du>>
    433  5     659B F7   66FF            STB HERO_X_SPS+1            * sauv>>
    434  6     659E 1F   89              TFR A,B                     * Divi>>
    435  5     65A0 F7   6591            STB Hero_MoveUpdatePos_V00
    436  5     65A3 F6   66F8            LDB HERO_X_POS
    437  5     65A6 F0   6591            SUBB Hero_MoveUpdatePos_V00 * Ajou>>
    438        65A9               Hero_MoveUpdatePos_01
    439                           *      CMPB #$50                         >>
    440                           *      BLE Hero_MoveUpdatePos_02   * Bute>>
    441                           *      LDB #$50                          >>
    442                           *Hero_MoveUpdatePos_02
    443                           *    CMPB #$0C                           >>
    444                           *      BGE Hero_MoveUpdatePos_03   * Bute>>
    445                           *      LDB #$0C                          >>
    446        65A9               Hero_MoveUpdatePos_03
    447  5     65A9 F7   66F8            STB HERO_X_POS
    448  2     65AC C6   00              LDB #$00
    449  5     65AE F7   66FE            STB HERO_X_SPS                    >>
    450  3     65B1 CC   0000            LDD #$0000                  * TODO>>
    451  6     65B4 FD   6700            STD HERO_Y_SPEED
    452  6     65B7 1F   89              TFR A,B                     * divi>>
    453  5     65B9 FB   66F9            ADDB HERO_Y_POS
    454  5     65BC F7   66F9            STB HERO_Y_POS
    455  5     65BF 39                   RTS
    456
    457                           * TODO : Braking Animation
    458                           * Sonic enters his braking animation when>>
    459                           * In Sonic 1 and Sonic CD, he then stays >>
    460                           * In the other 3 games, Sonic returns to >>
    461
    462        65C0               Compute_Position
    463  5     65C0 B6   66F8            LDA HERO_X_POS
    464  2     65C3 44                   LSRA
    465  3     65C4 25   17              BCS Compute_Position_01
    466  5     65C6 B7   65F8            STA Compute_Position_02+1
    467  2     65C9 86   28              LDA #$28
    468  5     65CB F6   66F9            LDB HERO_Y_POS
    469  2     65CE 5A                   DECB
    470  11    65CF 3D                   MUL
    471  7     65D0 F3   65F7            ADDD Compute_Position_02
    472  6     65D3 FD   9F02            STD HERO_POS
    473  4     65D6 C3   2000            ADDD #$2000
    474  6     65D9 FD   9F04            STD HERO_POS+2
    475  5     65DC 39                   RTS
    476        65DD               Compute_Position_01
    477  5     65DD B7   65F8            STA Compute_Position_02+1
    478  2     65E0 86   28              LDA #$28
    479  5     65E2 F6   66F9            LDB HERO_Y_POS
    480  2     65E5 5A                   DECB
    481  11    65E6 3D                   MUL
    482  7     65E7 F3   65F7            ADDD Compute_Position_02
    483  4     65EA C3   2000            ADDD #$2000
    484  6     65ED FD   9F02            STD HERO_POS
    485  4     65F0 83   1FFF            SUBD #$1FFF
    486  6     65F3 FD   9F04            STD HERO_POS+2
    487  5     65F6 39                   RTS
    488        65F7               Compute_Position_02
    489        65F7 0000                 FDB $0000
    490                            
    491                           *****************************************>>
    492                           * Affichage de l arriere plan xxx cycles
    493                           *****************************************>>
    494        65F9               DRAW_RAM_DATA_TO_CART_160x200
    495  5+3   65F9 34   48              PSHS U,DP            * sauvegarde >>
    496  7     65FB 10FF 9F00            STS >SSAVE
    497                            
    498  4     65FF 10CE 1F40            LDS #FINECRANA       * init pointe>>
    499  3     6603 CE   A000            LDU #$A000
    500
    501        6606               DRAW_RAM_DATA_TO_CART_160x200A
    502  5+7   6606 37   3E              PULU A,B,DP,X,Y
    503  5+7   6608 34   3E              PSHS Y,X,DP,B,A
    504  5+7   660A 37   3E              PULU A,B,DP,X,Y
    505  5+7   660C 34   3E              PSHS Y,X,DP,B,A
    506  5+7   660E 37   3E              PULU A,B,DP,X,Y
    507  5+7   6610 34   3E              PSHS Y,X,DP,B,A
    508  5+7   6612 37   3E              PULU A,B,DP,X,Y
    509  5+7   6614 34   3E              PSHS Y,X,DP,B,A
    510  5+7   6616 37   3E              PULU A,B,DP,X,Y
    511  5+7   6618 34   3E              PSHS Y,X,DP,B,A
    512  5+7   661A 37   3E              PULU A,B,DP,X,Y
    513  5+7   661C 34   3E              PSHS Y,X,DP,B,A
    514  5     661E 118C 0014            CMPS #DEBUTECRANA
    515  3     6622 26   E2              BNE DRAW_RAM_DATA_TO_CART_160x200A>>
    516  5+7   6624 37   3E              PULU A,B,DP,X,Y
    517  5+7   6626 34   3E              PSHS Y,X,DP,B,A
    518  5+7   6628 37   3E              PULU A,B,DP,X,Y
    519  5+7   662A 34   3E              PSHS Y,X,DP,B,A
    520  5+6   662C 37   3C              PULU B,DP,X,Y
    521  5+6   662E 34   3C              PSHS Y,X,DP,B
    522
    523  4     6630 10CE 3F40            LDS #FINECRANB       * init pointe>>
    524  3     6634 CE   C000            LDU #$C000
    525
    526        6637               DRAW_RAM_DATA_TO_CART_160x200B
    527  5+7   6637 37   3E              PULU A,B,DP,X,Y
    528  5+7   6639 34   3E              PSHS Y,X,DP,B,A
    529  5+7   663B 37   3E              PULU A,B,DP,X,Y
    530  5+7   663D 34   3E              PSHS Y,X,DP,B,A
    531  5+7   663F 37   3E              PULU A,B,DP,X,Y
    532  5+7   6641 34   3E              PSHS Y,X,DP,B,A
    533  5+7   6643 37   3E              PULU A,B,DP,X,Y
    534  5+7   6645 34   3E              PSHS Y,X,DP,B,A
    535  5+7   6647 37   3E              PULU A,B,DP,X,Y
    536  5+7   6649 34   3E              PSHS Y,X,DP,B,A
    537  5+7   664B 37   3E              PULU A,B,DP,X,Y
    538  5+7   664D 34   3E              PSHS Y,X,DP,B,A
    539  5     664F 118C 2014            CMPS #DEBUTECRANB
    540  3     6653 26   E2              BNE DRAW_RAM_DATA_TO_CART_160x200B>>
    541  5+7   6655 37   3E              PULU A,B,DP,X,Y
    542  5+7   6657 34   3E              PSHS Y,X,DP,B,A
    543  5+7   6659 37   3E              PULU A,B,DP,X,Y
    544  5+7   665B 34   3E              PSHS Y,X,DP,B,A
    545  5+6   665D 37   3C              PULU B,DP,X,Y
    546  5+6   665F 34   3C              PSHS Y,X,DP,B
    547
    548  7     6661 10FE 9F00            LDS  >SSAVE          * rechargemen>>
    549  5+3   6665 35   48              PULS U,DP
    550  5     6667 39                   RTS
    551                            
    552                           *****************************************>>
    553                           * Palette de 16 couleurs
    554                           *****************************************>>
    555        6668               TABPALETTE
    556        6668 0CCD                 FDB $0ccd     * index:0  R:244 V:2>>
    557        666A 0BA4                 FDB $0ba4     * index:1  R:164 V:2>>
    558        666C 035D                 FDB $035d     * index:2  R:244 V:1>>
    559        666E 0D81                 FDB $0d81     * index:3  R:108 V:2>>
    560        6670 013B                 FDB $013b     * index:4  R:228 V:1>>
    561        6672 0541                 FDB $0541     * index:5  R:100 V:1>>
    562        6674 0D30                 FDB $0d30     * index:6  R:43  V:1>>
    563        6676 0017                 FDB $0017     * index:7  R:196 V:1>>
    564        6678 000B                 FDB $000b     * index:8  R:228 V:2>>
    565        667A 0D10                 FDB $0d10     * index:9  R:4   V:1>>
    566        667C 0110                 FDB $0110     * index:10 R:28  V:9>>
    567        667E 0003                 FDB $0003     * index:11 R:148 V:2>>
    568        6680 0700                 FDB $0700     * index:12 R:4   V:5>>
    569        6682 0200                 FDB $0200     * index:13 R:4   V:2>>
    570        6684 0000                 FDB $0000     * index:14 R:68  V:2>>
    571        6686 0000                 FDB $0000     * index:15 R:4   V:2>>
    572        6688               FINTABPALETTE
    573
    574                           *****************************************>>
    575                           * HERO Animations
    576                           * ---------------
    577                           * Note: Speed abs +0, rel +8, rel cap +10>>
    578                           *
    579                           * Chargement nouvelle animation
    580                           *    nouvelle frame = 109 a 119
    581                           *
    582                           * Chargement frame suivante
    583                           *    frame identique = 15
    584                           * ou frame suivante  = 116 a 126
    585                           *
    586                           * Chargement frame suivante avec branchem>>
    587                           *    nouvelle frame = 165 a 175
    588                           * ou frame suivante = 172 a 182
    589                           *
    590                           * Chargement frame suivante avec retour s>>
    591                           *    nouvelle frame = 167 a 177
    592                           * ou frame suivante = 174 a 184
    593                           *****************************************>>
    594
    595        6688               HERO_ANIMATION_LOAD                      >>
    596  6     6688 BF   670E            STX HERO_ANIMATION_ADR
    597  6     668B BF   6710            STX HERO_ANIMATION_RTN_ADR
    598  7     668E 7F   6717            CLR HERO_ANIMATION_IMC            >>
    599        6691               HERO_ANIMATION_LOAD_00
    600  5+1   6691 EC   1E              LDD -2,X                          >>
    601  2     6693 81   00              CMPA #$00                         >>
    602  3     6695 27   07              BEQ HERO_ANIMATION_LOAD_01
    603  5     6697 F0   66FA            SUBB HERO_G_SPEED                 >>
    604  3     669A 24   02              BCC HERO_ANIMATION_LOAD_01
    605  2     669C C6   01              LDB #$01                          >>
    606        669E               HERO_ANIMATION_LOAD_01
    607  5     669E F7   6719            STB HERO_ANIMATION_FRR            >>
    608  5     66A1 B6   6717            LDA HERO_ANIMATION_IMC
    609  2     66A4 C6   05              LDB #$05
    610  11    66A6 3D                   MUL
    611  7     66A7 F3   670E            ADDD HERO_ANIMATION_ADR
    612  6     66AA 1F   02              TFR D,Y
    613  4+0   66AC E6   A4              LDB ,Y
    614  2     66AE C1   1F              CMPB #$1F                         >>
    615  3     66B0 22   0E              BHI HERO_ANIMATION_LOAD_NOPAGE
    616  5     66B2 F7   6712            STB HERO_ANIMATION_PAG            >>
    617  5+1   66B5 AE   21              LDX 1,Y
    618  6     66B7 BF   6715            STX HERO_ANIMATION_DRW
    619  5+1   66BA AE   23              LDX 3,Y
    620  6     66BC BF   6713            STX HERO_ANIMATION_DEL
    621  5     66BF 39                   RTS
    622        66C0               HERO_ANIMATION_LOAD_NOPAGE
    623  2     66C0 C1   FF              CMPB #$FF
    624  3     66C2 26   0C              BNE HERO_ANIMATION_LOAD_FE
    625  5+1   66C4 AE   23              LDX 3,Y
    626  6     66C6 BF   6717            STX HERO_ANIMATION_IMC            >>
    627  5+1   66C9 AE   21              LDX 1,Y
    628  6     66CB BF   670E            STX HERO_ANIMATION_ADR
    629  3     66CE 20   C1              BRA HERO_ANIMATION_LOAD_00  * Outp>>
    630        66D0               HERO_ANIMATION_LOAD_FE
    631  6     66D0 BE   6710            LDX HERO_ANIMATION_RTN_ADR  * RETU>>
    632  6     66D3 BF   670E            STX HERO_ANIMATION_ADR
    633  5     66D6 F6   6718            LDB HERO_ANIMATION_RTN_IMC
    634  5     66D9 F7   6717            STB HERO_ANIMATION_IMC
    635  3     66DC 20   B3              BRA HERO_ANIMATION_LOAD_00  * Outp>>
    636
    637        66DE               HERO_ANIMATION_NEXT
    638  7     66DE 7A   6719            DEC HERO_ANIMATION_FRR
    639  3     66E1 27   01              BEQ HERO_ANIMATION_NEXT_00  * BRAN>>
    640  5     66E3 39                   RTS
    641        66E4               HERO_ANIMATION_NEXT_00
    642  7     66E4 7C   6717            INC HERO_ANIMATION_IMC
    643  6     66E7 BE   670E            LDX HERO_ANIMATION_ADR
    644  3     66EA 20   A5              BRA HERO_ANIMATION_LOAD_00  * Outp>>
    645                            
    646                           *   SAMPLE CODE ANIMATION
    647                           *      ---------------------
    648                           *      FDB $0018            * 00 Absolute>>
    649                           *HERO_IDLE_L
    650                           *      FCB $01                     * Page>>
    651                           *      FDB $A000            * Adresse drw>>
    652                           *      FDB $A000            * Adresse del>>
    653                           *
    654                           *      FCB $FF                     * FF S>>
    655                           *      FDB HERO_IDLE-C * adresse animatio>>
    656                           *      FDB $0301            * 03 image ci>>
    657                           *
    658                           *      FCB $FE                     * FE R>>
    659                           *
    660                           *      LDX #HERO_IDLE_R
    661                           *      JSR HERO_ANIMATION_LOAD
    662                           *
    663                           *      JSR HERO_ANIMATION_NEXT
    664
    665                           *<ANIMATION_TABLE>
    666                           * Limite a 128 images par animations
    667
    668        66EC 0001                 FDB $0001
    669        66EE               HERO_IDLE_L
    670        66EE               HERO_IDLE_R
    671        66EE               HERO_IDLE_L2
    672        66EE               HERO_SUBIDLE_B
    673        66EE               HERO_WALK_L
    674        66EE               HERO_WALK_R
    675        66EE               HERO_RUN_L
    676        66EE               HERO_RUN_R
    677        66EE 04                   FCB $04
    678        66EF A000                 FDB $A000
    679        66F1 A000                 FDB $A000
    680        66F3 FF                   FCB $FF
    681        66F4 66EE                 FDB HERO_RUN_R
    682        66F6 0000                 FDB $0000
    683                            
    684                           *****************************************>>
    685                           * HERO Variables
    686                           *****************************************>>
    687                  0400     HERO_WALK_SPD_LIMIT EQU $0400
    688                  0600     HERO_JOG_SPD_LIMIT  EQU $0600
    689        66F8               HERO_X_POS
    690        66F8 50                   FCB $50                     * Hori>>
    691        66F9               HERO_Y_POS
    692        66F9 C8                   FCB $C8                     * Vert>>
    693        66FA               HERO_G_SPEED         * Ground Speed
    694        66FA 0000                 FDB $0000            * First byte >>
    695        66FC               HERO_X_SPEED
    696        66FC 0000                 FDB $0000            * Horizontal >>
    697        66FE               HERO_X_SPS
    698        66FE 0000                 FDB $0000            * Subpixel X >>
    699        6700               HERO_Y_SPEED
    700        6700 0000                 FDB $0000            * Vertical Sp>>
    701        6702               HERO_Y_SPS
    702        6702 0000                 FDB $0000            * Subpixel Y >>
    703        6704               HERO_TOP_SPEED
    704        6704 0600                 FDB $0600        * vitesse maximum>>
    705        6706               HERO_NEG_TOP_SPEED
    706        6706 FA00                 FDB $FA00        * vitesse maximum>>
    707        6708               HERO_ACCELERATION
    708        6708 000C                 FDB $000C        * constante accel>>
    709        670A               HERO_DECELERATION
    710        670A 0080                 FDB $0080        * constante decel>>
    711        670C               HERO_FRICTION
    712        670C 000C                 FDB $000C        * constante de fr>>
    713        670E               HERO_ANIMATION_ADR
    714        670E 0000                 FDB $0000        * Animation coura>>
    715        6710               HERO_ANIMATION_RTN_ADR
    716        6710 0000                 FDB $0000        * Animation coura>>
    717        6712               HERO_ANIMATION_PAG
    718        6712 00                   FCB $00          * Animation coura>>
    719        6713               HERO_ANIMATION_DEL
    720        6713 0000                 FDB $0000        * Animation coura>>
    721        6715               HERO_ANIMATION_DRW
    722        6715 0000                 FDB $0000        * Animation coura>>
    723        6717               HERO_ANIMATION_IMC
    724        6717 00                   FCB $00          * Animation coura>>
    725        6718               HERO_ANIMATION_RTN_IMC
    726        6718 00                   FCB $00          * Animation coura>>
    727        6719               HERO_ANIMATION_FRR
    728        6719 00                   FCB $00          * Animation coura>>

000000 Total Errors

000107 Total Symbols
     0x          Label 6300 BEGIN
     3x          Label 642E CLR_CART
     1x          Label 6447 CLR_CART_2
     1x          Label 6463 CLR_CART_3
     1x          Label 65C0 Compute_Position
     1x          Label 65DD Compute_Position_01
     4x          Label 65F7 Compute_Position_02
     1x          Equ   0014 DEBUTECRANA
     1x          Equ   2014 DEBUTECRANB
     1x          Equ   622C DK_dernier_bloc_a_ecrire
     1x          Equ   6213 DK_destination
     1x          Equ   6205 DK_lecture
     1x          Equ   620A DK_piste
     1x          Equ   620F DK_secteur
     0x          Label 65F9 DRAW_RAM_DATA_TO_CART_160x200
     1x          Label 6606 DRAW_RAM_DATA_TO_CART_160x200A
     1x          Label 6637 DRAW_RAM_DATA_TO_CART_160x200B
     2x          Equ   1F40 FINECRANA
     2x          Equ   3F40 FINECRANB
     1x          Label 6688 FINTABPALETTE
     2x          Label 6708 HERO_ACCELERATION
    13x          Label 670E HERO_ANIMATION_ADR
     1x          Label 6713 HERO_ANIMATION_DEL
     4x          Label 6715 HERO_ANIMATION_DRW
     2x          Label 6719 HERO_ANIMATION_FRR
     5x          Label 6717 HERO_ANIMATION_IMC
     1x          Label 6688 HERO_ANIMATION_LOAD
     3x          Label 6691 HERO_ANIMATION_LOAD_00
     2x          Label 669E HERO_ANIMATION_LOAD_01
     1x          Label 66D0 HERO_ANIMATION_LOAD_FE
     1x          Label 66C0 HERO_ANIMATION_LOAD_NOPAGE
     1x          Label 66DE HERO_ANIMATION_NEXT
     1x          Label 66E4 HERO_ANIMATION_NEXT_00
     5x          Label 6712 HERO_ANIMATION_PAG
     2x          Label 6710 HERO_ANIMATION_RTN_ADR
     1x          Label 6718 HERO_ANIMATION_RTN_IMC
     4x          Label 670A HERO_DECELERATION
     2x          Label 670C HERO_FRICTION
    17x          Label 66FA HERO_G_SPEED
     1x          Label 66EE HERO_IDLE_L
     0x          Label 66EE HERO_IDLE_L2
     2x          Label 66EE HERO_IDLE_R
     2x          Equ   0600 HERO_JOG_SPD_LIMIT
     1x          Label 6484 Hero_Move
     1x          Label 64F6 Hero_MoveLeft
     1x          Label 6510 Hero_MoveLeft_00
     1x          Label 652E Hero_MoveLeft_01
     1x          Label 650A Hero_MoveLeft_03
     1x          Label 653A Hero_MoveRight
     1x          Label 6551 Hero_MoveRight_00
     1x          Label 656F Hero_MoveRight_01
     1x          Label 654B Hero_MoveRight_03
    11x          Label 6578 Hero_MoveUpdatePos
     1x          Label 6592 Hero_MoveUpdatePos_00
     1x          Label 65A9 Hero_MoveUpdatePos_01
     0x          Label 65A9 Hero_MoveUpdatePos_03
     2x          Label 6591 Hero_MoveUpdatePos_V00
     3x          Label 6706 HERO_NEG_TOP_SPEED
     1x          Label 648D Hero_NotLeft
     1x          Label 6494 Hero_NotLeftOrRight
     1x          Label 64CB Hero_NotLeftOrRight_00
     1x          Label 64B4 Hero_NotLeftOrRight_01
     1x          Label 64C5 Hero_NotLeftOrRight_02
     1x          Label 64C8 Hero_NotLeftOrRight_03
     1x          Label 64DF Hero_NotLeftOrRight_11
     1x          Label 64F0 Hero_NotLeftOrRight_12
     1x          Label 64F3 Hero_NotLeftOrRight_13
     6x          Equ   9F02 HERO_POS
     1x          Label 66EE HERO_RUN_L
     2x          Label 66EE HERO_RUN_R
     0x          Label 66EE HERO_SUBIDLE_B
     3x          Label 6704 HERO_TOP_SPEED
     2x          Label 66EE HERO_WALK_L
     2x          Label 66EE HERO_WALK_R
     0x          Equ   0400 HERO_WALK_SPD_LIMIT
     4x          Label 66F8 HERO_X_POS
     2x          Label 66FC HERO_X_SPEED
     6x          Label 66FE HERO_X_SPS
     4x          Label 66F9 HERO_Y_POS
     1x          Label 6700 HERO_Y_SPEED
     0x          Label 6702 HERO_Y_SPS
     0x          Label 6352 INIT_VID
     0x          Equ   000D JOY_B
     0x          Equ   0005 JOY_BD
     0x          Equ   0009 JOY_BG
     1x          Label 6483 JOY_BTN_STATUS
     0x          Equ   000F JOY_C
     1x          Equ   0007 JOY_D
     2x          Label 6482 JOY_DIR_STATUS
     1x          Equ   000B JOY_G
     0x          Equ   000E JOY_H
     0x          Equ   0006 JOY_HD
     0x          Equ   000A JOY_HG
     1x          Label 646A JOY_READ
     1x          Label 63A1 MAIN
     1x          Label 63EC MEM_COPY_DATA_TO_CART
     1x          Label 63F0 MEM_COPY_DATA_TO_CART_01
     1x          Label 6423 MEM_COPY_DATA_TO_CART_02
     1x          Label 6429 MEM_COPY_DATA_TO_CART_03
     4x          Label 63BC SCRC
     3x          Label 63D7 SCRC0
     1x          Label 6365 SETPALETTE
     3x          Equ   9F00 SSAVE
     1x          Label 6668 TABPALETTE
     1x          Label 63E1 VSYNC
     1x          Label 63E1 VSYNC_1
     1x          Label 63E6 VSYNC_2

