********************************************************************************
* Moteur de jeu (TO8 Thomson) - Benoit Rousseau 07/10/2020
* ------------------------------------------------------------------------------
*
*
********************************************************************************

(main)MAIN
	org $6300
	
        INCLUD CONSTANT

********************************************************************************  
* Reference des variables globales
********************************************************************************
EXO_SRC                      equ $6101
EXO_DST                      equ $6105 
DK_DST                       equ $6222

********************************************************************************  
* Boucle principale
********************************************************************************
LevelMainLoop
        jsr   WaitVBL
        jsr   ReadJoypads
        jsr   RunObjects
        jsr   BuildSprites
        bra   LevelMainLoop

* Les donnees de fond de sprite sont sauvegardees dans l'espace ecran 4000 a 5FFF (page 0)
* le bit D0 de E7C3 permet de switcher entre RAMA et RAMB
* ca permet de gerer deux espaces tampon pour la sauvegarde du fond de sprite pour les pages 2 et 3

* La page de scratch pour l'exomizer doit donc etre une autre page que la 2 et montee en zone cartouche pour 
* pouvoir copier des donnees dans la zone donnees ou 6100+

* ==============================================================================
* Routines
* ==============================================================================

        INCLUD WAITVBL

ReadJoypads
RunObjects
BuildSprites
        rts

* ==============================================================================
* Donnees globales
* ==============================================================================

MainCharacter_Is_Dead        fcb   $00

********************************************************************************
* SST - Table des variables de chaque Objet
********************************************************************************

Gotp_Closest_Player          fdb   $0000     * ptr objet de MainCharacter ou Sidekick
Gotp_Player_Is_Left          fcb   $00       * 0: player left from object, 2: right
Gotp_Player_Is_Above         fcb   $00       * 0: player above object, 2: below
Gotp_Player_H_Distance       fdb   $0000     * closest character's h distance to obj
Gotp_Player_V_Distance       fdb   $0000     * closest character's v distance to obj 
Gotp_Abs_H_Distance_Mainc    fdb   $0000     * absolute horizontal distance to main character
Gotp_H_Distance_Sidek        fdb   $0000     * horizontal distance to sidekick

********************************************************************************
* OST - Table des variables de chaque Objet
********************************************************************************
        
Object_RAM

Reserved_Object_RAM
MainCharacter                rmb   object_size
Sidekick                     rmb   object_size
Reserved_Object_RAM_End

Dynamic_Object_RAM           rmb   number_of_dynamic_objects*object_size
Dynamic_Object_RAM_End

LevelOnly_Object_RAM
Tails_Tails                  rmb   object_size
Sonic_Dust                   rmb   object_size
Tails_Dust                   rmb   object_size
LevelOnly_Object_RAM_End

Object_RAM_End